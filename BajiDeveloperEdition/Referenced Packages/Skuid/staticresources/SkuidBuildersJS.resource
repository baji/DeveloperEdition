/*! Skuid 5.10.0 28-08-2014 */
!function(a){function b(a){a||(a="NewModel");var b,c,d=a.substring(a.length-1,a.length);for(lb.isNumber(d)?(c=parseInt(d,10)-2+3,a=a.substring(0,a.length-1),b=a+c):(b=a,c=1);z(b).length>0;)b=a+""+c++;return b}function c(a,b){var c,d=a.split("."),e=d.shift(),f=e.charAt(0),g=(b?b.toLowerCase()+f.toUpperCase():f.toLowerCase())+e.slice(1);if(d.length)for(c=0;c<d.length;c++)e=d[c],g+=e.charAt(0).toUpperCase()+e.slice(1);return g.replace(/_/g,"").substring(0,25)}function d(a){ib.extend(this,a)}function e(b){b.header.text(b.builderId),b.body.css("padding","8px"),b.body.text(a.label.read("pb_no_component_renderer"))}function f(b,c){b.clear(),b.setHeaderText(c.builderId+" "+a.label.read("properties")),b.body.append(ib("<div>").addClass("nx-pagebuilder-infotext").text(a.label.read("pb_no_properties_renderer")))}function g(b){return b._GUID=a.utils.generateGUID(),zb[b._GUID]=b,b}function h(a){delete zb[a._GUID]}function i(){return ib.map(zb,function(a){return a})}function j(a){qb[a.id]=a}function k(a){ib.each(a,function(){j(this)})}function l(a){return qb[a]}function m(){return qb}function n(a,b){var c,d=b.storeAs,e=b.location,f=b.id,g=b.defaultValue;if(e||(e=f?"attribute":"node"),d){if("node"===d.type&&d.name){var h=a.children(d.name);1===h.length?c=h.first().text():h.length>1&&(c=[],ib.each(h,function(){c.push(ib(this).text())}))}}else c="attribute"==e?a.attr(f):f?a.children(f).first().text():a.text();return ib.isArray(c)&&0===c.length?c.push(g):"undefined"==typeof c&&(c=g),c}function o(b,c){if(c||(c={}),b){var d,e=b,f=!1;c.selector?e=b.find(c.selector):c.childNodeName&&(e=b.children(c.childNodeName),e.length<1&&(e=mb("<"+c.childNodeName+"/>").appendTo(b))),c.storeAs&&c.storeAs.type&&"node"===c.storeAs.type?(e.empty(),ib.each(c.value,function(a,b){e.append(mb("<"+c.storeAs.name+"/>").text(b))}),f=!0):c.key?(d=e.attr(c.key),f="undefined"!=typeof d||"undefined"!=typeof c.value&&c.value!==d,f&&e.attr(c.key,c.value)):(f=c.value!==e.text(),f&&e.text(c.value)),!c.childNodeName||"undefined"!=typeof c.value&&""!==c.value||e.remove(),f&&a.events.publish("skuidBuilderSave")}}function p(b,c,d){lb.writeXmlToPageLayoutFields(b,c,d);var e=a.utils.size(tb);e>0&&ib.each(tb,function(a,b){return e>0?(b&&b.refresh&&b.refresh(),delete tb[a],e--,void 0):!0})}function q(b,c){var d=rb[b];d&&!d._isPreload?c(d):b&&a.RemotingStubs.getModelMetadata(JSON.stringify({sObjectName:b,loadChildRelationships:"true",loadPicklistValues:"false"}),function(a,d){d.status&&(rb[b]=JSON.parse(a),c&&c(rb[b]))},{escape:!1})}function r(a){var b=a.index()+1+": ",c=a.attr("type"),d="false"!==a.attr("enclosevalueinquotes");if(b+=a.attr("field")||"[No Field]",b+=" "+Db[a.attr("operator")||""].name+" ","param"==c)b+="(param) ";else if("userinfo"==c){var e=Eb[a.attr("userinfotype")],f=e?e.label:"User Id";b+="(userinfo) "+f}else if("join"==c){b+="(SELECT "+(a.attr("joinfield")||"")+" FROM "+(a.attr("joinobject")||"");var g=a.children("condition");g.length&&(b+=" WHERE (<Sub Conditions>)"),b+=")"}else if("modelmerge"===c)b+="("+(a.attr("model")||"")+")("+(a.attr("mergefield")||"")+")";else if("multiple"===c){b+="(";var h=a.children("values").children();h.length&&(h.each(function(){b+=(d?"'":"")+ib(this).text()+(d?"',":",")}),b=b.substring(0,b.length-1)),b+=")"}else if("dependent"===c){var i=a.attr("depfield")||"<Unspecified>";b+="the value of the '"+i+"' field from the current row"}return("param"===c||"userinfo"===c)&&(d=!1),("fieldvalue"===c||"param"===c||"userinfo"===c||"blank"===c)&&(d&&(b+="'"),b+=a.attr("value")||"",d&&(b+="'")),"filterableon"!==a.attr("state")&&"filterableoff"!==a.attr("state")||!a.attr("name")||(b+=" (filterable as "+a.attr("name")+")"),"true"===a.attr("inactive")&&(b+=" (inactive)"),b}function s(a,b,c){var d;a&&(lb.isString(a)?d=z(a):a.length&&(d=a,a=d.attr("id")));var e=d&&d.children("fields,groupby").children('[id="'+lb.escapeSelector(b)+'"]');if(e&&"true"===e.attr("uionly")){var f=e.attr("displaytype"),g={displaytype:f,id:e.attr("id"),label:e.attr("label")};return-1!==ib.inArray(f,["PICKLIST","MULTIPICKLIST"])&&(g.picklistEntries=ib.map(e.children("picklistentries").children(),function(a){return{value:a.value,label:a.label,active:!0}})),g}c||(c=a&&x(a));var h=b.split("."),i=h.pop(),j=e&&e.attr("targetobjects"),k=j&&j.split(",");h.length&&ib.each(h,function(){var a=rb[c],b=this;a&&ib.each(a.fields,function(){return this.rel==b?(c=this.ref,!1):void 0});var d=c.split(",");if(d.length>0)if(k){var e=k.shift();c=d.indexOf(e)?e:d[0]}else c=d[0]});var l=rb[c],m=null;return l&&ib.each(l.fields,function(){return this.id==i?(m=this,!1):void 0}),m}function t(a){var b,c=a.state;if(c.is("field"))b=c.attr("id");else{if(!c.attr("field"))return!1;b=c.attr("field")}var d=s(!1,b,v(a));return d}function u(a){var b=a.state,c=t(a);if(!c)return!1;var d=c.displaytype;"blank"===b.attr("type")||-1!==ib.inArray(d,["NUMBER","INTEGER","BOOLEAN","CURRENCY","DATE","DATETIME","DOUBLE","PERCENT"])?b.attr("enclosevalueinquotes","false"):b.attr("enclosevalueinquotes","true")}function v(a){var b,c=a.state;if(c.is("field"))b=c.closest("model").attr("sobject");else if(a.isSubcondition)b=c.parent().closest("condition").attr("joinobject");else if(a.isChildRelationshipCondition){var d=C(c.closest("model").attr("id"),c.closest("field").attr("id"));b=d.childSObject}else if(a.isLookupFilterCondition){var e=s(c.parent().closest("[model]").attr("model"),c.closest("field").attr("id"));b=e?-1!==e.ref.indexOf(",")&&c.attr("fieldtargetobjects")?c.attr("fieldtargetobjects"):e.ref:null}else b=a.isRenderCondition||a.isUpdateAction?x(c.attr("fieldmodel")?c.attr("fieldmodel"):c.closest("[model]").attr("model")):c.closest("model").attr("sobject");return b}function w(a,b){return-1!==ib.inArray("User",b)||(-1!==ib.inArray("Contact",b)||-1!==ib.inArray("Lead",b))&&-1!==ib.inArray(a.id,Hb)||-1!==ib.inArray(a.id,Gb)}function x(a){return z(a).attr("sobject")}function y(){return kb.pageXML.children("models")}function z(a){return y().children('[id="'+a+'"]')}function A(){return y().children("model").first()}function B(a,b){return kb.pageXML.children("models").first().children("model"+(b?'[id="'+b+'"]':"")).children("conditions").find('condition[name="'+a+'"]')}function C(a,b,c){c||(c=a&&x(a));var d=rb[c],e=null;return d&&ib.each(d.childRelationships,function(){return this.relationshipName===b?(e=this,!1):void 0}),e}function D(b){b||(b={});var c,d=b.fieldId,e=b.model,f=b.fieldBuilder||a.builder.fieldBuilder;if(c=f&&!a.mobile?function(a){return f.getDefaultState(a)}:kb.defaultStateGenerators.field,d&&e){var g,h=b.fieldsNode,i=b.fieldsElement,j=b.targetObjects;h||(h=e.children("fields")),i||(g=bc(h),i=g&&g.element.find(".nx-pagebuilder-fieldschildren"));var k=h.children('[id="'+lb.escapeSelector(d)+'"]'),l="aggregate"===e.attr("type"),m=e.attr("id"),n=kb.getFieldInfoFromCache(m,d),o=b.view,p=[];if(l||0===k.length){var q={id:d,needsAlias:l};l&&(h.is("groupby")?n&&"DATETIME"==n.displaytype&&(q.functionName="CALENDAR_YEAR"):q.functionName="SUM"),"childonly"===o&&(q.isRelationship=!0);var r="Id"!==d&&(lb.endsWith(d,"Id")||lb.endsWith(d,"__c")||lb.endsWith(d,"__pc"));if(p.push(c(q)),!l&&r){var s;if(n&&"REFERENCE"===n.displaytype&&n.referenceTo&&n.referenceTo.length&&n.rel&&"null"!==n.rel){var t=1==n.referenceTo.length?n.referenceTo[0].objectName:"Name";if(!t||t in kb.fieldsDescribeCache||kb.getFields(t),n.referenceTo.length<2?(s=lb.getFieldReference(d,n),0===h.children('[id="'+lb.escapeSelector(s)+'"]').length&&p.push(c(s))):(s=lb.getFieldRelationshipName(d,n)+".Name",0===h.children('[id="'+lb.escapeSelector(s)+'"]').length&&p.push(c(s))),"skuid__Image__c"===n.referenceTo[0].objectName){var u=lb.getFieldRelationshipName(d,n)+".skuid__AttachmentId__c";0===h.children('[id="'+lb.escapeSelector(u)+'"]').length&&p.push(c(u))}}}ib.each(p,function(a,b){j&&b.attr("targetobjects",j),h.append(b),i&&f&&i.append(kb.componentFactory(b,f).element)})}if(p.length)return p}return!1}function E(a,b){b=b||{};var c,d=a.state;c=b.fieldMetadata?b.fieldMetadata:t(a);var e={id:"type",type:"picklist",label:"Content",defaultValue:"fieldvalue",picklistEntries:[{label:"Single specified value",value:"fieldvalue"},{label:"Multiple specified values",value:"multiple"},{label:"URL parameter",value:"param"},{label:"UserInfo of page viewer",value:"userinfo"},{label:"None - blank value",value:"blank"},{label:"Field from another model",value:"modelmerge"},{label:"Result of subquery",value:"join"},{label:"Another field from row",value:"dependent"}],onChange:function(c,e){var f=t(a),g=f?f.displaytype:null;"fieldvalue"===e&&"multiple"===c&&d.attr("value")?d.append(mb("<values/>").append(mb("<value/>").text(d.attr("value")))):d.empty(),d.attr("value",""),d.attr("operator")in G(c,g)||d.attr("operator",-1!==ib.inArray(c,["multiple","join"])?"in":"="),d.removeAttr("enclosevalueinquotes model joinfield joinobject label"),"modelmerge"===c&&d.attr("model",kb.getFirstModel().attr("id")),"blank"===c&&d.attr("value","null"),kb.determineQuotedness(a),a.save().refresh(),b.handleChange&&b.handleChange(),b.handleRefresh&&b.handleRefresh()}};if(b.validTypes){var f=[];ib.each(e.picklistEntries,function(){-1!==b.validTypes.indexOf(this.value)&&f.push(this)}),e.picklistEntries=f}var g={id:"value",type:"string",label:"Value",onChange:function(){a.refresh(),b.handleChange&&b.handleChange()},metadata:c},h={id:"value",type:"string",label:"Parameter",onChange:function(){a.refresh(),b.handleChange&&b.handleChange()}},i={id:"novaluebehavior",type:"picklist",label:"If this Parameter is not provided, then...",helptext:"Specifies the action to take if the specified URL Parameter is not provided.",defaultValue:"",isNew:!0,picklistEntries:[{label:"Set its value to Blank",value:""},{label:"Deactivate this Condition",value:"deactivate"},{label:"Abort this Model's Query",value:"noquery"}]},j={id:"userinfotype",type:"picklist",label:"UserInfo Property",helptext:"The UserInfo variable to merge in as the value for the selected field.",defaultValue:"userid",picklistEntries:[],onChange:function(){a.refresh(),b.handleChange&&b.handleChange()}};ib.each(kb.userinfomap,function(a,b){j.picklistEntries.push({label:b.label,value:a})});var k={id:"mergefield",type:"field",label:"Source Field",modelprop:"model",defaultValue:"Id",onChange:function(){a.refresh(),b.handleChange&&b.handleChange()}},l={id:"model",type:"model",label:"Source Model",helptext:"The Model whose first row's specified Merge Field's value will be used as the merge value for this Condition.",onChange:function(){a.refresh(),b.handleChange&&b.handleChange(),b.handleRefresh&&b.handleRefresh()}},m={id:"novaluebehavior",type:"picklist",label:"If no row in Source Model, then...",helptext:"Specifies the action to take if no rows are returned by the source model.",isNew:!0,defaultValue:"deactivate",picklistEntries:[{label:"Deactivate this Condition",value:"deactivate"},{label:"Abort this Model's Query",value:"noquery"}]},n={id:"joinobject",type:"sobject",label:"Join Object",helptext:"The Object to join in when performing a Semi-Join Sub-Select, e.g. Case in 'WHERE Id in (SELECT ContactId FROM Case)' ",onChange:function(){a.refresh(),b.handleChange&&b.handleChange(),b.handleRefresh&&b.handleRefresh()}},o={id:"joinfield",type:"field",label:"Join Field",helptext:"The field to join when performing a Semi-Join Sub-Select, e.g. ContactId in 'WHERE Id in (SELECT ContactId FROM Case)' ",sobject:d.attr("joinobject"),displayTypeFilter:["ID","REFERENCE"],onChange:function(){a.refresh(),b.handleChange&&b.handleChange()}},p={id:"logic",type:"string",label:"Subcondition Logic",onChange:function(){a.refresh()}},q={id:"values",location:"node",type:"multiitem",storeAs:{type:"node",name:"value"},label:"Values",onChange:function(){a.refresh(),b.handleChange&&b.handleChange()},metadata:c},r={id:"depfield",type:"field",label:"Depends On",sobject:x(a.state.closest("[model]").attr("model")),onChange:function(){a.refresh()}},s={fieldvalue:[e,g],multiple:[e,q],param:[e,h,i],userinfo:[e,j],blank:[e],modelmerge:[e,l,k,m],join:[e,n,o,p],dependent:[e,r]};return s[d.attr("type")||"fieldvalue"]}function F(a,b){b=b||{};var c=a.state,d={id:"field",type:"field",label:"Field",onChange:function(d,e,f){kb.updateState(c,{key:"fieldtargetobjects",value:f});var g=t(a),h=g?g.displaytype:!1;"fieldvalue"===c.attr("type")&&("BOOLEAN"===h?"false"!==c.attr("value")&&c.attr("value","true"):"INTEGER"===h?c.attr("value","0"):-1!==ib.inArray(h,["CURRENCY","DOUBLE"])?c.attr("value","0.0"):-1!==ib.inArray(h,["DATE","DATETIME"])&&c.attr("value","")),kb.determineQuotedness(a),a.save().refresh(),b.handleChange&&b.handleChange()}};return b.sobject?d.sobject=b.sobject:b.modelprop?d.modelprop=b.modelprop:b.modelname&&(d.modelname=b.modelname),b.addFieldToModel&&(d.addFieldToModel=!0),b.showObjectPickerIfPolymorphic&&(d.showObjectPickerIfPolymorphic=!0),d}function G(a,b){var c={};return ib.each(kb.operatormap,function(d,e){if(d&&-1!==ib.inArray(a||"fieldvalue",e.validFor)){var f=e.validForDisplayTypes,g=!0;f&&f.length&&b&&-1===ib.inArray(b,f)&&(g=!1),g&&(c[d]=e)}}),c}function H(a,b){b||(b={});var c=a.state,d=b.fieldMetadata||!1,e=d?d.displaytype:!1,f={id:"operator",type:"picklist",label:"Operator",defaultValue:"=",picklistEntries:[],onChange:function(c){a.save().refresh(),b.handleChange&&b.handleChange(c)}};return ib.each(G(c.attr("type"),e),function(a,b){f.picklistEntries.push({label:b.name,value:a})}),f}function I(a,b){b=b||{};var c=a.state,d={id:"state",type:"picklist",label:"Condition State",defaultValue:"",picklistEntries:[{label:"Always On",value:""},{label:"Filterable Default On",value:"filterableon"},{label:"Filterable Default Off",value:"filterableoff"},{label:"Always Off",value:"off"}],onChange:function(d){if(d&&"filterableon"!==d?c.attr("inactive","true"):c.attr("inactive","false"),"filterableon"!==d&&"filterableoff"!==d)c.removeAttr("name");else if(!c.attr("name")&&c.attr("field")){for(var e=c.attr("field"),f=e,g=1;B(f,c.closest("model").attr("id")).length;)f=e+""+g++;c.attr("name",f)}a.save().refresh(),b.handleChange&&b.handleChange(),b.handleRefresh&&b.handleRefresh()}},e={id:"name",type:"string",label:"Condition Name",helptext:"A unique name for this Condition, allowing it to be affected by Filters.",validator:function(b){return kb.validators.conditionName(b,a)},onChange:function(d,e){kb.publishStateEvent({type:"model.condition.nameChange",modelId:c.closest("model").attr("id"),oldName:e,newName:d}),a.save().refresh(),b.handleChange&&b.handleChange()}};return"filterableon"===c.attr("state")||"filterableoff"===c.attr("state")?[d,e]:[d]}function J(b,c,d,e){var f,g,h,i,j,k,l,m,n;if(b.metadata&&(g=b.metadata.displaytype,l="DATE"===g||"DATETIME"===g),e?(i=e,h=e.text(),j=void 0):(i=c,h=c.attr(d),j=d),"BOOLEAN"===g)f={value:"true"===h,onChange:function(a){var c=a?"true":"false";kb.updateState(i,{key:j,value:c}),b.onChange&&b.onChange(c)}};else if("PICKLIST"===g&&b.metadata.picklistEntries)f={value:lb.decodeHTML(h),onChange:function(a){kb.updateState(i,{key:j,value:a,required:!0}),b.onChange&&b.onChange(a)},entries:b.metadata.picklistEntries};else if(l){if(m=h,n="",h&&-1!==h.indexOf(":")){var o=h.split(":");m=o[0],n=o[1]}f={value:lb.decodeHTML(h),onChange:function(a){kb.updateState(i,{key:j,value:a}),b.onChange&&b.onChange(a)}}}else g="TEXT",h=h||b.defaultValue||"",f={value:lb.decodeHTML(h),onChange:function(a,c){var d=!0,e=k.parent().find(".nx-property-error");b.validator&&(d=b.validator(a)),d===!0?(e.length&&e.hide(),kb.updateState(i,{key:j,value:a}),b.onChange&&b.onChange(a,c)):(e.length?e.show():e=ib('<div class="nx-property-error">').insertAfter(k),e.text(d),k.val(c))}};if(k=a.ui.renderers[g].edit(f),l){var p,q,r,s,t=function(){"NONE"===p?q.show():q.hide(),n?s.show():s.hide()},u=kb.dateliteralmap[m],v=[];v.push({label:"Specific Date",value:"NONE"}),ib.each(kb.dateliteralmap,function(a){v.push({label:this.label,value:a})}),u?p=m:(p="NONE",n=""),q=k,r=a.ui.renderers.PICKLIST.edit({value:p,onChange:function(a){var c;a?(u=kb.dateliteralmap[a],u?(p=a,u.merge?(n="1",s.val(n),c=p+":"+n):(c=p,n="")):(p="NONE",c="",n="")):(c="",p="NONE",n=""),q.is(".hasDatepicker")?q.datepicker("setDate",""):q.find(".hasDatepicker").datepicker("setDate",""),kb.updateState(i,{key:j,value:c}),b.onChange&&b.onChange(c),t()},entries:v,required:!0}),s=a.ui.renderers.TEXT.edit({value:n,onChange:function(a){var c=r.val()+":"+a;kb.updateState(i,{key:j,value:c}),b.onChange&&b.onChange(c)}}),t(),k=ib("<div>").append(r,q,s)}return k}function K(){return[{value:"-",label:"",disabled:!0},{value:"-",label:"Model Conditions / Querying",disabled:!0},{value:"setCondition",label:"Activate & Set value of Model Condition"},{value:"activateCondition",label:"Activate Model Condition"},{value:"deactivateCondition",label:"Deactivate Model Condition"},{value:"requeryModel",label:"Query Model"},{value:"requeryModels",label:"Query Models"},{value:"-",label:"",disabled:!0},{value:"-",label:"Model data changes",disabled:!0},{value:"createRow",label:"Create new row in Model"},{value:"updateRow",label:"Update a field on row(s)"},{value:"cancel",label:"Cancel Model(s)"},{value:"save",label:"Save Model(s)"},{value:"-",label:"",disabled:!0},{value:"-",label:"Advanced",disabled:!0},{value:"custom",label:"Run a Skuid JavaScript Snippet"},{value:"publish",label:"Publish Event"}]}function L(a){ib.each(a,function(){Mb.push(this)})}function M(){return Mb}function N(a,b){var c,d=function(b){var c;return ib.each(b,function(b,d){return d.value===a?(c=d.label,!1):void 0}),c};return c=d(Mb)||d(b),c||a}function O(a){var b=a.component,c=a.propViewer,d=a.contextModelName,e=b.state,f=e.attr("type"),g=[];if(-1!==ib.inArray(f,["save","cancel","requeryModels"])){var h;"save"===f?h="Models to Save":"cancel"===f?h="Models to Cancel":"requeryModels"===f&&(h="Models to Query"),g.push({id:"models",label:h,type:"models"}),"save"===f&&g.push({id:"rollbackonanyerror",label:"Roll back entire save on any error",helptext:"If true, then if there is any error while saving any of the selected Models, then the entire save operation will be rolled-back, as if no part of it ever occurred. ",type:"boolean"})}else if("redirect"===f)g.push({id:"url",label:"URL",type:"template",location:"attribute"},{id:"window",type:"picklist",label:"Open URL in",defaultValue:"self",picklistEntries:[{label:"Current window",value:"self"},{label:"Blank window",value:"blank"},{label:"Parent window",value:"parent"}]});else if("publish"===f)g.push({id:"event",label:"Event name",type:"string"});else if("createRow"===f||"requeryModel"===f)g.push({id:"model",label:"Model",type:"model",location:"attribute"});else if("adoptRows"===f)g.push({id:"sourcemodel",label:"Source Model",type:"model",location:"attribute"},{id:"targetmodel",label:"Target Model",type:"model",location:"attribute"});else if("updateRow"===f){g.push({id:"fieldmodel",label:"Model",type:"model",location:"attribute"});var i=kb.getConditionFieldPropObj(b,{handleChange:function(){c&&b.renderProperties&&b.renderProperties(c),b.rebuildProps&&b.rebuildProps()},modelprop:"fieldmodel"});g.push(i),b.isUpdateAction=!0,g.push({id:"value",type:"string",label:"Value",metadata:kb.getMetadataForField(b)})}else if("custom"===f)g.push({id:"snippet",label:"Name of Snippet to run",type:"string",location:"attribute"});else if(-1!==ib.inArray(f,["setCondition","activateCondition","deactivateCondition"])){g.push({id:"model",label:"Model",type:"model",location:"attribute",onChange:function(a,d,e){d!==!0&&e&&(b.refresh(),c&&b.renderProperties&&b.renderProperties(c),b.rebuildProps&&b.rebuildProps())}});var j=e.attr("model");j||(j=kb.getFirstModel(),j=j?j.attr("id"):null),g.push({id:"condition",label:"Condition",type:"condition",modelName:j,location:"attribute"}),"setCondition"===f&&g.push({id:"value",label:"Value",type:"template",location:"attribute",modelName:d})}return g}function P(b,c){var d=[{id:"id",type:"string",label:"Model Id",helptext:"A unique identifier for this Model. Can only contain letters, numbers, or underscores.",validator:function(a){return kb.validators.modelId(a,b)},onChange:function(c,d){b.headerTitle?b.headerTitle.text(b.builder.name+" - "+c):b.element&&(b.element.find(".nx-pagebuilder-modeltag").children().eq(1).text(c),b.element.find(".nx-pagebuilder-fieldtag").attr("data-model",c)),kb.publishStateEvent({type:"model.idChange",oldId:d,newId:c}),a.events.publish("skuidBuilderRefreshModelList")}},{id:"sobject",type:"sobject",label:"SObject Type",onChange:function(){b.refresh(),a.mobile&&a.mobile.processResponsiveElements()}}],e=[{id:"limit",type:"string",label:"Max # of records (Limit)",helptext:"The maximum number of data records to pull in to this Model, out of all data records that match the Model's Conditions."},{id:"orderby",type:"string",label:"Fields to order records by",helptext:"How to order the data records pulled in to this Model, e.g. 'LastName DESC, FirstName' would order by LastName going from Z to A, then by FirstName going from A to Z (this is the ORDER BY clause of the generated SOQL statement)."},{id:"createrowifnonefound",type:"boolean",label:"Create default row if Model has none",helptext:"Typically used for Pages functioning as Overrides for the 'New' action. If true, then when this Page loads, if no data records exist in the Model, then a default row will be automatically created."},{id:"query",type:"boolean",label:"Load Model data on page load",helptext:"Typically this should be true, unless this Model will be used as a Calendar component Event Source. If false, then no data rows will be loaded in to this Model when the page initially loads.",onChange:function(){b.rebuildProps&&b.rebuildProps(),b.renderProperties&&b.renderProperties(c)}}];return"false"!==b.state.attr("query")&&e.push({id:"doclone",type:"picklist",label:"Clone Model data",helptext:"Should all data loaded into this Model on page load be 'cloned', meaning that data in the Model will be marked as 'New' so that when the Model is saved, new records will be created, rather than updates made to existing records?",picklistEntries:[{label:"Yes",value:"yes"},{label:"Yes, if 'clone' parameter is present in URL",value:""},{label:"No",value:"no"}],defaultValue:""}),e.push({id:"type",type:"picklist",label:"Model Type",picklistEntries:[{label:"Basic",value:""},{label:"Aggregate",value:"aggregate"}],defaultValue:"",onChange:function(){b.state.children("fields, groupby").empty(),b.save().refresh()}},{id:"queryallrows",type:"boolean",label:"Query Deleted / Archived records",helptext:'For developers: adds the SOQL "ALL ROWS" clause to your query. If true, then deleted records and/or archived Tasks will be included in your Model\'s query --- by default, they are not.'},{id:"forview",type:"boolean",label:'Update Salesforce "Recently Viewed" info',helptext:"For developers: adds the SOQL \"FOR VIEW\" clause to your query. Use this if you want this Model to feed into Salesforce's tracking of Recently Viewed Items. When this Model's query is run, the LastViewedDate for all records in this Model will be updated, and new records will be added to the RecentlyViewed object. "}),[{name:"Basic",props:d},{name:"Advanced",props:e}]}function Q(a,b,c,d){var e,f,g=kb.getModelFromModelName(b),h=g?"aggregate"==g.attr("type"):!1,i=a.state,j=i.attr("type"),k=i.attr("id"),l=k&&-1!=k.indexOf("."),m=k?kb.getFieldInfoFromCache(b,k):!1,n=m?m.displaytype:!1,o=kb.getSObjectNameFromModelName(b),p='The desired width of this column, relative to the total width available to its containing table. This is an Approximate width, as the actual width may be different depending on how much room the HTML table has available to it. A percentage (e.g. 25%) is recommended, but a pixel amount, e.g. "200px" is also possible --- however, do NOT mix and match pixels/percents among columns in the table.';if("COMBO"===j||"CHILDREL"===j){if(e=[{id:"label",type:"template",label:"Label",onChange:function(){a.refresh()}},{id:"template",type:"template",label:"Template",onChange:function(){a.refresh()}},{id:"allowhtml",type:"boolean",label:"Allow HTML",defaultValue:!1,onChange:function(){a.refresh()}},{id:"valuehalign",type:"picklist",label:"Horizontal Alignment",helptext:"(Optional) The alignment of the field value within its container. Defaults to Left.",picklistEntries:[{label:"Left (default)",value:""},{label:"Right",value:"right"}],defaultValue:""},{id:"readonly",type:"boolean",label:"Read-only",defaultValue:!1,onChange:function(){a.rebuildProps()}}],"skootable"===c&&(e.push({id:"columnwidth",type:"string",label:"Column Width",helptext:p}),"COMBO"===j&&(e.push({id:"allowordering",type:"boolean",label:"Allow Ordering",onChange:function(){a.rebuildProps()}}),"true"===i.attr("allowordering")&&e.push({id:"orderfield",type:"field",label:"Order Field",sobject:o}))),"true"!==i.attr("readonly")&&"COMBO"===j&&"basicfieldeditor"===c&&(e.push({id:"editmodebehavior",type:"picklist",label:"Edit Mode behavior",defaultValue:"autopopup",picklistEntries:[{label:"Show default Popup",value:"autopopup"},{label:"Show custom Popup",value:"custompopup"}],onChange:function(){a.rebuildProps()}}),"custompopup"===i.attr("editmodebehavior"))){var q=jb.desktop.makePopupBuilder({title:"Template Field Edit Mode Popup Properties",linkedComponent:a,makePropsEditor:function(a,b){var c={id:"title",type:"template",location:"attribute",label:"Popup Title",onChange:function(a){b.element.dialog("option","title",a)}},d={id:"width",type:"string",label:"Width (% or px)",defaultValue:"450",onChange:function(a){b.element.dialog("option","width",a)}};return jb.desktop.buildPropsEditor(b.state,[c,d])}}),r=i.children("editmodepopup");if(0===r.length){var s,t=i.children("template").text();t.length&&(s=lb.extractFieldsFromTemplate(t,{ignoreGlobals:!0})),r=q.defaultStateGenerator({id:"editmodepopup",title:i.children("label").text()||"Template Field",width:"450",childComponents:mb('<basicfieldeditor showsavecancel="false" mode="edit" model="'+b+'"><columns><column width="100%"><sections><section title=""><fields>'+(s.length?'<field id="'+s.join('"/><field id="')+'"/>':"")+"</fields></section></sections></column></columns></basicfieldeditor>")}),i.append(r)}a.editModePopupComponent=kb.componentFactory(r,q,!0),e.push({id:"editmodepopup",type:"customaction",label:"Configure Edit Mode Popup",icon:"sk-bi-popup",customAction:function(){a.editModePopupComponent.select()}})}"CHILDREL"===j&&e.push({id:"delimiter",type:"string",label:"Delimiter"}),f=[{name:"Basic",props:e}]}else{var u=[];n&&("PICKLIST"===n?(u.push({label:"Standard",value:""}),u.push({label:"Radio Buttons",value:"RADIO_BUTTONS"})):"MULTIPICKLIST"===n?(u.push({label:"Standard",value:""}),u.push({label:"Checkboxes",value:"CHECKBOXES"})):"REFERENCE"===n?"skuid__Image__c"===m.ref?u.push({label:"File Upload",value:""}):(u.push({label:"Auto-Complete",value:""}),u.push({label:"Picklist",value:"REFPICK"})):u.push("DATE"===n?{label:"Standard",value:""}:{label:"Standard",value:""})),u.push({label:"Custom (run a Snippet)",value:"CUSTOM"});var v;v="mobilefield"===c?{id:"id",type:"field",label:"Field",modelname:b,filter:function(a,b){var c,d=!0;return c=g.children("fields,groupby").find("REFERENCE"!==a.displaytype?'field[id="'+lb.escapeSelector(b+a.id)+'"]':'field[id^="'+lb.escapeSelector(b+a.rel+".")+'"]'),0===c.length&&(d=!1),d},onChange:function(b){a.element.attr("data-field",b),a.state.removeAttr("type"),a.save().refresh().renderProperties(d)}}:{id:"id",type:"readonly",label:"Field Id"};for(var w={id:"type",type:"picklist",label:"Field Renderer",defaultValue:"",picklistEntries:u,onChange:function(){a.save().refresh(),a.rebuildProps&&a.rebuildProps(),a.renderProperties&&a.renderProperties(d)}},x={id:"name",type:"readonly",label:"Field Alias Name"},y={id:"label",type:"template",location:"node",label:"Custom Label",onChange:function(){a.refresh()}},z={id:"optionsource",type:"picklist",label:"Option Source",defaultValue:"",picklistEntries:[{label:"Automatic",value:""},{label:"Model",value:"model"}],onChange:function(){i.removeAttr("displaytemplate"),"undefined"!=typeof i.attr("optionmodel")&&i.removeAttr("optionmodel"),a.refresh(),a.rebuildProps&&a.rebuildProps(),a.renderProperties&&a.renderProperties(d)}},A={id:"optionmodel",type:"model",label:"Option Model",objectTypeFilter:m?m.ref:!1,onChange:function(b,c){c!==!0&&(i.removeAttr("displaytemplate"),a.refresh(),a.rebuildProps&&a.rebuildProps(),a.renderProperties&&a.renderProperties(d))}},B={id:"displaytemplate",type:"template",label:"Display Template",modelprop:"optionmodel",fieldContext:m?m:null,fieldId:k,location:"attribute",helptext:'The fields from related records to display, specified using Merge syntax, e.g. "{{Name}} - {{Industry}}" would show the Name and Industry of related Accounts, if this is the AccountId field. Fields can be easily added using the Merge-Field Picker to the right.'},C={id:"allowordering",type:"boolean",label:"Allow Ordering"},D={id:"columnwidth",type:"string",label:"Column Width",helptext:p},E={id:"summaries",location:"node",type:"multipicklist",storeAs:{type:"node",name:"summary"},label:"Column Summaries",helptext:"Choose one or more summary type(s) for this field. Summaries are displayed at the bottom of a table.",picklistEntries:[{label:"Sum",value:"sum"},{label:"Average",value:"avg"},{label:"Min",value:"min"},{label:"Max",value:"max"},{label:"Median",value:"med"}],noneSelectedText:"Select Summary Type(s)...",onChange:function(){a.rebuildProps&&a.rebuildProps(),a.renderProperties&&a.renderProperties(d)}},F={id:"countBlanks",type:"boolean",label:"Count Blanks in Summaries",helptext:"Set this to true if you  want blank values to be counted in summary calculations."},G={id:"readonly",type:"boolean",label:"Read-only",readonly:l||(m?m.calculated:!1),defaultValue:l||(m?m.calculated:!1)},H={id:"required",type:"boolean",label:"Required",defaultValue:(m?m.required:!1)&&!l,readonly:(m?m.required:!1)||(m?m.calculated:!1),onChange:function(){n&&("PICKLIST"===n||"REFERENCE"===n&&"REFPICK"===i.attr("type"))&&(a.save().refresh(),a.rebuildProps&&a.rebuildProps(),a.renderProperties&&a.renderProperties(d))}},I={id:"addnoneoption",type:"boolean",label:'Add "None" option',helptext:'When a Picklist is required, Skuid normally does not add a "--None--" option at the beginning of the list of options, and instead will auto-select the first available Picklist option if none has yet been selected. There is then no way for the user to go back to "--None--". This is sometimes undesirable and can lead to bad data, because users will not realize that an option was auto-selected and therefore will not select an accurate option. Checking this property will add a "--None--" option at the top of the list, which will be selected by default.',defaultValue:!1},J={id:"fastsearch",type:"boolean",label:"Fast Search",defaultValue:!1,helptext:"Use a STARTSWITH search instead of a CONTAINS search on text fields."},K={id:"tokenizesearch",type:"boolean",label:"Tokenize autocomplete search",defaultValue:!1,helptext:"Search separately on each term, rather than requiring a field to contain a match on the whole search string entered."},L={id:"maxdisplaycharacters",type:"string",label:"Max Characters to Display",helptext:"(Read Mode only) The maximum number of characters that will be displayed for this textarea in Read mode before the text is curtailed with '...'"},M={id:"decimalplaces",type:"picklist",label:"# of Decimal Places",helptext:"(Optional) The number of decimal places / digits to show in Read mode. Defaults to the number of decimal places configured in the Salesforce field's metadata.",picklistEntries:[{label:"(Use field metadata)",value:""}],defaultValue:""},N={id:"valuehalign",type:"picklist",label:"Horizontal Alignment",helptext:"(Optional) The alignment of the field value within its container.",picklistEntries:[{label:"Left (default)",value:""},{label:"Right",value:"right"}],defaultValue:""},O={id:"snippet",type:"string",label:"Render Snippet Name",helptext:'The name of a Skuid Snippet to run that will serve as a "Custom Renderer". Snippets are named JavaScript functions, and can be created by going to the Resources tab and creating a new JavaScript Resource of type "Inline (Snippet)". If your Resource Name is "CustomDatepicker", then you should enter "CustomDatepicker" here.'},P={id:"showhelp",type:"boolean",label:"Show Inline Help",defaultValue:!0,helptext:"If true, Inline Help Text for this field will be shown."},Q={id:"maxselected",type:"string",label:"Max selectable items (optional)",helptext:"The maximum number of picklist items that a user can select. By default, the user can select as many items as they want."},R=0;9>R;R++)M.picklistEntries.push({value:R+"",label:R+""});
if(!k)return f=[{name:"Basic",props:[v]}];var S,T;"skootable"===c?(S={TEXTAREA:[v,y,G,H,L,D,N,w],REFERENCE:[v,y,C,G,H,D,N,w],DEFAULT:[v,y,C,G,H,D,N,w],MULTIPICKLIST:[v,y,G,H,D,Q,N,w],BOOLEAN:[v,y,C,G,w,N,D],INTEGER:[v,y,C,E,G,H,D,N,w],DOUBLE:[v,y,C,E,G,H,D,M,N,w],PERCENT:[v,y,C,E,G,H,D,M,N,w],CURRENCY:[v,y,C,E,G,H,D,M,N,w]},T={REFERENCE:[z,B],DEFAULT:[]},i.children("summaries").children("summary").length>0&&(S.DOUBLE=[v,y,C,E,F,G,H,D,M,N,w],S.INTEGER=[v,y,C,E,F,G,H,D,M,N,w],S.PERCENT=[v,y,C,E,F,G,H,D,M,N,w],S.CURRENCY=[v,y,C,E,F,G,H,D,M,N,w])):(S={TEXTAREA:[v,y,P,G,H,L,N,w],REFERENCE:[v,y,P,G,H,N,w],BOOLEAN:[v,y,P,G,N,w],MULTIPICKLIST:[v,y,P,G,H,Q,N,w],DOUBLE:[v,y,P,G,H,M,N,w],PERCENT:[v,y,P,G,H,M,N,w],CURRENCY:[v,y,P,G,H,M,N,w],DEFAULT:[v,y,P,G,H,N,w]},T={REFERENCE:[z,B],DEFAULT:[]}),("PICKLIST"===n||"REFERENCE"===n&&"REFPICK"===j)&&(m&&m.required||"true"===i.attr("required"))&&(S[n]="skootable"===c?[v,y,C,G,H,I,D,N,w]:[v,y,P,G,H,I,N,w]),"basicfieldeditor"===c&&m&&(m.inlineHelpText?"undefined"==typeof i.attr("showhelp")&&i.attr("showhelp","true"):ib.each(S,function(a,b){b.splice(2,1)})),"model"===i.attr("optionsource")&&T.REFERENCE.push(A),i.attr("type")||T.REFERENCE.push(J,K),e=(S[n]||S.DEFAULT).slice(0);var U=(T[n]||T.DEFAULT).slice(0);if("CUSTOM"===i.attr("type")&&e.push(O),h){S={TEXTAREA:[v,x,y,D,L,N],DOUBLE:[v,x,y,D,M,N],PERCENT:[v,x,y,D,M,N],CURRENCY:[v,x,y,D,M,N],DEFAULT:[v,x,y,D,N]},e=(S[n]||S.DEFAULT).slice(0);var V=g.children("fields").children('[name="'+lb.escapeSelector(i.attr("name"))+'"]');V&&V.length&&e.push(E),i.children("summaries").children("summary").length>0&&e.push(F),e.push(w),f=[{name:"Basic",props:e}]}else if("REFERENCE"===n){var W=[{label:"Search Properties",linkedComponent:a,deleteable:!1,props:U}];1===m.referenceTo.length&&W.push(cc({sobject:m.ref,linkedComponent:a,isReference:!0})),f=[{name:"Basic",props:e},{name:"Search",tree:W}]}else f=[{name:"Basic",props:e},{name:"Advanced",props:U}];h||"REFERENCE"!==n||f.push({name:"Filters",tree:{id:"filters",label:"Lookup Filters",linkedComponent:a,deleteable:!1,icon:"sk-bi-filters",isChild:!0,children:[{id:"filter",labelFunction:function(a){return kb.getConditionDisplayString(a)},defaultStateFunction:function(){return mb('<filter type="fieldvalue" operator="=" enclosevalueinquotes="true"/>')},propsFunction:function(a){var b=a.state;b.attr("operator")||b.attr("operator","="),a.isLookupFilterCondition=!0;var c=kb.getMetadataForField(a);if(!c&&b.attr("field")){var e=kb.getSObjectForField(a);if(-1===e.indexOf(","))return kb.getFields(e,function(){a.rebuildProps&&a.rebuildProps(),a.renderProperties&&a.renderProperties(d)}),[]}var f=[kb.getConditionFieldPropObj(a,{sobject:kb.getSObjectForField(a),showObjectPickerIfPolymorphic:!0,handleChange:function(){a.rebuildProps&&a.rebuildProps(),a.renderProperties&&a.renderProperties(d)}}),kb.getConditionOperatorPropObj(a,{fieldMetadata:c})];return f.concat(kb.getConditionValueProperties(a,{handleRefresh:function(){a.rebuildProps&&a.rebuildProps(),a.renderProperties&&a.renderProperties(d)},validTypes:["fieldvalue","multiple","blank","userinfo","param","modelmerge","dependent"]}))}}]}})}return"skootable"!==c&&f.push(Z(d,b,a)),f}function R(a,b,c,d){d=d||{};var e,f=a.state,g=f.attr("type"),h=[],i=[],j=d.onActionTypeChange,k=d.additionalActionOptions,l=ib.merge([],M());if(k&&k.length&&(l.push({value:"-",label:"",disabled:!0}),l.push({value:"-",label:"Additional actions",disabled:!0}),ib.each(k,function(){l.push(this),this.props&&this.props.length&&g===this.value&&ib.each(this.props,function(){i.push(this)})})),h.push({id:"type",label:"Action Type",type:"picklist",options:l,onChange:function(b){a.refresh().rebuildProps(),j&&j(b)}}),"showPopup"===g){if(e=a.popup,!e){var m=f.children("popup"),n=jb.desktop.popupbuilder;0===m.length&&(m=n.defaultStateGenerator(),f.append(m)),e=a.popup=kb.componentFactory(m,n,!0)}h.push({type:"customaction",label:"Configure Popup",icon:"sk-bi-popup",customAction:function(){e.select()}})}else if("blockUI"===g){h.push({id:"message",type:"string",label:"Message"});for(var o={id:"timeout",type:"picklist",label:"Timeout (seconds)",picklistEntries:[{label:"Never",value:""}]},p=1;20>=p;p++)o.picklistEntries.push({value:500*p,label:p/2});h.push(o)}var q=kb.getCoreActionProperties({propViewer:b,component:a,contextModelName:c});return q.length&&ib.each(q,function(a,b){h.push(b)}),i.length&&ib.each(i,function(a,b){h.push(b)}),h}function S(a){a||(a={});var b=a.treeNode||{},c=a.propViewer,d=a.useModelName,e=b.indent||0;return ib.extend(b,{id:"action",addtooltip:"Add on-error Action",deletetooltip:"Remove Action",labelFunction:function(b){return kb.getActionLabel(b.attr("type"),a.additionalActionOptions)},defaultStateFunction:function(){return mb('<action type="save"/>')},propsFunction:function(b){return R(b,c,d,a)},childrenFunction:function(b){var f=[],g=b.state,h=g.attr("type");return-1!==ib.inArray(h,["save","requeryModel","requeryModels","custom"])&&f.push({id:"action",labelFunction:function(b){return kb.getActionLabel(b.attr("type"),a.additionalActionOptions)},invisibleParent:"onerroractions",indent:1+e,icon:"sk-bi-action-error",addicon:"sk-bi-action-error",deletetooltip:"Remove on-error Action",propsFunction:function(b){return R(b,c,d,{additionalActionOptions:a.additionalActionOptions})},defaultStateFunction:function(){return mb('<action type="blockUI" message="There was an error" timeout="3000"/>')}}),f}}),b}function T(a){a||(a={});var b=a.linkedComponent,c=!1;return b&&a.refreshLinkedComponent&&(c=!0),{name:a.label||"Actions",tree:{id:"actions",label:a.label||"Actions",deleteable:!1,props:a.props,linkedComponent:b,refreshLinkedComponent:c,icon:"sk-icon-component-pack",addtooltip:"Add Action",isChild:!0,childrenFunction:function(b){return[S({component:b,propViewer:a.propViewer,useModelName:a.useModelName,additionalActionOptions:a.additionalActionOptions})]}}}}function U(a){a||(a={});var b=a.propViewer,c=a.useModelName,d=a.allowChildActions||!1,e=a.id||"hotkeys",f=a.label||"Hotkeys",g={id:"hotkey",deletetooltip:"Remove Hotkey",labelFunction:function(a){var b=a.attr("modifiers"),c=a.attr("key"),d="";return b&&ib.each(b.split(","),function(a,b){ib.each(Nb,function(){return this.value===b?(d+=this.label+"+",!1):void 0})}),ib.each(Qb,function(){return this.value===c?(d+=this.label,!1):void 0}),d},defaultStateFunction:function(){return mb('<hotkey modifiers="ctrl" key="n"/>')},propsFunction:function(a){var c=function(){a.refresh&&a.refresh()},d=[{id:"modifiers",location:"attribute",type:"multipicklist",label:"Modifiers",helptext:"Choose one or more modifiers that must be pressed at the same time as the principal hot key",picklistEntries:Nb,defaultValue:"ctrl",noneSelectedText:"Select Modifiers...",onChange:function(d){d&&"shift"!==d||(a.state.attr("ignoretextinputs","true"),a.save(),a.rebuildProps&&a.rebuildProps(),b&&a.renderProperties&&a.renderProperties(b)),c()}},{id:"key",type:"picklist",label:"Key",picklistEntries:Qb,defaultValue:"S",onChange:c},{id:"ignoretextinputs",type:"boolean",label:"Ignore Hot Key if user is typing in input element",helptext:"If true, then this Hot Key will be ignored while a user is entering text into any text input area. This option should be used if the Hot Key would conflict with typical data entry Hot Keys, such as arrow keys, copy/paste, etc."}];return d}};return d&&(g.childrenFunction=function(a){return[S({component:a,propViewer:b,useModelName:c,treeNode:{indent:1,invisibleParent:"actions"}})]},g.addtooltip="Add Hotkey Action"),{name:f,tree:{id:e,label:f,linkedComponent:a.linkedComponent,deleteable:!1,icon:"sk-icon-component-pack",addtooltip:"Add Hotkey",isChild:!0,children:[g]}}}function V(a){a.empty(),Sb[Tb]&&Sb[Tb].icons&&ib.each(Sb[Tb].icons,function(b){var c=b.substr(Tb.length+1),d=ib("<div>").addClass("nx-picker-icon "+Tb+" "+b).attr("alt",c).attr("title",c),e=ib('<div class="nx-picker-icon-label">').text(c);ib('<div class="nx-picker-icon-wrapper">').append(d,e).appendTo(a)})}function W(a,b,c){var d=function(a){Sb=a.iconsets,ib.each(Sb,function(a,b){var c=ib("<div>").addClass("nx-picker-header-category").text(b.label);c.data("category",a),Tb===a&&c.addClass("nx-picker-selected"),c.data("prefix",a),i.append(c)}),V(h)};Sb.length||kb.getIconsObject(d),a.addClass("nx-picker-wrapper").appendTo("body");var e=ib("<div>").addClass("nx-picker-header").appendTo(a),f=ib("<input>").addClass("nx-picker-filter-input").attr("type","text").appendTo(e),g=ib("<div>").addClass("nx-picker-cancel inline sk-icon sk-icon-cancel").css("cursor","pointer").css("margin","0px 5px 4px").skootip("Clear Filter Text").appendTo(e),h=ib("<div>").addClass("nx-picker-body").appendTo(a),i=ib("<div>").addClass("nx-picker-header-category-wrapper").appendTo(e);ib("<label>").text("Filter Icons: ").appendTo(e),i.on("click",".nx-picker-header-category",function(){var a=ib(this);i.find(".nx-picker-selected").removeClass("nx-picker-selected"),a.addClass("nx-picker-selected"),Tb=a.data("prefix"),V(h)}),lb.delayInputCallback(f,function(a){var b=h.parent();a=a.toLowerCase(),h.detach(),""===a?h.find(".nx-picker-icon-wrapper").show():(h.find("."+Tb).not('[alt*="'+a+'"]').parent().hide(),h.find("."+Tb+'[alt*="'+a+'"]').filter(":hidden").parent().show()),h.appendTo(b)}),h.skootip(),g.click(function(){f.val("").change()}),h.on("click",".nx-picker-icon-wrapper",function(){var d=ib(this).children("."+Tb).first().attr("alt");b.val(Tb+"-"+d).change(),c.empty().removeClass().addClass("nx-picker-icon "+Tb+" inline "+Tb+"-"+d),a.dialog("close")})}function X(a){var b=a.parent();if(b.length){if(b[0]&&"skuidpage"===b[0].nodeName)return!1;var c=bc(b);return c?c.builder&&c.builder.givesContext?c:X(b):X(b)}return!1}function Y(a,b,c){var d=X(b);if(!d)return!1;var e=d.contextModelName;return{name:"Context",isNew:!0,tree:{id:"conditions",label:"Context Conditions",deleteable:!1,icon:"sk-bi-contextconditions",isChild:!0,children:[{id:"condition",labelFunction:function(a){return(a.attr("field")||"Id")+" of record(s) = "+(a.attr("mergefield")||"Id")+" of row in context."},defaultStateFunction:function(){return mb('<condition type="contextrow" field="Id" mergefield="Id" />')},propsFunction:function(){var a,b=[];return c&&(a=c),a?(b.push({id:"field",type:"field",label:"Field",helptext:"The field on this component's model that will be checked against a field on the row in context.",modelname:a}),e&&b.push({id:"mergefield",type:"field",label:"Merge Field",helptext:"The field on the row in context that will be checked against a field on this component's model.",modelname:e}),b):!1}}]}}}function Z(a,b,c){return{name:"Rendering",isNew:!1,tree:{id:"renderconditions",label:"Render Conditions",deleteable:!1,icon:"sk-bi-renderconditions",isChild:!0,linkedComponent:c,children:[{id:"rendercondition",labelFunction:function(a){return kb.getConditionDisplayString(a)},defaultStateFunction:function(){return mb('<rendercondition type="fieldvalue" operator="=" enclosevalueinquotes="true"/>')},propsFunction:function(c){c.isRenderCondition=!0;var d,e,f=c.state,g=[];if(b&&(e=b),!e){if(f.attr("fieldmodel"))e=f.attr("fieldmodel");else{var h=kb.getLastSelectedModelComponent();e=h&&h.state?h.state.attr("id"):y().children().first().attr("id"),f.attr("fieldmodel",e)}var i={id:"fieldmodel",type:"model",label:"Source Model",helptext:"The Model whose 1st row will be examined to see if it matches this Condition.",onChange:function(){c.rebuildProps&&c.rebuildProps(),c.renderProperties&&c.renderProperties(a)}},j={id:"nosourcerowbehavior",type:"picklist",label:"If no row in Source Model...",helptext:"Specifies the action to take if no rows are returned by the source model.",defaultValue:"deactivate",picklistEntries:[{label:"Ignore this Condition",value:"deactivate"},{label:"Skip other Conditions, and render",value:"skipandrender"},{label:"Skip other Conditions, and don't render",value:"skipandnorender"}]};g.push(i,j)}d=kb.getMetadataForField(c);var k={showObjectPickerIfPolymorphic:!0,addFieldToModel:!0,handleChange:function(){c.rebuildProps&&c.rebuildProps(),c.renderProperties&&c.renderProperties(a)}};return f.attr("fieldmodel")?k.modelprop="fieldmodel":k.modelname=e,g.push(kb.getConditionFieldPropObj(c,k),kb.getConditionOperatorPropObj(c,{fieldMetadata:d})),g.concat(kb.getConditionValueProperties(c,{handleRefresh:function(){c.rebuildProps&&c.rebuildProps(),c.renderProperties&&c.renderProperties(a)},validTypes:["fieldvalue","multiple","blank","userinfo"]}))}}]}}}function $(a){var b={id:"id",type:"string",label:"Label Id"};return a&&a.onChange&&(b.onChange=a.onChange),[b]}function _(a){var b=a.attr("location"),c={};return"external"===b?ib.extend(c,{prefix:"(External)",name:a.attr("name")||a.attr("url")}):(c.name=a.attr("name"),c.prefix="(","inlinesnippet"===b?c.prefix+="Snippet":"inlinecomponent"===b?c.prefix+="Component":"inline"===b?c.prefix+="Inline":"staticresource"===b&&(c.prefix+="Static Resource"),c.prefix+=")"),c}function ab(a){var b=a.state,c={id:"location",type:"picklist",label:"Resource Location",defaultValue:"staticresource",picklistEntries:[{label:"Static Resource",value:"staticresource"},{label:"External",value:"external"},{label:"In-Line",value:"inline"},{label:"In-Line (Snippet)",value:"inlinesnippet"},{label:"In-Line (Component)",value:"inlinecomponent"}],onChange:function(c,d){"staticresource"===c?(b.attr("url",""),b.attr("cachelocation","false")):"external"!==c&&b.attr("url",""),c&&lb.startsWith(c,"inline")&&d&&d!==c&&(b.text()&&b.text()!==xb[d]||b.text(xb[c]),b.attr("name")&&b.attr("name")!==yb[d]||b.attr("name",yb[c])),a.save().refresh().rebuildProps()}},d={id:"name",type:"string",label:"Resource Name",onChange:function(){a.refresh()}},e={type:"code",syntax:"javascript",label:"Resource Body",divisionSize:"2"},f={id:"name",type:"string",label:"Snippet Name",onChange:function(){a.refresh()}},g={type:"code",syntax:"javascript",label:"Snippet Body",divisionSize:"2"},h={id:"name",type:"string",label:"Component Name",onChange:function(){a.refresh()}},i={type:"code",label:"Component Body",syntax:"javascript",divisionSize:"2"},j={id:"namespace",type:"string",label:"Namespace (if in managed package)",helptext:"ONLY needed if this StaticResource is included in a Managed Package."},k={id:"name",type:"string",label:"Resource Name (optional)",onChange:function(){a.refresh()}},l={id:"url",type:"string",label:"Resource URL",divisionSize:"2",onChange:function(){a.refresh()}},m={id:"cachelocation",type:"boolean",label:"Cache Resource Location",helptext:"Leave UNCHECKED unless the contents of your Static Resource are very stable and will not be changing."},n={id:"filepath",type:"string",label:"File Path (within Static Resource)",helptext:"The desired file's relative location within the Static Resource.",divisionSize:"2"},o={external:[c,k,l],inline:[c,d,e],inlinesnippet:[c,f,g],inlinecomponent:[c,h,i],staticresource:[c,d,j,m,n],DEFAULT:[c,d,j]};return o[a.state.attr("location")||"DEFAULT"]}function bb(a){return a.attr("name")||a.attr("url")||"[No CSS Item Name]"}function cb(a){var b={id:"location",type:"picklist",label:"Resource Location",defaultValue:"staticresource",picklistEntries:[{label:"Static Resource",value:"staticresource"},{label:"External",value:"external"},{label:"In-Line",value:"inline"}],onChange:function(b){"staticresource"===b?(a.state.attr("url",""),a.state.attr("cachelocation","true")):"external"!==b&&a.state.attr("url",""),a.refresh().rebuildProps()}},c={id:"name",type:"string",label:"Resource Name",onChange:function(){a.refresh()}},d={id:"namespace",type:"string",label:"Namespace (if in managed package)",helptext:"ONLY needed if this StaticResource is included in a Managed Package."},e={id:"name",type:"string",label:"Resource Name (optional)",onChange:function(){a.refresh()}},f={id:"url",type:"string",label:"Resource URL",divisionSize:"2",onChange:function(){a.refresh()}},g={type:"code",syntax:"css",label:"Resource Body",divisionSize:"2"},h={id:"cachelocation",type:"boolean",label:"Cache Resource Location",helptext:"Leave UNCHECKED unless the contents of your Static Resource are very stable and will not be changing."},i={id:"filepath",type:"string",label:"File Path (within Static Resource)",helptext:"The desired file's relative location within the Static Resource.",divisionSize:"2"},j={external:[b,e,f],inline:[b,c,g],staticresource:[b,c,d,h,i],DEFAULT:[b,c,d]};return j[a.state.attr("location")||"DEFAULT"]}function db(a){switch(a.attr("type")){case"select":return("true"===a.attr("createfilteroffoption")&&a.attr("filteroffoptionlabel")?a.attr("filteroffoptionlabel"):"Filter")+(a.attr("condition")?" - "+a.attr("condition"):"");case"toggle":return a.attr("label")||"Filter";case"daterange":var b="Range: ";return"auto"===a.attr("conditionsource")?b+=a.attr("conditionfield")||"(No field selected)":a.attr("startcondition")&&a.attr("endcondition")&&(b+=a.attr("startcondition")+" <-> "+a.attr("endcondition")),b}}function eb(a){var b=a.state,c=b.attr("type");a.modelName=gb(b);var d={id:"type",type:"picklist",label:"Filter Type",defaultValue:"select",picklistEntries:[{label:"Select Option",value:"select"},{label:"Toggle",value:"toggle"},{label:"Date Range",value:"daterange"}],onChange:function(){b.empty(),a.element.children(".nx-childwrapper").empty(),a.save().refresh().rebuildProps()}},e={id:"condition",label:"Model Condition to Affect",helptext:"The Condition on this Model whose values this Filter will affect by default -- unless specified otherwise in the Effects of this Filter's options.",modelName:a.modelName,type:"condition",onChange:function(b,c){a.refresh(),c&&ib.removeCookie(ob.getConditionCookieName(a.modelName,c,jb.pagebuilderui.row.Id))}},f={id:"conditionsource",type:"picklist",label:"Condition Source",defaultValue:"auto",picklistEntries:[{label:"Auto Generate Conditions",value:"auto"},{label:"Specify Existing Conditions",value:"manual"}],onChange:function(b,c){c&&c!==b&&a.save().refresh().rebuildProps()}},g={id:"conditionfield",type:"field",label:"Date/Datetime Field",displayTypeFilter:["DATE","DATETIME"],addFieldToModel:!0,modelname:a.modelName,onChange:function(){a.refresh()}},h={id:"startcondition",label:"Begin Model Condition",modelName:a.modelName,type:"condition",onChange:function(b,c){a.refresh(),c&&ib.removeCookie(ob.getConditionCookieName(a.modelName,c,jb.pagebuilderui.row.Id))}},i={id:"endcondition",label:"End Model Condition",modelName:a.modelName,type:"condition",onChange:function(b,c){a.refresh(),c&&ib.removeCookie(ob.getConditionCookieName(a.modelName,c,jb.pagebuilderui.row.Id))}},j={id:"affectcookies",label:"Remember last-selected filter value in cookies",helptext:"By default, Skuid will remember, for each user, the filter value that the user most recently selected. The value is stored a session cookie. Uncheck to disable this functionality.",type:"boolean",defaultValue:!0,onChange:function(){a.refresh().rebuildProps()}},k={id:"createfilteroffoption",label:'Create a "Filter Off" Option',helptext:"If checked, an option which turns off this filter will be added to the options list.",type:"boolean",onChange:function(){a.refresh().rebuildProps()}},l={id:"filteroffoptionlabel",label:'"Filter Off" Option Label',type:"string",helptext:'If desired, you can change the text of the "Filter Off" option, to be something like "Any Status", "Any Record Type", etc.',defaultValue:"New Filter",onChange:function(){a.refresh()}},m={id:"label",label:"Label",type:"string",onChange:function(){a.refresh()}},n={id:"autocompthreshold",label:"Switch Filter to Autocomplete at X Items",type:"number",defaultValue:"25",helptext:"By default, Select Option filters will become Autocompletes when the count of items in their list reaches 25. Change this amount if you'd like that to happen at a higher or lower number."},o={select:[d,e,j,k,n],toggle:[d,m,j],daterange:[d,f]};if("daterange"===c){var p=o.daterange;"manual"===(b.attr("conditionsource")||"auto")?p.push(j,h,i):p.push(g)}return"true"===b.attr("createfilteroffoption")&&o.select.push(l),o[c]}function fb(a){var b,c=a.attr("action");return b="set"===c?(a.attr("condition")||"[No Condition]")+" --> "+a.attr("value"):("activate"===c?"Activate ":"Deactivate ")+(a.attr("condition")||"[No Condition]")}function gb(a){var b,c=a.closest("skootable, queue, eventview");return c.is("skootable, queue")?b=c.attr("model"):c.is("eventview")&&(b=c.attr("groupingmodel")),b}function hb(a){var b=a.state;a.modelName=gb(b);var c={id:"action",type:"picklist",label:"Action",defaultValue:"activate",picklistEntries:[{label:"Activate and Set Value",value:"set"},{label:"Activate",value:"activate"},{label:"De-Activate",value:"deactivate"}],onChange:function(){a.refresh().rebuildProps()}},d={id:"condition",label:"Model Condition",modelName:a.modelName,type:"condition",onChange:function(b,c){a.refresh(),c&&ib.removeCookie(ob.getConditionCookieName(a.modelName,c,jb.pagebuilderui.row.Id))}},e=[c,d],f=b.parent().parent(),g=f&&f.is("source");return"set"===b.attr("action")&&(g&&"model"===f.attr("type")?e.push({id:"value",label:"Value to inject into Condition",type:"template",location:"attribute",displayAs:"input",defaultValue:"{{Id}}",onChange:function(){a.refresh()}}):g&&"metadata"===f.attr("type")||e.push({id:"value",label:"Value",type:"string",onChange:function(){a.refresh()}})),e}var ib=a.$,jb=a.builder={},kb=jb.core={},lb=a.utils,mb=lb.makeXMLDoc,nb=a.snippet,ob=a.model,pb=a.events.publish,qb={},rb={},sb=ib(),tb={},ub=function(){return kb.fieldsDescribeCache?(ib.each(kb.fieldsDescribeCache,function(a,b){lb.createMapForArray([b],"fields","fieldsMap",["id","name"])}),!0):!1};ib(function(){ub()||ib(document.body).one("pageload",function(){ub()})});var vb=/[^A-Za-z0-9_]+/g,wb=/[^A-Za-z0-9_]+/g;kb.validators={modelId:function(a,b){if(vb.test(a))return"Model Ids can only contain letters, numbers, or underscores.";var c=kb.getModelFromModelName(a);return c.length&&c[0]!==b[0]?"There is already another Model with this name.":!0},conditionName:function(a,b){if(wb.test(a))return"Condition Names can only contain letters, numbers, or underscores.";var c=B(a,b.state.closest("model").attr("id"));return c.length&&c[0]!==b[0]?'There is already another Condition with the name "'+a+'" on this Model."':!0}};var xb={inline:"(function(skuid){\n	var $ = skuid.$;\n	$(function(){\n		var myModel = skuid.model.getModel('MyModelId');\n		var myComponent = skuid.component.getById('MyComponentUniqueId');\n	});\n})(skuid);",inlinesnippet:"var params = arguments[0],\n	$ = skuid.$;\n",inlinecomponent:"var element = arguments[0],\n	$ = skuid.$;\n\nelement.html('Hello <b>world!</b>');"},yb={inline:"newInlineJS",inlinesnippet:"newSnippet",inlinecomponent:"newComponent"};kb.defaultStateGenerators={model:function(){return mb('<model id="'+b()+'" limit="20" query="true" createrowifnonefound="false"/>')},field:function(a){var b="string"==typeof a,d=b?a:a.id,e=mb('<field id="'+d+'"/>');if(!b&&a.needsAlias){var f=a.functionName;e.attr("name",a.alias?a.alias:c(d,f)),f&&e.attr("function",f)}return a.isRelationship&&e.attr({type:"childRelationship",limit:"10"}),e},label:function(a){return mb("<label"+(a?' id="'+a+'"':"")+"/>")},jsitem:function(){return mb('<jsitem location="inlinesnippet" name="newSnippet" cachelocation="false"/>').text(xb.inlinesnippet)},cssitem:function(){return mb('<cssitem location="inline" name="newcss" cachelocation="false"/>')},javascript:function(){return mb("<javascript/>")},labels:function(){return mb("<labels/>")},css:function(){return mb("<css/>")}},kb.coreProps={uniqueIdProp:function(a){var b={id:"uniqueid",type:"string",label:"Unique Id",helptext:"Optional parameter that gives this component's DOM element an id property."};return ib.extend(b,a||{})},cssClassProp:function(a){var b={id:"cssclass",type:"string",label:"CSS Class",helptext:"Optional parameter that gives this component's DOM element a CSS class."};return ib.extend(b,a||{})}},nb.registerSnippet("skuid.builder.page.preview",function(b){var c,d,e=b.model,f=b.row||e.getFirstRow(),g=b.saveFirst===!0,h=b.editor,i=ib("body"),j=!1,k=!1,l=function(b){a.mobile||(d=window.open(b||""))},m=function(b,c){var e="/apex/skuid__ui?page="+b.Name+(c?c:"");a.mobile?lb.redirect({url:e,title:"Page: "+b.Name}):d?d.location=e:l(e)},n=function(){var b=ib("<div>").addClass("nx-basicfieldeditor nx-editor-contents");a.mobile,b.append(ib("<div>").css({border:"solid 1px #ddd",backgroundColor:"#efefef",padding:"6px",marginBottom:"10px"}).html("Click Go to preview the page '"+f.Name+"'"+(a.mobile?"":" in a new window")));var c=function(){m(f)},d="Preview Page: "+f.Name;b.dialog({width:300,height:200,title:d,resizable:!1,modal:!0,close:function(){ib(this).remove()},buttons:[{text:"Go",id:"PreviewWindowGo",click:function(){c(),ib(this).remove()}},{text:"Cancel",id:"PreviewWindowCancel",click:function(){ib(this).remove()}}]})},o=function(){var b=c.children("models").find('condition[type="param"]');if(b.length){var d={},e={},h=[];b.each(function(){var a=ib(this),b=a.attr("value");if(!b||b.toLowerCase()in d||"true"===a.attr("inactive"))return!0;var c,f,g=a.closest('condition[type="join"][joinobject]'),i=a.attr("field");if(g.length?f=g.attr("joinobject"):(c=a.closest("model"),f=c.attr("sobject")),f){var j=kb.fieldsDescribeCache[f],k=!j,l=i&&j&&j.fieldsMap&&!j.fieldsMap[i];k?e[f]={}:l&&(e[f]=ib.extend({},j)),i&&(k||l)&&(e[f][i]=1)}h.push(a)});var l=function(){ib.each(h,function(){var a,b=ib(this),c=b.attr("value"),e=b.attr("field"),f=b.closest('condition[type="join"][joinobject]'),g=b.closest("model");a=f.length?f.attr("joinobject"):g.attr("sobject");var h,i=ib.extend(!0,{},kb.getFieldInfoFromCache(g,e,a));if("ID"===i.displaytype){var j=c+"__FakeLookup";i.id=j+"__c",e=i.id,ib.extend(i,{editable:!0,filterable:!0,displaytype:"REFERENCE",ref:a,rel:j+"__r"}),h={id:i.rel+"."+lb.getNameField(a)}}else"REFERENCE"===i.displaytype?h={id:i.rel+"."+lb.getNameField(i.rel)}:"PICKLIST"===i.displaytype&&(i.displaytype="TEXT");i.createable=!0,i.editable=!0,!c||c.toLowerCase()in d||(d[c.toLowerCase()]={field:e,fieldInfo:i,refInfo:h,sobject:a})});var b=ib("<div>").addClass("nx-basicfieldeditor nx-editor-contents").prepend(ib("<div>").css({border:"solid 1px #ddd",backgroundColor:"#efefef",padding:"6px",marginBottom:"10px"}).html('A condition was set for this page that references a URL parameter. Please provide a sample value for that URL Parameter so that the Page will behave appropriately.<br/><br/>If the Parameter is on a Reference field, please enter the Name (e.g. "ACME"), not the Id, in the Autocomplete. Skuid will grab the related record and use its Id for the preview.'));ib.each(d,function(c){var d=ib("<div>").addClass("nx-basicfieldeditor-item nx-pagebuilder-property-item");b.append(d);var e=ib("<div>").addClass("nx-basicfieldeditor-item-label").text(c+(this.fieldInfo.ref?" ("+(-1!==this.fieldInfo.ref.indexOf(",")?"multiple objects":this.fieldInfo.ref)+")":""));d.append(e),ob.registerModel("tempModelPreview",{fields:this.refInfo?[this.fieldInfo,this.refInfo]:[this.fieldInfo],data:[],conditions:[],createRowIfNoneFound:!0,objectName:this.sobject});var f=ob.getModel("tempModelPreview");ob.initializeModel(f);var g=f.getFirstRow(),h={fieldId:this.field,mode:"edit",fastsearch:"true"},i=new a.ui.Field(g,f,!1,h);i.metadata=this.fieldInfo,i.element.addClass("nx-previewfield").data("param",c),i.render(),d.append(i.element)});var c=function(a){var c=b.find(".nx-previewfield"),d="",e=[];c.each(function(){var a=ib(this).data("param"),b=ib(this).data("object"),c=b.row[b.id];return!c||c&&b&&-1!==ib.inArray(b,["ID","REFERENCE"])&&c.length<15?(e.push("Please select a value for Parameter "+a),!0):void(c&&(d+="&"+a+"="+encodeURIComponent(c)))});var g=b.find(".nx-messages");e.length?(g.length?g.empty():g=ib('<div class="nx-messages"/>').appendTo(b),ib.each(e,function(){g.append(ib('<div class="nx-property-error">'+this+"</div><br/>"))})):(m(f,d),g.length&&g.empty().hide(),a.remove())},e="Set Parameters needed to View Page: "+f.Name;b.dialog({width:500,height:400,title:e,resizable:!1,modal:!0,close:function(){ib(this).remove()},buttons:[{text:"Go",id:"PreviewWindowGo",click:function(){c(ib(this))}},{text:"Cancel",id:"PreviewWindowCancel",click:function(){ib(this).remove()}}]})},o=ib.Deferred(),p=lb.size(e);p?(j=!0,i.block({message:"Retrieving metadata for fields associated with URL Parameter Conditions..."}),ib.each(e,function(a){a&&kb.getFields(a,function(){delete e[a],lb.size(e)||o.resolve()})})):o.resolve(),ib.when(o).then(function(){p&&i.unblock(),l()})}else j||k||g?n():m(f)},p=ib.Deferred();if(b.xml)c=b.xml,p.resolve();else{var q,r=!0;ib.each(kb.layoutFields,function(a,b){return e.getField(b)?void 0:(r=!1,!1)}),r?p.resolve():(k=!0,i.block({message:"Loading page layout data to check for required parameters..."}),q=new ob.Model({objectName:e.objectName,conditions:[{field:"Id",value:f.Id}],doQuery:!0,id:"TempPageLayoutFieldsModel"+(new Date).getTime()}),ib.each(e.fields,function(a,b){q.fields.push({id:b.id})}),ib.each(kb.layoutFields,function(a,b){e.getField(b)||q.fields.push({id:b})}),q.initialize(),p=q.updateData())}ib.when(p).then(function(){if(q&&(e.adoptRow(q.getFirstRow()),f=e.getRowById(f.Id),i.unblock()),!c){var a=e.getFieldValues(f,kb.layoutFields,!0).join("");if(!a)return void window.alert("This page does not have any layout yet. Please continue building your page before previewing.");c=mb(a)}if(g){i.block({message:"Saving Page..."});var b=function(a){i.unblock(),a.totalsuccess&&o()};h?h.save({callback:function(a){b(a)}}):e&&e.save({callback:function(a){b(a)}})}else o()})}),d.prototype.renderComponent=function(a,b){this.componentRenderer?this.componentRenderer(a,b):e(a,b)},d.prototype.renderProperties=function(a,b){this.propertiesRenderer?this.propertiesRenderer(a,b):f(a,b)},d.prototype.getDefaultState=function(a){return this.defaultStateGenerator?this.defaultStateGenerator(a):mb("<"+this.id+"/>")};var zb={},Ab=["STRING","TEXTAREA","PHONE","EMAIL","PICKLIST","URL","COMBOBOX","BASE64"],Bb=["STRING","TEXTAREA","PHONE","EMAIL","PICKLIST","URL","COMBOBOX","BASE64","DATE","DATETIME","DOUBLE","INTEGER","PERCENT","CURRENCY","TIME"],Cb={name:"=",longname:"is",validFor:["fieldvalue","param","userinfo","blank","modelmerge","dependent"]},Db={"":Cb,"=":Cb,"!=":{name:"!=",longname:"is not",validFor:["fieldvalue","param","userinfo","blank","modelmerge","dependent"]},gt:{name:">",longname:"is greater than",validFor:["fieldvalue","param","userinfo","modelmerge","dependent"],validForDisplayTypes:Bb},lt:{name:"<",longname:"is less than",validFor:["fieldvalue","param","userinfo","modelmerge","dependent"],validForDisplayTypes:Bb},gte:{name:">=",longname:"is greater than or equal to",validFor:["fieldvalue","param","userinfo","modelmerge","dependent"],validForDisplayTypes:Bb},lte:{name:"<=",longname:"is less than or equal to",validFor:["fieldvalue","param","userinfo","modelmerge","dependent"],validForDisplayTypes:Bb},"in":{name:"in",longname:"is in the set of values",validFor:["modelmerge","multiple","join"]},"not in":{name:"not in",longname:"is not in the set of values",validFor:["modelmerge","multiple","join"]},includes:{name:"includes",longname:"includes one or more of these values",validFor:["fieldvalue","param","userinfo","modelmerge","dependent","multiple"],validForDisplayTypes:["MULTIPICKLIST"]},excludes:{name:"excludes",longname:"does not include any of these values",validFor:["fieldvalue","param","userinfo","modelmerge","dependent","multiple"],validForDisplayTypes:["MULTIPICKLIST"]},"starts with":{name:"starts with",validFor:["fieldvalue","param","userinfo","modelmerge","dependent"],validForDisplayTypes:Ab},"ends with":{name:"ends with",validFor:["fieldvalue","param","userinfo","modelmerge","dependent"],validForDisplayTypes:Ab},contains:{name:"contains",validFor:["fieldvalue","param","userinfo","modelmerge","dependent"],validForDisplayTypes:Ab},"does not contain":{name:"does not contain",validFor:["fieldvalue","param","userinfo","modelmerge","dependent"],validForDisplayTypes:Ab},"does not start with":{name:"does not start with",validFor:["fieldvalue","param","userinfo","modelmerge","dependent"],validForDisplayTypes:Ab},"does not end with":{name:"does not end with",validFor:["fieldvalue","param","userinfo","modelmerge","dependent"],validForDisplayTypes:Ab}},Eb={defaultcurrency:{label:"Default Currency"},firstname:{label:"First Name"},lastname:{label:"Last Name"},email:{label:"Email"},locale:{label:"Locale"},name:{label:"Name",value:"name"},organizationid:{label:"Organization Id"},organizationname:{label:"Organization Name"},profileid:{label:"Profile Id"},sessionid:{label:"Session Id"},userid:{label:"User Id"},username:{label:"User Name"},userroleid:{label:"User Role Id"},usertype:{label:"User Type"},ismulticurrencyorganization:{label:"Is Multi Currency Org"}},Fb={YESTERDAY:{label:"Yesterday"},TODAY:{label:"Today"},TOMORROW:{label:"Tomorrow"},LAST_WEEK:{label:"Last Week"},THIS_WEEK:{label:"This Week"},NEXT_WEEK:{label:"Next Week"},LAST_MONTH:{label:"Last Month"},THIS_MONTH:{label:"This Month"},NEXT_MONTH:{label:"Next Month"},LAST_90_DAYS:{label:"Last 90 Days"},NEXT_90_DAYS:{label:"Next 90 Days"},LAST_N_DAYS:{label:"Last n Days",merge:!0},NEXT_N_DAYS:{label:"Next n Days",merge:!0},THIS_QUARTER:{label:"This Quarter"},LAST_QUARTER:{label:"Last Quarter"},NEXT_QUARTER:{label:"Next Quarter"},NEXT_N_QUARTERS:{label:"Next n Quarters",merge:!0},LAST_N_QUARTERS:{label:"Last n Quarters",merge:!0},THIS_YEAR:{label:"This Year"},LAST_YEAR:{label:"Last Year"},NEXT_YEAR:{label:"Next Year"},NEXT_N_YEARS:{label:"Next n Years",merge:!0},LAST_N_YEARS:{label:"Last n Years",merge:!0},THIS_FISCAL_QUARTER:{label:"This Fiscal Quarter"},LAST_FISCAL_QUARTER:{label:"Last Fiscal Quarter"},NEXT_FISCAL_QUARTER:{label:"Next Fiscal Quarter"},NEXT_N_FISCAL_QUARTERS:{label:"Next n Fiscal Quarters",merge:!0},LAST_N_FISCAL_QUARTERS:{label:"Last n Fiscal Quarters",merge:!0},THIS_FISCAL_YEAR:{label:"This Fiscal Year"},LAST_FISCAL_YEAR:{label:"Last Fiscal Year"},NEXT_FISCAL_YEAR:{label:"Next Fiscal Year"},NEXT_N_FISCAL_YEARS:{label:"Next n Fiscal Years",merge:!0},LAST_N_FISCAL_YEARS:{label:"Last n Fiscal Years",merge:!0}},Gb=["Id","LastReferencedDate","LastViewedDate","Name","Type"],Hb=["FirstName","LastName"],Ib=function(a,b,c){var d,e;
return c&&(d=c.modelPropId,e=c.component),d||(d="model"),"model.remove"===b.type&&a.attr(d)===b.modelId?(e?e.remove(!1,!0):a.remove(),pb("skuidBuilderNeedSave"),!0):!1},Jb=function(a,b,c){return"model.idChange"===b.type&&a.attr(c||"model")===b.oldId?(a.attr(c||"model",b.newId),pb("skuidBuilderNeedSave"),!0):!1},Kb=function(a,b){var c,d=l(a.prop("tagName"));d&&d.handleStateEvent&&(c=d.handleStateEvent(a,b)),c!==!1&&a.children().each(function(){Kb(ib(this),b)})},Lb={field:function(a,b){return a.attr("field")?b+" records where <b>"+a.attr("field")+"</b>":"[No Field Selected]"},operator:function(a){var b=kb.operatormap[a.attr("operator")||""];return"<b>"+(b.longname||b.name)+"</b>"},value:function(a){var b,c=a.attr("type");if("fieldvalue"===c)b="<b>"+a.attr("value")+"</b>";else if("multiple"===c)b="",a.children("values").children().each(function(){b+=ib(this).text()+", "}),b=b.substring(0,b.length-2);else if("param"===c)b=a.attr("value")?"the <b>"+a.attr("value")+" parameter</b> in the page's url":"[No Parameter Given]";else if("userinfo"===c){var d=kb.userinfomap[a.attr("userinfotype")],e=d?d.label:"User Id";b="the <b>"+e+"</b> of the user running this page"}else if("blank"===c)b="a <b>blank</b> value";else if("modelmerge"===c){var f=-1!==ib.inArray(a.attr("operator"),["in","not in"]);b=a.attr("mergefield")?(f?"containing":"the value of")+" the <b>"+a.attr("mergefield")+"</b> field from "+(f?"any":"the first")+" row returned by the <b>"+a.attr("model")+"</b> model":"[No Merge Field Selected]"}else"join"===c&&(b=a.attr("joinfield")?"specified by returning <b>"+a.attr("joinfield")+"</b> values from a subquery on the <b>"+a.attr("joinobject")+"</b> object":"[No Join Field Selected]");return b},state:function(a){var b="This condition",c=a.attr("state");return c?"filterableon"===c||"filterableoff"===c?(a.attr("name")&&(b+=", named <b>"+a.attr("name")+"</b>"),b+=" can be modified by filters, but is <b>"+("filterableon"===c?"on":"off")+" by default</b>."):b+=" is <b>always off</b>":b+=" is <b>always on</b>.",b}},Mb=[],Nb=[{label:"Alt",value:"alt"},{label:"Ctrl",value:"ctrl"},{label:"Command",value:"meta"},{label:"Shift",value:"shift"}],Ob={disabled:!0,label:"",value:""},Pb=function(a){return{disabled:!0,label:a,value:""}},Qb=[Pb("Letters/Numbers")];ib.each("ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890".split(""),function(a,b){Qb.push({label:b,value:b.toLowerCase()})}),Qb.push(Ob,Pb("Arrow Keys")),ib.each(["Left","Up","Right","Down"],function(){Qb.push({label:this,value:this.toLowerCase()})}),Qb.push(Ob,Pb("Special Keys")),ib.each([{l:"Backspace/Delete",v:"backspace"},{l:"Delete Right",v:"del"},{l:"End",v:"end"},{l:"Home",v:"home"},{l:"Page Down",v:"pagedown"},{l:"Page Up",v:"pageup"},{l:"Return",v:"return"},{l:"Space",v:"space"},{l:"Tab",v:"tab"}],function(){Qb.push({label:this.l,value:this.v})}),Qb.push(Ob,Pb("Function Keys"));for(var Rb=1;13>Rb;Rb++)Qb.push({label:"F"+Rb,value:"f"+Rb});var Sb={},Tb="sk-icon",Ub=!1;a.events.subscribe("skuidBuilderNeedSave",function(){Ub=!0}),a.events.subscribe("skuidBuilderComponentNeedsRefresh",function(a){tb[a._GUID]=a});var Vb,Wb=function(a){kb.pageXML&&(ib.each(i(),function(b,c){var d,e=c.builder;e&&(d=e.handleStateEvent,d&&d(c.state,a,c))}),Kb(kb.pageXML,a),Ub&&(Ub=!1,pb("skuidBuilderSave")))},Xb=function(){if(Vb&&Vb.state){var a=z(Vb.state.attr("id"));if(a&&a.length)return Vb}return Vb=null},Yb=function(a){Vb=a},Zb=function(a,b){var c,d,e=[],f=[],g="multipicklist"==a.type,h=a.id,i=a.storeAs;if(!g||i&&"node"!==i.type)c=b.attr(h),d=c&&"undefined"!=c,d&&f.push(c);else{var j=b.children(h);c="",d=j.length,d&&i&&"node"===i.type&&(ib.each(j.children(i.name),function(){f.push(ib(this).text())}),c=f.join(","))}return y().children().each(function(b){var c=ib(this).attr("id"),d=-1!==ib.inArray(c,f),g=a.objectTypeFilter,h=kb.getSObjectNameFromModelName(c);if(g)if("string"==typeof g){if(h!==a.objectTypeFilter)return!0}else if("function"==typeof g&&!g({sobjectName:h,modelId:c,modelOrder:b,isSelected:d}))return!0;e.push({value:c,label:c})}),e},$b={models:function(a,b,c){return a.type="multipicklist",a.storeAs||(a.storeAs={type:"node",name:"model"}),a.location||(a.location="node"),a.noneSelectedText||(a.noneSelectedText="Select Models..."),a.picklistEntries=Zb(a,b),$b.multipicklist(a,b,c)},model:function(b,c){var d=b.id,e=a.ui.renderers.PICKLIST.edit({value:c.attr(d),entries:Zb(b,c),required:!0,onChange:function(a,e){kb.updateState(c,{key:d,value:a}),b.onChange&&b.onChange(a,!1,e)}});if(!c.attr(d)){var f=e.children().first().prop("value");kb.updateState(c,{key:d,value:f}),b.onChange&&b.onChange(f,!0)}return e},"boolean":function(b,c){var d,e,f=b.id;return d="true"===c.attr(f)?!0:c.attr(f)?!1:b.defaultValue||!1,e=a.ui.renderers.BOOLEAN.edit({value:d,onChange:function(a){kb.updateState(c,{key:f,value:a}),b.onChange&&b.onChange(a)}}),b.readonly&&e.prop("disabled",!0),e},condition:function(b,c){var d,e=b.id;if(b.modelName){var f=y().children('[id="'+b.modelName+'"]'),g=f.children("conditions").find("[name]");d=g.map(function(){var a=ib(this).attr("name");return{value:a,label:a}})}return a.ui.renderers.PICKLIST.edit({value:c.attr(e),entries:d,onChange:function(a){var d=c.attr(e);kb.updateState(c,{key:e,value:a}),b.onChange&&b.onChange(a,d)},noneLabel:"--None--"})},picklist:function(b,c){var d,e,f,g="multipicklist"==b.type,h=b.id,i=b.storeAs,j=b.options||b.picklistEntries,k=[],l=function(a){var d,e=n(c,b);d=g&&i&&"node"===i.type?{childNodeName:h,storeAs:i,value:a?a.split(","):[]}:{key:h,value:a||""},kb.updateState(c,d),b.onChange&&b.onChange(a,e)},m=function(){return g?a.ui.renderers.MULTIPICKLIST.edit({value:e,entries:j,noneSelectedText:b.noneSelectedText,valueDelimiter:",",selectedList:4,onChange:function(a,b){l(a,b)}}):a.ui.renderers.PICKLIST.edit({value:e,entries:j,defaultValue:b.defaultValue,required:!0,onChange:function(a,b){l(a,b)}})};if(g&&i&&"node"===i.type){var o=c.children(h);e="",f=o.length,f&&i&&"node"===i.type&&(ib.each(o.children(i.name),function(){k.push(ib(this).text())}),e=k.join(","))}else e=c.attr(h),f=e&&"undefined"!=typeof e;return d=m()},multipicklist:function(a,b,c){return $b.picklist(a,b,c)},sobject:function(b,c){var d,e=b.id;return d=c.attr(e)?ib("<div>").addClass("nx-fieldtext").text(c.attr(e)||"").css("margin-top","6px"):a.ui.renderers.AUTOCOMPLETE.edit({source:a.utils.sObjectList,onChange:function(a,d){kb.getFields(d.item.value,function(){kb.updateState(c,{key:e,value:d.item.value}),b.onChange&&b.onChange(d.item.value)})}})},icon:function(a,b){var c,d,e=a.id,f=b.attr(e)||a.defaultValue||"",g=ib("<div>").addClass("nx-pagebuilder-property-button-area"),h=ib("<input>").attr("type","text").addClass("nx-picker-icon-input").val(f).appendTo(g),i=ib("<button>").addClass("nx-picker-icon-btn"),j=ib("<div>").appendTo(i);return""===f?j.removeClass().addClass("nx-picker-icon inline").text("?"):j.addClass("nx-picker-icon sk-icon inline "+f),i.on("click",function(){c?c.dialog("open"):(c=ib("<div>"),kb.buildIconPicker(c,h,j),c.dialog({width:800,height:400,title:"Choose an Icon",resizable:!0,modal:!0}))}),d=ib("<div>").addClass("nx-pagebuilder-property-button-wrapper").append(i),lb.delayInputCallback(h,function(c){""===c?j.removeClass().addClass("nx-picker-icon inline").text("?"):j.empty().removeClass().addClass("nx-picker-icon sk-icon inline "+c),kb.updateState(b,{key:e,value:c}),a.onChange&&a.onChange(c)}),[d,g]}},_b=function(a,b){var c,d,e,f,g="",h="",i=a.length?a[0].id:!1,j=[];return b=b||{},ib.each(a,function(c){if(!this.rel)return!1;0!==c&&(h+=this.rel+".");var d=ib("<span>"+this.rel+(this.isPolymorphic&&this.ref!==this.rel?"("+this.ref+")":"")+"</span>").addClass("nx-pagebuilder-breadcrumb");this.isPolymorphic&&(g+=this.ref+"."),this.ref&&-1!==this.ref.indexOf(",")&&(this.possibleTargetObjects=this.ref.split(","),b.showObjectPickerIfPolymorphic?this.isPolymorphic=!0:this.ref="Name"),c<=a.length-2&&d.addClass("nx-pagebuilder-breadcrumb-link"),j.push(d)}),f=kb.getModelFromModelName(i),e=f&&"aggregate"==f.attr("type"),c=a[a.length-1].ref,d=a[a.length-1].rel,g.length>0&&-1!==g.indexOf(".")&&(g=g.substring(0,g.length-1)),{endsobject:c,endrel:d,isAggregate:e,targetObject:g,prefix:h,modelId:i,elements:j}},ac=function(b){var c={},d=new Date,e="/resource/"+d.getTime()+"/",f=kb.pageXML.attr("theme");return f?ib.each(kb.availableThemes,function(a){a===f&&(e+=(this.skuid__Resource_Namespace__c?this.skuid__Resource_Namespace__c+"__":"")+this.skuid__Resource_Name__c)}):e+=a.page.runtimeThemeResource,e&&ib.getJSON(e+"/skuid_theme.json",function(a){b&&b(a)}),c},bc=function(a){var b;return ib.each(i(),function(){return a[0]&&this.state&&this.state[0]&&this.state[0]===a[0]?(b=this,!1):void(b=!1)}),b},cc=function(a){return a=a||{},{label:"Search Fields",linkedComponent:a.linkedComponent,id:"searchfields",isChild:!0,isNew:!0,deleteable:!1,props:[{type:"helptext",html:"Use Search Fields to specify which fields to search on.  If you do not specify any fields, all searchable fields will be searched."}],noItemsFunction:function(){return ib("<div>").text("(Searching on all searchable fields).")},children:[{id:"searchfield",indent:1,linkedComponent:a.linkedComponent,labelFunction:function(a){return a.attr("field")||"[No Field Selected]"},defaultStateFunction:function(){return mb(a.isReference?'<searchfield query="true" show="true"/>':"<searchfield/>")},propsFunction:function(b){var c=[{id:"field",type:"field",label:"Field",modelname:a.modelName,sobject:a.sobject,onChange:function(){b.refresh()}}];return a.isReference&&(c.push({id:"query",type:"boolean",label:"Use in Search Query"}),c.push({id:"show",type:"boolean",label:"Show in Lookup Popup"})),c}}]}};ib.extend(kb,{Builder:d,layoutFields:lb.layoutFields,getBuilder:l,getBuilders:m,registerBuilder:j,registerBuilders:k,registerComponent:g,unregisterComponent:h,getComponentsList:i,fieldsDescribeCache:rb,dropStack:sb,componentsNeedingRefresh:tb,getStoredValue:n,updateState:o,getFields:q,getFieldInfoFromCache:s,getConditionDisplayString:r,save:p,userinfomap:Eb,operatormap:Db,dateliteralmap:Fb,getValidOperators:G,determineQuotedness:u,getMetadataForField:t,isValidFieldForPossibleTargetObjects:w,getDefaultAliasName:c,getFirstModel:A,getModelFromModelName:z,getSObjectForField:v,getSObjectNameFromModelName:x,getUniqueModelName:b,addFieldToModel:D,buildIconPicker:W,conditionDescriptionRenderers:Lb,getConditionFieldPropObj:F,getConditionOperatorPropObj:H,getConditionValueProperties:E,getConditionStateProperties:I,getContextCategory:Y,getRenderingCategory:Z,getHotkeysCategory:U,getValueEditorFromMetadata:J,getCoreActionProperties:O,getCoreActionOptions:K,getValidActionOptions:M,addValidActionOptions:L,getActionTreeNode:S,getActionsCategory:T,getActionLabel:N,getFieldProperties:Q,getModelProperties:P,getLabelProperties:$,getJSItemLabel:_,getCSSItemLabel:bb,getFilterItemLabel:db,getEffectItemLabel:fb,getJSItemProperties:ab,getCSSItemProperties:cb,getFilterItemProperties:eb,getEffectItemProperties:hb,getLastSelectedModelComponent:Xb,setLastSelectedModelComponent:Yb,propertyRenderers:$b,processBreadCrumbInfo:_b,publishStateEvent:Wb,handleModelRemove:Ib,handleModelIdChange:Jb,getIconsObject:ac,getComponentFromState:bc,getSearchFieldsTreeItem:cc})}(skuid),function(a){var b=a.sfdc,c=b.api={},d=a.$,e=29,f="/services/data/v29.0",g="Missing object property: ",h={StaticResource:{name:"StaticResource",fields:[{id:"Name",required:!0},{id:"Description",required:!1},{id:"Body",required:!0},{id:"CacheControl",defaultValue:"Public",required:!0},{id:"ContentType",defaultValue:"text/plain",required:!0}]},ApexPage:{name:"ApexPage",fields:[{id:"Name",required:!0},{id:"Markup",required:!0},{id:"MasterLabel",required:!0},{id:"ApiVersion",defaultValue:e,required:!0}]},ApexClass:{name:"ApexClass",fields:[{id:"Name",required:!0},{id:"Body",required:!0},{id:"ApiVersion",defaultValue:e,required:!0}]}},i=function(a,b){1===b.length&&"object"==typeof b[0]&&d.extend(a,b[0])},j=function(){i(this,arguments)};j.prototype.insert=function(){return m.apply(this,arguments)},j.prototype.update=function(){return n.apply(this,arguments)},j.prototype["delete"]=function(){return o.apply(this,arguments)},j.prototype.getMetadata=function(){return h.StaticResource};var k=function(){i(this,arguments)};k.prototype.insert=function(){return m.apply(this,arguments)},k.prototype.update=function(){return n.apply(this,arguments)},k.prototype["delete"]=function(){return o.apply(this,arguments)},k.prototype.getMetadata=function(){return h.ApexPage};var l=function(){i(this,arguments)};l.prototype.insert=function(){return m.apply(this,arguments)},l.prototype.update=function(){return n.apply(this,arguments)},l.prototype["delete"]=function(){return o.apply(this,arguments)},l.prototype.getMetadata=function(){return h.ApexClass};var m=function(a){var b=this,c=b.getMetadata(),e=c.name,f={};return a||(a={}),d.each(c.fields,function(a,c){var d=b[c.id];if(c.required&&("undefined"==typeof d||""===d)){if(!c.defaultValue)throw g+c.id;d=b[c.id]=c.defaultValue}f[c.id]=d}),q({type:"POST",url:"/sobjects/"+("ApexClass"===e?"tooling/":"")+e,data:f,success:function(c){if(c.success)b.Id=c.id,a.success&&a.success(c);else{var f=e+" could not be created due to errors:\n\n";d.each(c.errors,function(){f+=this+"\n"})}},error:function(b,c,d){if(a.error)a.error(b,c,d);else{var f=b.responseJSON;f&&f.length&&window.alert("Unable to create new "+e+" due to error:\n\nError code: "+f[0].errorCode+"\nMessage: "+f[0].message)}}})},n=function(a){var b=this,c=b.getMetadata(),e=c.name,f={};return a||(a={}),d.each(c.fields,function(a,c){var d=b[c.id];"undefined"!=typeof d&&(f[c.id]=d)}),q({type:"PATCH",url:"/sobjects/"+("ApexClass"===e?"tooling/":"")+e+"/"+b.Id,data:f})},o=function(a){var b=this,c=b.getMetadata(),d=c.name;if(a||(a={}),!b.Id)throw g+"Id";return q({type:"DELETE",url:"/sobjects/"+("ApexClass"===d?"tooling/":"")+d+"/"+b.Id})},p=function(a,b){return q({type:"GET",url:"/query/?q="+encodeURIComponent(a),success:function(a){b&&b.success&&b.success(a)}})},q=function(b){b||(b={});var c,e=b.type,g=b.url;if(!e)throw'Parameter "type" expected, e.g. "POST", "GET"';if(!g)throw'Parameter "url" expected, e.g. "/sobjects/Account", "/query/?q=select+Name+from+Account"';return c={type:e,url:f+g,dataType:"json",headers:{"Content-Type":"application/json",Authorization:"Bearer "+a.utils.userInfo.sessionId},success:function(a){b.success&&b.success(a)},error:function(a,c,d){if(b.error)b.error(a,c,d);else{var f=a.responseJSON[0];window.alert("There was an error performing this "+e+" request:\n\nError code: "+f.errorCode+"\nMessage: "+f.message+"\n")}}},b.data&&(c.data=JSON.stringify(b.data)),d.ajax(c)};a.snippet.registerSnippet("skuid.page.packagePages",function(b){var c=a.$,d=function(a){return window.btoa(JSON.stringify(a))},e=b.srName,f=b.srDescription,g="SELECT Id, Name, Description FROM StaticResource WHERE Name = '"+e+"'",h=a.model.getModel("pagedata"),i=[],j="SELECT Id, Name, skuid__Type__c, skuid__UniqueId__c, skuid__Module__c, skuid__Layout__c, skuid__Layout2__c, skuid__Layout3__c, skuid__Layout4__c, skuid__Layout5__c FROM skuid__Page__c WHERE Id IN ('";if(c.each(h.registeredItems,function(){this.selected&&i.push(this.row.Id)}),0===i.length)return void c.blockUI({message:"Please select at least one Page for your Page Pack",timeout:7500});j+=i.join("','")+"') ORDER BY skuid__Module__c, Name",c.blockUI({message:"Getting Page and StaticResource records..."});var k,l,m=a.sfdc.api.query(g),n=a.sfdc.api.query(j);c.when(n).then(function(a){l=a.records}),c.when(m).then(function(a){k=a.records}),c.when(m,n).then(function(){var b,g=c.Deferred();k.length>0?(b=new a.sfdc.api.StaticResource({Id:k[0].Id}),g.resolve()):(c.blockUI({message:"Creating StaticResource..."}),b=new a.sfdc.api.StaticResource({Name:e,Description:f,Body:d([])}),b.insert({success:function(){g.resolve()},error:function(a){g.reject({resourceName:e,errorMessage:a.responseJSON[0].message})}})),c.when(g).then(function(){c.blockUI({message:"Packaging Pages into StaticResource...",timeout:500}),b.Body=d(l),b.ContentType="application/json",c.when(b.update()).then(function(){c.blockUI({message:'The "'+e+'" Page Pack was created/updated successfully!',timeout:5e3})})},function(a){c.blockUI({message:'There was an error creating the "'+a.resourceName+'" Page Pack:\n\n'+a.errorMessage,timeout:7500})})})}),a.snippet.registerSnippet("skuid.page.packagePagesInModules",function(b){var c=b.model,d=b.row,e=a.$,f=c.getFieldValue(d,"skuid__Module__c",!0),g=function(a){return window.btoa(JSON.stringify(a))};if(!f)return void window.alert("Please select a Module.");e.blockUI({message:"Retrieving Page and StaticResource records..."});var h,i,j=f.split(";"),k="('"+j.join("','")+"') ",l="('"+j.join("Pages','")+"Pages') ",m=a.sfdc.api.query("select Id, Name from StaticResource where Name in "+l),n=a.sfdc.api.query("select Id, Name, skuid__Type__c, skuid__UniqueId__c, skuid__Module__c, skuid__Layout__c, skuid__Layout2__c, skuid__Layout3__c, skuid__Layout4__c, skuid__Layout5__c from skuid__Page__c where skuid__Module__c in "+k+"order by skuid__Module__c, Name");e.when(n).then(function(a){h=a.records}),e.when(m).then(function(a){i=a.records}),e.when(m,n).then(function(){e.blockUI({message:"Checking for Resources that may need to be created..."});var b={},c={},d={};e.each(i,function(){b[this.Name.substring(0,this.Name.indexOf("Pages"))]=new a.sfdc.api.StaticResource({Name:this.Name,Id:this.Id,Body:this.Body})}),e.each(h,function(){var a=b[this.skuid__Module__c],e=d[this.skuid__Module__c];a||(c[this.skuid__Module__c]=1),e||(e=d[this.skuid__Module__c]=[]),e.push(this)});var f=e.Deferred(),j={};e.each(c,function(c){var d=c+"Pages",e=new a.sfdc.api.StaticResource({Name:d,Body:g([])});b[c]=e,j[d]=1,e.insert({success:function(){delete j[d],0===a.utils.size(j)&&f.resolve()},error:function(a){f.reject({resourceName:d,errorMessage:a.responseJSON[0].message})}})}),0===a.utils.size(c)&&f.resolve(),e.when(f).then(function(){e.blockUI({message:"Packaging Pages into StaticResources...",timeout:500});var c=e.Deferred(),f=a.utils.size(d);e.each(d,function(a,d){var h=b[a];h&&(h.Body=g(d),h.ContentType="application/json",e.when(h.update()).then(function(){f--,0===f&&c.resolve()}))}),e.when(c).then(function(){var a=[];e.each(d,function(b){a.push(b+"Pages")}),e.blockUI({css:{"text-align":"left"},message:"Module Pages packaged successfully!<br/><br/>The following StaticResources were updated, or created if they did not exist before:<br/><ul><li>"+a.join("</li><li>")+"</ul>",timeout:5e3})})},function(a){e.blockUI({message:'There was an error creating the new StaticResource "'+a.resourceName+'":\n\n'+a.errorMessage,timeout:7500})})})}),c.ApexClass=l,c.ApexPage=c.VisualforcePage=k,c.StaticResource=j,c.makeRequest=q,c.query=p}(skuid),function(a){function b(b,c,d,e){var f=this;f.state=b,p.registerComponent(f),f.customBuilder=c,c?(f.builder=c,f.builderId=f.builder.id):(f.builderId=b[0].nodeName.toLowerCase(),f.builder=p.getBuilder(f.builderId)||new p.Builder({id:f.builderId})),f.element=n("<div>").data("object",f).addClass("nx-pagebuilder-component"),f.headerWrapper=n("<div>").addClass("nx-pagebuilder-component-header"),f.actionbar=n("<div>").addClass("nx-pagebuilder-component-actionbar"),f.header=n("<span>"),f.headerWrapper.append(f.actionbar,f.header),f.body=n("<div>").addClass("nx-pagebuilder-component-body"),f.element.addClass(f.builder.hideWrapper?"nx-pagebuilder-component-hidewrapper":"nx-pagebuilder-component-showwrapper"),f.element.append(f.headerWrapper,f.body),e&&(f.isGlobalComponent=!0,f.element.addClass("nx-pagebuilder-component-global"),f.addActionItem(a.label.read("remove"),"sk-icon-delete",function(){f.remove()}));var g=f.element.is(".nx-pagebuilder-component")?!1:f.builder.dragHandle||"> .nx-pagebuilder-component-header";d&&(f.element.find(f.builder.dragHandle).css("cursor","move"),f.element.draggable({appendTo:".nx-page",handle:g,cancel:".nx-pagebuilder-component-actionitem",delay:200,helper:function(){var a=n("<div>").addClass("nx-pagebuilder-componenttag");return a.append(n("<div>").css("float","left").addClass("sk-icon "+f.builder.icon)),a.append(n("<div>").css("margin-left","24px").css("margin-top","1px").text(f.builder.name)),a.css({"z-index":1e3,border:"1px solid #CCC","background-color":"#EEE"}),a},revert:"invalid",start:function(){n(this).hide().next().hide()},stop:function(){n(this).show().next().show()}})),f.builder.renderComponent(f)}function c(a,b,c){this.accept=c,this.customBuilder=b,this.componentsXML=a,this.element=n("<div>").addClass("nx-pagebuilder-acceptor"),this.element.data("object",this),this.refresh()}function d(a){n(".nx-pagebuilder-selected").not(a).each(function(){n(this).removeClass("nx-pagebuilder-selected");var a=n(this).data("object");a&&a.builder.onUnSelect&&a.builder.onUnSelect(a)})}function e(b,c,d){d=d||{},d.columnCount=d.columnCount||2;for(var e=n("<div>").addClass("nx-editor-contents"),f={},g=[],i=0;i<d.columnCount;i++){var j=n("<div>").addClass("nx-pagebuilder-propcolumn").css("width",100/d.columnCount+"%");g.push(j),e.append(j)}return n.each(c,function(e,i){i.init&&i.init();var j=n("<div>").addClass("nx-basicfieldeditor-item nx-pagebuilder-property-item");g[Math.floor(e*d.columnCount/c.length)].append(j),f[i.id]=j;var k,l,m,o,s,t,u=i.id,v=i.label||u,w=n("<div>").addClass("nx-basicfieldeditor-item-label").text(v),x=i.location,y=i.storeAs;if(j.append(w),(i.isUpdated||i.isNew)&&(w.css("position","relative"),w.append(n("<div>").addClass("nx-pagebuilder-"+(i.isUpdated?"new":"updated")+"prop").text(i.isUpdated?"Updated":"New"))),i.helptext){var z=n("<div>").addClass("sk-icon sk-icon-help inline").css({"vertical-align":"top","margin-left":"4px"});z.skootip(i.helptext),w.append(z)}var A=n("<div>").addClass("nx-field");if(j.append(A),i.type)if(-1!==n.inArray(i.type,["boolean","condition","model","models","multipicklist","picklist","sobject","icon"]))A.append(p.propertyRenderers[i.type](i,b));else if("readonly"===i.type){var B=n("<div>").addClass("nx-fieldtext").text(b.attr(u)||"").css("margin-top","6px");A.append(B)}else if("helptext"===i.type)j.empty(),j.html(i.html).addClass("nx-pagebuilder-property-helptext");else if("multiitem"===i.type){var C=b.children(u),D=n("<div>"),E=function(c){var d=n("<div>").css("clear","both"),e=n("<div>").addClass("nx-pagebuilder-property-button-area"),f=n("<button>").addClass("nx-picker-icon-btn").append(n("<div>").addClass("nx-picker-icon sk-icon inline sk-icon-delete"));f.on("click",function(){c.remove(),d.remove(),a.events.publish("skuidBuilderSave"),i.onChange&&i.onChange()}),e.append(p.getValueEditorFromMetadata(i,b,u,c));var g=n("<div>").addClass("nx-pagebuilder-property-button-wrapper").append(f);return d.append(g,e),d};C.length||(C=r("<values/>").append(r("<value/>")),C.appendTo(b)),C.children(y.name).each(function(){D.append(E(n(this)))}),A.append(D),A.append(n("<div>").text("Add Another Value").addClass("nx-pagebuilder-viewxmllink").css({cursor:"pointer","float":"left","margin-bottom":"2px"}).click(function(){var b=r("<value/>").appendTo(C);D.append(E(b)),a.events.publish("skuidBuilderSave"),i.onChange&&i.onChange()}))}else if("field"===i.type){s=n("<div>").addClass("nx-pagebuilder-property-button-area");var F,G,H="[No Field Selected]",I=b.attr(u),J=b.attr(u)||i.defaultValue||H,K=i.isMultiselect||!1,L=K?"Select Fields":"Select Field",M=n("<div>").addClass("nx-fieldtext").text(J).appendTo(s).addClass("nx-pagebuilder-property-button-area-inner");t=!1,l=n("<button>").addClass("nx-picker-icon-btn"),k=n("<div>").appendTo(l).skootip(L).addClass("nx-picker-icon sk-icon inline sk-bi-field-pick");var N=function(a,c,d,e){i.addFieldToModel&&a&&c&&G&&p.addFieldToModel({fieldId:a,model:G}),M.text(a),p.updateState(b,{key:u,value:a}),i.onChange&&i.onChange(a,c,d),e&&e.dialog("close")},O=function(){i.sobject?t=i.sobject:(F=i.modelname?i.modelname:i.modelprop?b.attr(i.modelprop):b.closest("model").attr("id"),F&&(G=p.getModelFromModelName(F)),t=p.getSObjectNameFromModelName(F))};J&&I!==J&&J!==H&&(O(),N(J,!0,null)),l.on("click",function(){if(m)m.dialog("open");else{m=n("<div>").addClass("nx-picker-wrapper").css("z-index","104");var a,c,d=n("<div>").appendTo(m).addClass("nx-pagebuilder-fieldpicker-header"),e=n("<div>").appendTo(d),f=n("<div>").appendTo(d).addClass("nx-pagebuilder-fieldpicker-headertext"),g=n("<div>").appendTo(m).addClass("nx-pagebuilder-fieldpicker-body"),j=i.showObjectPickerIfPolymorphic;O(),t&&(c={rel:t,ref:t},j&&(c.isPolymorphic=!0),a=h([c],{showObjectPickerIfPolymorphic:j,element:g,headertext:f,filterboxwrapper:e,isSelected:function(a){return a===b.attr(u)},onChange:function(a,b,c){N(a,b,c,m)},isMultiselect:K,filter:function(a){var b=!0;if(i.displayTypeFilter){b=!1;var c=i.displayTypeFilter;c instanceof Array?b=-1!=n.inArray(a.displaytype,c):a.displaytype===c&&(b=!0)}return"REFERENCE"===a.displaytype||b},selectable:function(a){var b=!0;if(i.displayTypeFilter){b=!1;var c=i.displayTypeFilter;c instanceof Array?b=-1!=n.inArray(a.displaytype,c):a.displaytype===c&&(b=!0)}return i.refFilter&&(b=!1,a.ref===i.refFilter&&(b=!0)),b}})),n.when(a).then(function(){m.dialog({width:800,height:400,title:L,resizable:!1,modal:!1})})}}),o=n("<div>").addClass("nx-pagebuilder-property-button-wrapper").append(l),A.append(o,s)}else if("template"===i.type||"code"===i.type){var P="node",Q="attribute";x||(i.location=P);var R=p.getStoredValue(b,i);if(!R&&i.defaultValue){R=i.defaultValue;var S={value:R};i.location==P&&i.id?S.childNodeName=i.id:i.location==Q&&(S.key=i.id),p.updateState(b,S)}if("template"===i.type){var T=i.displayAs,U=n("<div>").addClass("nx-pagebuilder-property-button-area"),V=n("<"+("input"===T?"input":"textarea")+">").val(R).appendTo(U);l=n("<button>").addClass("nx-picker-icon-btn"),k=n("<div>").appendTo(l).skootip("Select a Field to insert into this Template").addClass("nx-picker-icon sk-icon inline sk-bi-field-pick"),l.on("click",function(){if(m)m.dialog("open");else{m=n("<div>");var a,c,d,e,f=n("<div>").appendTo(m).addClass("nx-pagebuilder-fieldpicker-header"),g=n("<div>").appendTo(f),j=n("<div>").addClass("nx-pagebuilder-fieldpicker-headertext").appendTo(f),k=n("<div>").addClass("nx-pagebuilder-fieldpicker-body").appendTo(m);if(i.modelprop?(c=b.attr(i.modelprop),"undefined"!=typeof c&&(a=c)):i.modelName&&(a=i.modelName),a||(a=b.closest("[model]").attr("model")),a&&(d=p.getModelFromModelName(a),d&&(e=d.attr("sobject"))),e){var l=[],o=!1;if(i.fieldContext&&c)l.push({rel:i.fieldContext.rel,ref:i.fieldContext.ref,id:a});else if(i.fieldContext){l.push({rel:e,ref:e,id:a});var r=i.fieldId,s=r.split(".");s.length&&n.each(s,function(b,c){b<s.length-1&&l.push({rel:c,ref:c,id:a})}),s.pop(),s.push(i.fieldContext.rel),o=s.join("."),l.push({rel:i.fieldContext.rel,ref:i.fieldContext.ref,id:a})}else l.push({rel:e,ref:e,id:a});if("CHILDREL"==b.attr("type")){var t=b.attr("id");n.each(p.fieldsDescribeCache[e].childRelationships,function(){return this.relationshipName===t?(e=this.childSObject,l=[{rel:e,ref:e,id:a}],!1):void 0})}h(l,{element:k,headertext:j,filterboxwrapper:g,isSelected:function(){return!1},onChange:function(a){o&&(a=a.substring(o.length+1,a.length));var c,d=V.val(),e=V.getCursorPosition(),f="{{"+a+"}}",g=f.length,h=[];0===e?f+=d:e===d.length?f=d+f:(h[0]=d.substring(0,e),h[1]=d.substring(e,d.length),f=h[0]+f+h[1]),V.val(f),c={value:f},i.location==P&&i.id?c.childNodeName=i.id:i.location==Q&&(c.key=i.id),p.updateState(b,c),i.onChange&&i.onChange(f),m.dialog("close"),V.focus().setCursorPosition(e+g)},isMultiselect:!1,filter:function(a,b,c){var e=!0;if("REFERENCE"!==a.displaytype){var f=d.children("fields,groupby").find('field[id="'+q.escapeSelector(c)+'"]');0===f.length&&(e=!1)}return e},selectable:function(a,b){var c=!0,e=d.children("fields,groupby").find('field[id="'+q.escapeSelector(b)+'"]');return 0===e.length&&(c=!1),c}})}m.dialog({width:800,height:400,title:"Select a Field from this Model to insert into this Template",resizable:!1,modal:!0})}}),o=n("<div>").addClass("nx-pagebuilder-property-button-wrapper").append(l),A.append(o,U),q.delayInputCallback(V,function(a){var c={value:a};i.location==P&&i.id?c.childNodeName=i.id:i.location==Q&&(c.key=i.id),p.updateState(b,c),i.onChange&&i.onChange(a)})}else{s=n("<div>").addClass("nx-pagebuilder-property-button-area"),l=n("<button>").addClass("nx-picker-icon-btn"),k=n("<div>").appendTo(l).skootip("Open Resource Editor").addClass("nx-picker-icon sk-icon inline sk-bi-code-edit");var W=n("<div>").addClass("nx-fieldtext").text(R).appendTo(s).addClass("nx-pagebuilder-property-button-area-inner");l.on("click",function(){var a;a=i.id?b.children(i.id).text()||"":b.text()||"";var c=n("<div>"),d=n('<div id="skuidcodeditor">').addClass("nx-code-editor").appendTo(c).hide();c.dialog({width:800,height:"auto",minHeight:600,title:"Edit Inline Code",resizable:!0,modal:!0,close:function(){c.dialog("destroy"),c.remove()}});var e=window.ace.edit("skuidcodeditor");i.syntax&&e.getSession().setMode("ace/mode/"+i.syntax),e.setValue(a);var f=e.getSession().getUndoManager();f.reset(),e.getSession().setUndoManager(f),e.getSession().getSelection().clearSelection(),d.show(),e.getSession().on("change",function(){var a=e.getValue(),c={value:a};i.id&&(c.childNodeName=i.id),p.updateState(b,c),i.onChange&&i.onChange(a),W.text(a)})}),o=n("<div>").addClass("nx-pagebuilder-property-button-wrapper").append(l),A.append(o,s)}}else if("autocomplete"===i.type){t=i.sobject;var X,Y=i.fieldsToSearch||["Name"],Z=i.fieldsToReturn||["Name"],$=i.displayTemplate||"{{Name}}",_=i.valueTemplates||{},ab={};u in _||(_[u]="{{Name}}");var bb=a.ui.renderers.AUTOCOMPLETE.edit({minLength:2,value:q.decodeHTML(b.attr(u)),source:function(b,c,d,e){if(b.term in ab)return void c(ab[b.term]);X=b.term.split(" ");var f={fields:[{id:"Id"}],conditions:[],objectName:i.sobject,doQuery:!0};n.each(Z,function(a,b){"Id"!=b.toLowerCase()&&f.fields.push({id:b})}),i.order&&(f.order=i.order),n.each(Y,function(a,b){n.each(X,function(a,c){f.conditions.push({field:b,operator:"LIKE",value:"%"+c+"%"})})});for(var g=[],h=1;h<=f.conditions.length;h++)g.push(""+h);f.conditionLogic=g.join("OR"),d(),a.RemotingStubs.load(JSON.stringify(f),function(a,d){e();var f=JSON.parse(a),g=f[0];d.status&&(ab[b.term]=g.data,c(g.data))},{escape:!1})},onChange:function(c,d){var e={};return n.each(_,function(c,f){var g=a.Mustache.render(f,d.item);e[c]=g,p.updateState(b,{key:c,value:g})}),i.onChange&&i.onChange(e[u]),!1},onFocus:function(b,c){return bb.val(a.Mustache.render(_[u],c.item)),!1},onClose:function(){bb.focus()},onClear:function(){var a={};return n.each(_,function(c){var d="";a[c]=d,p.updateState(b,{key:c,value:d})}),i.onChange&&i.onChange(a[u]),!1},optionRenderer:function(b,c){var d="<a>"+a.Mustache.render($,c)+"</a>";return n.each(X,function(a,b){d=d.replace(b,"<b>"+b+"</b>")}),n("<li></li>").data("ui-autocomplete-item",c).append(d).appendTo(b)},parentElem:A});A.append(bb)}else"customaction"===i.type?(l=n("<button>").addClass("nx-picker-icon-btn"),k=n("<div>").appendTo(l).skootip(i.label).addClass("nx-picker-icon sk-icon inline "+i.icon),l.on("click",function(){i.customAction&&i.customAction()}),A.append(l)):A.append(p.getValueEditorFromMetadata(i,b,u));else;}),e}function f(a,b){if(!a||!b)return!1;var c=a.children("fields,groupby").find('field[id="'+q.escapeSelector(b)+'"]');return c&&c.length>0?!0:!1}function g(a,b,c,d,e){var f=b.split(","),g=n("<div>").addClass("nx-basicfieldeditor nx-editor-contents").append(n("<br/>")).css({"z-index":"105","text-align":"center","text-valign":"middle","float":"center"}),i=n("<select>");n.each(f,function(a,b){i["User"===b&&q.endsWith(c,"Owner")?"prepend":"append"](n("<option>").attr("value",b).text(b))}),i.appendTo(g);var j=function(f){var g={ref:i.val(),isPolymorphic:!0};g.rel=c===b&&-1!==b.indexOf(",")?i.val():c,a.push(g),e.resolve(),h(a,d),f.dialog("destroy")};g.dialog({draggable:!1,closeOnEscape:!1,resizable:!1,modal:!0,title:"Choose a related Object to pick Fields from",width:"400px",close:function(){j(n(this))},hide:"slide",show:"slide",buttons:[{text:"Go",click:function(){j(n(this))
}}]})}function h(a,b){b=b||{};var c=n.Deferred(),d=b.element,e=b.headertext,i=b.filterboxwrapper,j=b.isSelected,k=b.onChange,l=b.isMultiselect,m=b.selectedOnly,o=b.childRelationshipsOnly,r=b.showDragHandles&&a.length&&a[0].id||!1,s=b.showObjectPickerIfPolymorphic===!0,t=b.allowModelFieldAdds,u=b.onModelAddChange;if(e.empty(),d.empty(),i.empty(),a.length){var v=p.processBreadCrumbInfo(a,{showObjectPickerIfPolymorphic:s});if(e.append(v.elements),v.endsobject&&-1!==v.endsobject.indexOf(",")&&s)return a.splice(a.length-1,1),g(a,v.endsobject,v.endrel,b,c),c;var w=n('<input type="text" placeholder="Search...">').css({"float":"right",margin:"4px",padding:"2px",width:"200px"});i.append(w),w.focus();var x=n('<table cellpadding="0" cellspacing="0">').addClass("nx-skootable-data"),y=n("<tbody>").appendTo(x);if(d.append(x),!v.endsobject)return y.append(n('<div style="padding: 10px; font-size: 12pt;">').text("Select an SObject for this Model.")),c;v.isAggregate?y.on("click",".customfieldpicker",function(){var a=n(this).closest("tr").data("field");k&&k(v.prefix+a,!0,v.targetObjects)}):y.on("change",'input[type="checkbox"],input[type="radio"]',function(){var a=n(this).closest("tr").data("field");r&&n(this).closest("tr").find(".nx-draghandle").toggle(this.checked),m&&n(this).closest("tr").remove(),k&&k(v.prefix+a,this.checked,v.targetObjects)}),y.on("click",".sk-bi-follow-ref",function(){var c=n(this).closest("tr"),d=c.data("rel"),e=c.data("ref"),f=c.data("isPolymorphic");if(f&&-1!==e.indexOf(","))g(a,e,d,b);else{var i={rel:d,ref:e,isPolymorphic:!1};"Name"===e&&(i.possibleTargetObjects=c.data("possibleTargetObjects")),a.push(i),h(a,b)}}),e.off().on("click",".nx-pagebuilder-breadcrumb-link",function(){h(a.slice(0,n(this).index()+1),b)}),q.delayInputCallback(w,function(a){a?(y.children().hide(),y.children().filter(function(){var b=-1!==n(this).attr("data-field").toLowerCase().indexOf(a.toLowerCase()),c=-1!==n(this).attr("data-label").toLowerCase().indexOf(a.toLowerCase());return b||c}).show()):y.children().show()}),y.append(n('<div style="padding: 10px; font-size: 12pt;">').text("Loading metadata for object: "+v.endsobject+"...")),p.getFields(v.endsobject,function(d){y.empty();var e=o?d.childRelationships:d.fields,g=a.length?a[a.length-1]:!1,h=g&&"Name"===g.ref,i=h?g.possibleTargetObjects:!1;n.each(e,function(){var a,c,d=this;if(o?(a=d.relationshipName,c=d.relationshipName,d.displaytype=""):(a=d.id,c=d.label),b.filter&&!b.filter(d,g,v.prefix+a))return!0;if(h&&!p.isValidFieldForPossibleTargetObjects(d,i))return!0;var e=j&&j(v.prefix+a);if(m&&!e)return!0;var k,q=this,s=n("<tr>").attr("data-field",a).attr("data-label",c),w=n('<td style="width: 5px;">');r&&(k=n("<div>").addClass("nx-draghandle nx-pagebuilder-field").attr("data-model",v.modelId).data("generateOptions",{fieldId:v.prefix+a,doNotSelect:!0,isChildRelationship:o}),k.append(n("<div>").append(n("<div>").addClass("nx-draghandle-item"),n("<div>").addClass("nx-draghandle-item")).addClass("nx-draghandle-row"),n("<div>").append(n("<div>").addClass("nx-draghandle-item"),n("<div>").addClass("nx-draghandle-item")).addClass("nx-draghandle-row"),n("<div>").append(n("<div>").addClass("nx-draghandle-item"),n("<div>").addClass("nx-draghandle-item")).addClass("nx-draghandle-row")),w.append(k),k.draggable({appendTo:".nx-page",helper:function(){var a=n("<div>").append(n(this).clone().css("float","left"),n("<div>").text(q.label).css("margin","6px 6px 6px 22px"));return a.css({"z-index":1e3,border:"1px solid #CCC","background-color":"#EEE",padding:"4px"}),a},revert:"invalid",delay:200}));var x=n('<td style="width: 24px;">');if(t&&u&&!m&&v.modelId&&f(v.modelId,v.prefix+a)===!1){var z={addIcon:"sk-bi-model-add",deleteIcon:"sk-bi-model-delete",addTitle:"Add field to model",deleteTitle:"Remove field from model"},A=function(b){u(v.prefix+a,!0),D.show(),b.removeClass(z.addIcon).addClass(z.deleteIcon).attr("title",z.deleteTitle).on("click",function(){B(b)})},B=function(b){u(v.prefix+a,!1),D.hide(),b.removeClass(z.deleteIcon).addClass(z.addIcon).attr("title",z.addTitle).on("click",function(){A(b)})},C=n("<div>").addClass("sk-icon "+z.addIcon).css({margin:"7px 4px 6px 4px",cursor:"pointer"}).attr("title",z.addTitle).on("click",function(){var a=n(this);a.hasClass(z.addIcon)?A(a):a.hasClass(z.deleteIcon)&&B(a)});x.append(C)}var D,E=n('<td style="width: 24px;">');(!b.selectable||b.selectable&&b.selectable(this,v.prefix+a))&&(D=v.isAggregate?n('<div class="sk-icon '+(b.customPickerIcon||"sk-icon-save")+' customfieldpicker">').css({margin:"6px",cursor:"pointer"}):n(l?'<input type="checkbox" style="margin:9px 6px 8px 6px;">':'<input type="radio" name="fieldpicker" style="margin:9px 6px 8px 6px;">'),e&&!v.isAggregate&&D.prop("checked",!0),r&&!e&&k.hide(),E.append(D),t&&v.modelId&&f(v.modelId,v.prefix+a)===!1&&D.hide());var F=n('<td style="width: 30px;">');"REFERENCE"===this.displaytype&&"null"!==this.rel&&this.referenceTo&&this.referenceTo.length&&(s.attr("data-rel",this.rel).attr("data-ref",this.ref),"Name"===this.ref&&s.data("possibleTargetObjects",this.possibleTargetObjects),s.data("isPolymorphic",this.isPolymorphic),F.append(n('<div class="sk-icon sk-bi-follow-ref">').css("margin","6px").css("cursor","pointer")));var G=n('<td style="padding: 8px;">'+c+"</td>"),H=n('<td style="padding: 8px;">'+(o?this.childSObject+" > "+this.field:a)+"</td>"),I=n('<td style="padding: 8px;">').text(this.displaytype+("REFERENCE"===this.displaytype&&this.referenceTo&&this.referenceTo.length?" ("+(this.referenceTo.length>2?this.referenceTo.length+" possible objects":this.ref)+")":""));r&&s.append(w),t&&u&&!m&&s.append(x),s.append(E,F,G,H,I),y.append(s)}),c.resolve()})}return c}function i(b){var c=b.component,d=c.state,e=p.getModelFromModelName(b.modelName&&b.modelName()||d.attr("model")),g="aggregate"===e.attr("type"),i=[];return b=n.extend({allowModelFieldAdds:!0,isMultiselect:!0},b||{}),g||i.push({text:"Model Field(s)",icon:"sk-bi-model",action:function(){var e=n("<div>").addClass("nx-picker-wrapper"),i=n("<div>").addClass("nx-pagebuilder-fieldpicker-header").appendTo(e),j=n("<div>").appendTo(i),k=n("<div>").addClass("nx-pagebuilder-buttonwrapper").css({"float":"right",margin:"0px 6px 4px"}).appendTo(i),l=n("<div>").text("All Fields").addClass("nx-pagebuilder-toolbarpanel-propgroup").appendTo(k),m=n("<div>").text("Selected Fields").addClass("nx-pagebuilder-toolbarpanel-propgroup on").appendTo(k),o=n("<div>").addClass("nx-pagebuilder-fieldpicker-headertext").appendTo(i),r=n("<div>").addClass("nx-pagebuilder-fieldpicker-body").appendTo(e),s=[],t=[],u=p.getModelFromModelName(b.modelName&&b.modelName()||d.attr("model")),v=u?u.attr("sobject"):null,w=function(a,c){h([{rel:v,ref:v,id:u}],{element:a,headertext:o,filterboxwrapper:j,isSelected:b.isSelected||function(a){return n.inArray(a,s)>-1},onChange:b.onChange||function(a,b){b===!0?s.push(a):b===!1&&(s=s.filter(function(b){return b!==a}))},isMultiselect:b.isMultiselect,filter:b.filter||function(a,b,d){var e=!0;if((g||"selectedOnly"===c)&&"REFERENCE"!==a.displaytype){var f=u.children("fields,groupby").find('field[id="'+q.escapeSelector(d)+'"]');0===f.length&&(e=!1)}return e},selectable:b.selectable||function(a,b){var d=!0;if(g||"selectedOnly"===c){var e=u.children("fields,groupby").find('field[id="'+q.escapeSelector(b)+'"]');0===e.length&&(d=!1)}return d},allowModelFieldAdds:!g&&"selectedOnly"!==c&&b.allowModelFieldAdds===!0,onModelAddChange:b.onModelAddChange||function(a,b){b===!0?t.push(a):b===!1&&(t=t.filter(function(b){return b!==a}))}})};l.click(function(){l.hasClass("on")||(l.addClass("on"),m.removeClass("on"),r.empty(),w(r,"allFields"))}),m.click(function(){m.hasClass("on")||(m.addClass("on"),l.removeClass("on"),r.empty(),w(r,"selectedOnly"))}),w(r,"selectedOnly"),e.dialog({autoOpen:!0,draggable:!0,resizable:!1,width:800,height:468,title:"Add Field(s)",modal:!0,buttons:[{text:"Apply",id:"apply",icons:{primary:"sk-icon-save sk-icon"},click:function(){t.length>0&&(n.each(t,function(){p.addFieldToModel({fieldId:this,model:u})}),a.events.publish("skuidBuilderSave")),s.length>0&&(n.each(s,function(){var a={fieldId:this};if(g){var c=u.children("fields,groupby").find('field[id="'+this+'"]');c&&c.attr("name")&&(a.fieldName=c.attr("name"))}var e=b.fieldBuilder.defaultStateGenerator(a);f(u,this)===!0&&d.children("fields").first().append(e)}),c.save().refresh()),e.dialog("close")}},{text:"Cancel",id:"cancel",icons:{primary:"sk-icon-cancel sk-icon"},click:function(){e.dialog("close")}}]})}}),i.push({text:"Template",icon:"sk-bi-template",action:function(){var a=b.fieldBuilder.defaultStateGenerator({componentId:"template"});c.state.children("fields").first().append(a),c.save().refresh()}}),i}function j(a,b,c){return a?a+" - "+(b?b+"("+c+")":c):c}function k(a,b){var c={id:"type",type:"picklist",label:"Type",defaultValue:"skuid",picklistEntries:[{label:"Skuid Page",value:"skuid"},{label:"Page Assignment",value:"assignment"}],onChange:function(){b.removeAttr("pagename objecttype actiontype modulename"),a.refresh(),a.rebuildProps()}};"visualforce"===b.attr("type")&&c.picklistEntries.push({label:"Visualforce Page",value:"visualforce"});var d={id:"pagename",type:"autocomplete",sobject:"ApexPage",fieldsToReturn:["Name","NamespacePrefix"],fieldsToSearch:["Name","NamespacePrefix"],displayTemplate:"{{NamespacePrefix}}{{^NamespacePrefix}}c{{/NamespacePrefix}}__{{Name}}",valueTemplates:{pagename:"{{NamespacePrefix}}{{^NamespacePrefix}}c{{/NamespacePrefix}}__{{Name}}"},order:"Name",label:"Visualforce Page",helptext:"The Visualforce Page whose content you would like to load in to this part of the page, in the format 'namespace__PageName', where 'namespace' is the namespace in which your VF Page is included, and 'PageName' is the API Name of the desired Visualforce Page.",required:!0,onChange:function(){a.refresh()}},e={id:"pagename",type:"autocomplete",sobject:"skuid__Page__c",fieldsToReturn:["Name","skuid__Module__c"],fieldsToSearch:["Name","skuid__Module__c"],displayTemplate:"{{Name}}{{#skuid__Module__c}} ({{skuid__Module__c}}){{/skuid__Module__c}}",valueTemplates:{pagename:"{{Name}}",module:"{{skuid__Module__c}}"},order:"Name",label:"Skuid Page",helptext:"The Skuid Page whose content you would like to load in to this part of the page.",required:!0,onChange:function(){a.refresh()}},f={id:"querystring",type:"text",label:"Query String",helptext:"The content of the query string (parameters that come after the main body of a URL) to send along with the Visualforce Page include request, e.g. 'showheader=false&id={{$Param.id}}'",required:!1,onChange:function(){a.refresh()}},g={id:"objecttype",type:"sobject",label:"Object Type",onChange:function(){a.refresh()},helptext:"(Autocomplete) API Name of an SObject that you have defined Page Assignments for."},h={id:"actiontype",type:"picklist",picklistEntries:[{label:"Tab",value:"Tab"},{label:"List",value:"List"},{label:"View",value:"View"},{label:"Edit",value:"Edit"},{label:"New",value:"New"},{label:"Clone",value:"Clone"}],label:"Action Type",helptext:"The Action Type on the selected Object that you have defined Page Assignments for.",onChange:function(){a.refresh()}},i={id:"uniqueid",type:"string",label:"Unique Id",helptext:"Optional parameter that allows this Page Include Component to be referenced by other Components, such as Queues, or manipulated via JavaScript."},j={id:"lazyload",type:"boolean",label:"Lazy Load",helptext:"If true, this Page Include will not load immediately. This is useful when you have a Queue that will load content into this Page Include later, or when you have a Page Include in a Tab, in which case the Tab, when activated, can be configured to load the Page Include's contents. You can also load Page Includes via JavaScript, e.g. with skuid.component.getById('MyPageInclude').load();"},k={skuid:[c,e,f,i,j],assignment:[c,g,h,f,i,j],visualforce:[c,d,f,j]},l=b.attr("type"),m=k[l||"skuid"].slice(0);return m}var l,m,n=a.$,o=a.builder,p=o.core,q=a.utils,r=q.makeXMLDoc;m=o.desktop={},l=m,p.addValidActionOptions([{value:"-",label:"Visual navigation",disabled:!0},{value:"closeAllPopups",label:"Close all Popups"},{value:"closeTopmostPopup",label:"Close topmost Popup"},{value:"redirect",label:"Redirect to URL"},{value:"showPopup",label:"Show Popup"},{value:"blockUI",label:"Show message and block UI"},{value:"unblockUI",label:"Unblock the UI"}]),p.addValidActionOptions(p.getCoreActionOptions()),p.componentFactory=function(a,b,c,d){return new m.Component(a,b,c,d)},b.prototype.save=function(){return a.events.publish("skuidBuilderSave"),this},b.prototype.select=function(a){a=a||{},m.unselectCurrentComponent(this.element);var b=this.element.is(".nx-pagebuilder-selected");return this.builder.onSelect&&this.builder.onSelect(this),a.resetPropCategory!==!1&&this.builder.resetPropCategory!==!1&&(o.pagebuilderui.cproperties.category=!1),b||(this.element.addClass("nx-pagebuilder-selected"),this.rebuildProps()),this},b.prototype.rebuildProps=function(){var a=this.builder.customPropObj||o.pagebuilderui.cproperties;return a.clear?a.clear():a.empty(),this.builder.renderProperties(a,this),this},b.prototype.remove=function(a,b){this.actionbar.find(".nx-pagebuilder-component-actionitem").tooltip().hide();var c=o.pagebuilderui.cproperties;return a||(c.clear?c.clear():c.empty()),this.element.next().is(".nx-dropzone")&&this.element.next().remove(),this.element.remove(),this.state.remove(),b!==!0&&this.save(),p.unregisterComponent(this),this},b.prototype.refresh=function(){var b=this;return b.body.empty(),b.actionbar.detach().empty(),b.header.detach().empty(),b.headerWrapper.empty().append(b.actionbar,b.header),b.isGlobalComponent&&b.addActionItem(a.label.read("remove"),"sk-icon-delete",function(){b.remove()}),b.builder.renderComponent(b,{isRefresh:!0}),b},b.prototype.addActionGroup=function(a,b,c){var d=n("<div>").addClass("nx-pagebuilder-component-actionitem");c?n("<div>").addClass("nx-pagebuilder-component-actionicon sk-icon "+c).appendTo(d):d.css("padding-left","8px"),d.append(n("<div>").addClass("nx-pagebuilder-component-actiontext").text(b),n("<div>").addClass("nx-pagebuilder-component-actionarrow").append(n("<div>")));var e=n("<div>").addClass("nx-pagebuilder-component-actionoptions").hide();n.each(a,function(){var a=this.action,b=n("<div>").addClass("nx-pagebuilder-component-subactionitem").append(n("<div>").addClass("nx-pagebuilder-component-actionicon sk-icon "+this.icon),n("<div>").addClass("nx-pagebuilder-component-actiontext").text(this.text));b.appendTo(e).click(function(b){a&&a(),b.stopPropagation(),e.slideUp("fast")})}),d.append(e).click(function(){e.slideToggle("fast")});var f;return d.mouseleave(function(){f=setTimeout(function(){e.slideUp("fast")},1e3)}),d.mouseenter(function(){clearTimeout(f)}),this.actionbar.append(d),this},b.prototype.addActionItem=function(a,b,c,d){var e=n("<div>").addClass("nx-pagebuilder-component-actionitem").append(n("<div>").addClass("nx-pagebuilder-component-actionicon sk-icon "+b));return a&&n("<div>").addClass("nx-pagebuilder-component-actiontext").text(a).appendTo(e),e.append(n("<div>").addClass("nx-pagebuilder-component-actionspacer")),d&&e.skootip(d),e.click(function(a){c&&c(),a.stopPropagation()}),this.actionbar.append(e),this},b.prototype.addDefaultEditorConditions=function(){var a=this,b=a.builderId,c=a.state;if(-1!==n.inArray(b,["basicfieldeditor","file","pagetitle","skootable","repeat","social","template"])&&!c.children("conditions").length){var d=c.closest('action[type="popup"]'),e=c.closest("eventsource");if(d.length&&d.parent().is("rowactions")||e.length&&-1!==n.inArray(e.attr("eventclickhandler"),["custompopup","snippetthencustompopup"])){var f=r("<conditions/>"),g=r('<condition type="contextrow" field="Id" mergefield="Id" autocreated="true"/>');f.append(g),c.append(f);var h=e.length?e.first():d.closest("skootable");a.modifyAutoCreatedEditorCondition(g,h)}}},b.prototype.modifyAutoCreatedEditorCondition=function(a,b){var c=this,d=c.state;if(b){var e=b.attr("model"),f=d.attr("model");if(e&&f){var g=p.getModelFromModelName(e),h=p.getModelFromModelName(f);if(g&&h){var i=g.attr("sobject"),j=h.attr("sobject");if(i!==j)return void p.getFields(j,function(b){var c=b.fieldsMap,d="Id";c||(q.createMapForArray([b],"fields","fieldsMap",["id","name"]),c=b.fieldsMap),h.children("fields").children().each(function(){var a=n(this),b=a.attr("id"),e=c[b];return e&&e.ref&&-1!==e.ref.indexOf(i)?(d=b,!1):void 0}),a.attr("field")!==d&&a.attr("field",d)})}}}"Id"!==a.attr("field")&&a.attr("field","Id")},b.prototype.updateAutoCreatedEditorCondition=function(){var a,b,c,d=this,e=d.state,f=e.find('conditions > condition[autocreated="true"]');f.length&&(a=e.closest('action[type="popup"]'),b=e.closest("eventsource"),(a.length&&a.parent().is("rowactions")||b.length&&-1!==n.inArray(b.attr("eventclickhandler"),["custompopup","snippetthencustompopup"]))&&(c=b.length?b.first():a.closest("skootable"),d.modifyAutoCreatedEditorCondition(f,c)))},c.prototype.refresh=function(){var a=this;this.element.empty(),this.element.append(this.makeDropZone()),this.componentsXML.children().each(function(){var b=n(this),c=!a.customBuilder,d=p.componentFactory(b,a.customBuilder,!0,c);a.addComponent(d)})},c.prototype.addComponent=function(a){this.element.append(a.element,this.makeDropZone())},c.prototype.makeDropZone=function(){var a=n("<div>"),b=this;return a.addClass("nx-dropzone").droppable({accept:b.accept||".nx-pagebuilder-componenttag, .nx-pagebuilder-component-global",tolerance:"touch",drop:function(a,c){var d=n(this);if(p.dropStack=n(),d.is(".nx-dropzone-active")){var e,f=b.customBuilder||c.draggable.data("builder"),g=c.draggable.data("generateOptions"),h=!b.customBuilder,i=!1;if(c.draggable.is(".nx-pagebuilder-component"))e=c.draggable.data("object"),e.state.detach(),e.element.next().remove(),e.element.detach();else{var j=b.customBuilder?b.customBuilder:c.draggable.data("builder");e=p.componentFactory(j.getDefaultState(g),f,!0,h),i=!0}d.after(b.makeDropZone()),d.after(e.element),q.insertAtIndex(b.componentsXML,e.state,d.index()/2),i&&e.addDefaultEditorConditions(),e.save(),g&&g.doNotSelect||e.select(),d.removeClass("nx-dropzone-active")}},over:function(){p.dropStack=p.dropStack.add(n(this)),p.dropStack.removeClass("nx-dropzone-active"),p.dropStack.first().addClass("nx-dropzone-active")},out:function(){p.dropStack.removeClass("nx-dropzone-active"),p.dropStack=p.dropStack.not(n(this)),p.dropStack.first().addClass("nx-dropzone-active")}}),a},o.Builder=p.Builder,o.registerBuilder=p.registerBuilder,o.getBuilders=p.getBuilders,o.getBuilder=p.getBuilder,o.updateState=p.updateState,o.getFields=p.getFields,o.fieldsDescribeCache=p.fieldsDescribeCache,o.save=p.save,o.layoutFields=p.layoutFields,o.getConditionDisplayString=p.getConditionDisplayString,o.userinfomap=p.userinfomap,o.operatormap=p.operatormap,o.determineQuotedness=p.determineQuotedness,o.getFieldInfoFromCache=p.getFieldInfoFromCache,o.getMetadataForField=p.getMetadataForField,o.getSObjectForField=p.getSObjectForField,o.isValidFieldForPossibleTargetObjects=p.isValidFieldForPossibleTargetObjects,o.getModelFromModelName=p.getModelFromModelName,o.getSObjectNameFromModelName=p.getSObjectNameFromModelName,o.addFieldToModel=p.addFieldToModel,o.getLastSelectedModelComponent=p.getLastSelectedModelComponent,o.setLastSelectedModelComponent=p.setLastSelectedModelComponent,o.getConditionFieldPropObj=p.getConditionFieldPropObj,o.getConditionOperatorPropObj=p.getConditionOperatorPropObj,o.getConditionValueProperties=p.getConditionValueProperties,o.getFieldProperties=p.getFieldProperties,o.Component=l.Component=b,o.ComponentAcceptor=l.ComponentAcceptor=c,o.buildPropsEditor=l.buildPropsEditor=e,o.sObjectList=l.sObjectList=a.utils.sObjectList,o.makeFieldSelector=l.makeFieldSelector=h,o.makeAddFieldActionButton=l.makeAddFieldActionButton=i,o.unselectCurrentComponent=l.unselectCurrentComponent=d,o.getIncludePanelProperties=l.getIncludePanelProperties=k,o.getFieldComponentLabel=l.getFieldComponentLabel=j,o.makePopupBuilder=l.makePopupBuilder=function(a){return a||(a={}),new p.Builder({id:"popup",name:"Popup",givesContext:!0,componentRenderer:function(b){b.element.attr("title",b.state.attr("title")),b.element.css("padding","0px").css("margin","0px"),b.headerWrapper.css("padding","0px"),b.body.css("border","0px solid white"),a.contextModelName&&(b.contextModelName=a.contextModelName),b.element.dialog({autoOpen:!1,position:{my:"top",at:"top+500",of:"body"},draggable:!0,resizable:!0,open:function(){n("body").children(".ui-widget-overlay"),o.pagebuilderui.layoutcontainer.append(n("<div>").addClass("ui-widget-overlay")),o.pagebuilderui.cselector.body.find(".nx-pagebuilder-componenttag").each(function(){var a=n(this);a.is(".nx-js-createable")||n(this).hide()})},close:function(){o.pagebuilderui.layoutcontainer.find(".ui-droppable").droppable("enable"),o.pagebuilderui.layoutcontainer.children(".ui-widget-overlay").remove(),o.pagebuilderui.cselector.body.find(".nx-pagebuilder-componenttag").show(),a.linkedComponent&&a.linkedComponent.select()},width:b.state.attr("width"),height:350}),b.dialogwrapper=b.element.parent(),b.dialogwrapper.css("z-index","50").css("box-shadow","4px 4px 10px rgba(0,0,0,.25)"),b.dialogwrapper.on("click",".nx-pagebuilder-component",function(a){var b=n(this).data("object");b&&b.select(),a.stopPropagation()}),b.dialogwrapper.on("click",".ui-dialog-title",function(){b.select()});var c=new m.ComponentAcceptor(b.state.children("components"));b.body.append(c.element)},propertiesRenderer:function(b,c){b.setHeaderText(a.title||"Popup Properties"),n("html, body").animate({scrollTop:n(".nx-page").first().offset().top+56},100,"swing",function(){c.element.dialog("open"),o.pagebuilderui.layoutcontainer.find(".ui-droppable").droppable("disable")});var d;if(a.makePropsEditor)d=a.makePropsEditor(b,c);else{var e={id:"title",type:"template",location:"attribute",label:"Popup Title",onChange:function(a){c.element.dialog("option","title",a)}},f={id:"width",type:"string",label:"Width",onChange:function(a){c.element.dialog("option","width",a)}};d=m.buildPropsEditor(c.state,[e,f])}b.body.append(d),c.element.removeClass("nx-pagebuilder-selected")},defaultStateGenerator:function(a){a||(a={});var b=a.id||"popup",c=a.title||"New Popup",d=a.width||"800",e=r("<components/>");return a.childComponents&&e.append(a.childComponents),r("<"+b+' title="'+c+'" width="'+d+'"/>').append(e)}})},o.popupbuilder=m.popupbuilder=m.makePopupBuilder(),o.uniqueIdProp=m.uniqueIdProp=p.coreProps.uniqueIdProp(),o.cssClassProp=m.cssClassProp=p.coreProps.cssClassProp()}(skuid),function(a){var b={init:function(b){return this.each(function(){var c,d=a(this),e=b.axis,f=b.parentStateSelector,g=b.grandparentStateSelector,h=b.component,i=b.items,j=b.placeholder,k=b.connectWith,l=b.containment;i&&(c=i.substr(2)),h&&d.sortable({items:i?i:"> *",placeholder:j?j:!1,axis:e,opacity:.75,delay:200,tolerance:"pointer",revert:200,connectWith:k?k:!1,containment:l?l:!1,start:function(a,b){b.item.startingIndex="> *"==i?b.item.index():b.item.parent().children(c).index(b.item);var d=b.item.parent().closest(".nx-pagebuilder-component").parent().children(".nx-pagebuilder-component"),e=b.item.parent().closest(".nx-pagebuilder-component");b.item.parentStartingIndex=d.index(e)},stop:function(a,d){var e,j,k,l=d.item.startingIndex,m="> *"==i?d.item.index():d.item.parent().children(c).index(d.item),n=d.item.parentStartingIndex,o=d.item.parent().closest(".nx-pagebuilder-component").parent().children(".nx-pagebuilder-component"),p=d.item.parent().closest(".nx-pagebuilder-component"),q=o.index(p);if(n!=q){var r=h.state.find(g).eq(n).children(f).first(),s=h.state.find(g).eq(q).children(f).first();j=r.children().eq(l),j.detach(),k=s.children().length,k>m?j.insertBefore(s.children().eq(m)):m>=k&&j.appendTo(s)}else e=f?f&&g?h.state.find(g).eq(q).children(f).first():h.state.find(f).first():h.state,j=e.children().eq(l),j.detach(),k=e.children().length,k>m?j.insertBefore(e.children().eq(m)):m>=k&&j.appendTo(e);h.save(),b.onSort&&b.onSort(d.item)}})})}};a.fn.sortableComponent=function(c){return b[c]?b[c].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof c&&c?void a.error("Method "+c+" does not exist on the sortableComponent plugin"):b.init.apply(this,arguments)}}(skuid.$),function(a){var b=a.$,c=a.utils,d=a.builder,e=d.core,f=c.makeXMLDoc;e.registerBuilder(new e.Builder({id:"condition",name:"Condition",hideFromComponentsList:!0,hideWrapper:!0,handleStateEvent:function(b,c,d){("model.remove"===c.type||"model.idChange"===c.type)&&(e.handleModelRemove(b,c,{component:d}),e.handleModelIdChange(b,c)&&d&&a.events.publish("skuidBuilderComponentNeedsRefresh",[d]))},defaultStateGenerator:function(){return f('<condition type="fieldvalue" value="" enclosevalueinquotes="true"/>')},componentRenderer:function(a){a.body.css("padding","0px"),a.actionbar.css("top","1px");var c=b("<div>").addClass("nx-pagebuilder-conditiontag");c.append(b("<div>").css("float","left").addClass("sk-icon sk-bi-condition"));var d=a.state.attr("type"),g=e.getConditionDisplayString(a.state);c.append(b("<div>").addClass("nx-pagebuilder-conditionlabel").css({"margin-left":"24px","margin-top":"1px"}).text(g)),a.body.append(c),a.isSubcondition=a.state.parent().parent().is("condition"),a.addActionItem("","sk-bi-condition-delete",function(){var b=a.element.parent().parent().parent().data("object");a.remove(),b.refresh().select()},a.isSubcondition?"Remove this Sub-Condition":"Remove this Condition");var h=b("<div>").addClass("nx-pagebuilder-conditionschildren").show(),i=e.getBuilder("condition");a.state.children("conditions").children().each(function(){var a=e.componentFactory(b(this),i);a.element.css("margin-left","24px"),h.append(a.element)}),a.isSubcondition||"join"!==d||a.addActionItem("","sk-bi-condition-add",function(){var b=a.state.attr("joinobject"),c="undefined"!=typeof b&&b!==!1;if("join"!==d||c){var g=a.state.children("conditions");g.length||(g=f("<conditions/>"),a.state.append(g));var j=i.getDefaultState();g.append(j);var k=e.componentFactory(j,i);k.element.css("margin-left","24px"),h.append(k.element),a.save()}else window.alert("You must choose a Join Object for this Condition before creating Sub-Conditions.")},"Add a Sub-Condition"),a.body.append(h)},propertiesRenderer:function(c,d){var f=d.state,g=f.closest("model").attr("sobject"),h=b("<div>").css("height","100%"),i=b("<div>").addClass("nx-pagebuilder-propsidebar"),j=b("<div>").addClass("nx-pagebuilder-propmainbar"),k={field:null,operator:null,value:null,state:null},l=function(){var b=e.getConditionFieldPropObj(d,{handleChange:m});d.isSubcondition&&"join"===d.state.parent().closest("condition").attr("type")&&(b.sobject=d.state.parent().closest("condition").attr("joinobject"));var c=["fieldvalue","multiple","param","userinfo","blank","modelmerge"];d.isSubcondition||c.push("join");var f={field:[b],operator:[e.getConditionOperatorPropObj(d,{fieldMetadata:e.getMetadataForField(d),handleChange:m})],value:e.getConditionValueProperties(d,{handleChange:m,handleRefresh:l,validTypes:c}),state:e.getConditionStateProperties(d,{handleChange:m,handleRefresh:l})};j.empty(),a.builder.buildPropsEditor(d.state,f[d.cattag]||[],{columnCount:1}).css({padding:"4px",margin:"0px",clear:"none"}).appendTo(j)},m=function(){i.empty(),b.each(k,function(a){k[a]=b("<div>").addClass("nx-pagebuilder-propertytag").attr("data-prop",a).append(b("<div>").addClass("nx-pagebuilder-propertytaglabel").text(a),b("<div>").addClass("nx-pagebuilder-propertytagbody").html(e.conditionDescriptionRenderers[a](f,g))),i.append(k[a])})};m(),h.append(i,j),c.body.append(h),c.setHeaderText("Condition Properties"),i.on("click",".nx-pagebuilder-propertytag",function(){var a=b(this);d.cattag=a.data("prop"),a.siblings().removeClass("nx-pagebuilder-selected"),a.addClass("nx-pagebuilder-selected"),l()}),k[d.cattag||"field"].click()}}))}(skuid),function(a){function b(){function b(a){var b=a.data("builder"),c=e.pagebuilderui.cproperties;if(c.clear(),e.pagebuilderui.find(".nx-pagebuilder-selected").removeClass("nx-pagebuilder-selected"),a.addClass("nx-pagebuilder-selected"),c.setHeaderText(b.name),b.helplink){var f=d("<a>").css("float","right").css("font-size","7pt").attr("target","_blank").attr("href",b.helplink);f.append(d("<div>").text(b.name+" Help").css("display","inline-block").css("vertical-align","middle")),f.append(d("<div>").css("margin","8px").addClass("inline sk-icon sk-icon-help").css("vertical-align","middle")),c.header.prepend(f)}e.pagebuilderui.cproperties.body.empty().append(d("<div>").addClass("nx-pagebuilder-infotext").html(b.description+"<br/><br/>To add this component to a page, drag it into the component workspace."))}function c(a,c,e){var f=d("<div>").addClass("nx-pagebuilder-componenttag");c.isJSCreateable&&f.addClass("nx-js-createable"),f.data("builder",c),f.append(d("<div>").css("float","left").addClass("sk-icon "+c.icon)),f.append(d("<div>").css("margin-left","24px").css("margin-top","1px").text(c.name)),e.append(f),f.attr("data-ctype",c.id).data("generateOptions",{componentId:c.id}),f.draggable({appendTo:".nx-page",helper:function(){var a=d(this).clone();return a.css({"z-index":1e3,border:"1px solid #CCC","background-color":"#EEE"}),a},start:function(){b(d(this))},revert:"invalid"})}function g(a,b,c){var e=d("<div>").addClass("nx-pagebuilder-folderwrapper"),f=d("<div>").addClass("nx-pagebuilder-foldertag"),g=d("<div>").addClass("nx-pagebuilder-foldercomponentswrapper").hide();f.append(d("<div>").css("float","right").addClass("ui-icon ui-icon-triangle-1-e")),f.append(d("<div>").css("float","left").addClass("sk-icon "+(b.icon?b.icon:"sk-icon-component-pack"))),f.append(d("<div>").css("margin-left","24px").css("margin-top","1px").text(b.name)),e.append(f,g),c.append(e);var h=k[b.id];i(h,g)}function i(a,b){null!==a&&d.each(a,function(a){var e=a.split("__"),g="skuidcore"===e[0]?e[1]:a,h=f.getBuilder(g);if(h){if(c(a,h,b),h.hideFromComponentsList)return!0}else d(".nx-page").data("component").addProblem("Could not load the builder for the "+a+" component.")})}var j=this;if(this.element=d("<div>"),this.body=d("<div>").addClass("nx-pagebuilder-toolbarpanel-body"),a.page.useComponentPacks){var k={},l={},m={};d.each(f.availablePacks,function(){var a=this,b=a.components,c=a.folders;b&&b.length&&d.each(b,function(){this.folderId?(this.folderId in k||(k[this.folderId]={}),k[this.folderId][a.id+"__"+this.id]=this):l[a.id+"__"+this.id]=this}),c&&c.length&&d.each(c,function(){m[a.id+"__"+this.id]=this})}),i(l,j.body),d.each(m,function(a,b){g(a,b,j.body)})}else{var n={};d.each(f.getBuilders(),function(a,b){return b.hideFromComponentsList?!0:(b.name in n||(n[b.name]=[]),void n[b.name].push(b))});var o=Object.keys(n).sort(),p=[];d.each(o,function(a,b){d.each(n[b],function(a,b){p.push(b)})}),d.each(p,function(a,b){c(a,b,j.body)})}this.body.on("click",".nx-pagebuilder-componenttag",function(){b(d(this))}),this.body.on("click",".nx-pagebuilder-foldertag",function(){var a=d(this),b=a.find(".ui-icon");b.is(".ui-icon-triangle-1-e")?b.removeClass("ui-icon-triangle-1-e").addClass("ui-icon-triangle-1-s"):b.removeClass("ui-icon-triangle-1-s").addClass("ui-icon-triangle-1-e"),h.niceExpand(a,a.parent().children(".nx-pagebuilder-foldercomponentswrapper").first(),34)}),this.element.append(this.body)}function c(){this.element=d("<div>").addClass("nx-pagebuilder-toolbarpanel").css("width","65%").css("border-left","5px solid white"),this.header=d("<div>").addClass("nx-pagebuilder-toolbarpanel-header ui-widget-header"),this.propGroups=d("<div>").addClass("nx-pagebuilder-toolbarpanel-propgroups").appendTo(this.header),this.headertext=d("<div>").addClass("nx-pagebuilder-toolbarpanel-headertext").appendTo(this.header),this.body=d("<div>").addClass("nx-pagebuilder-toolbarpanel-body"),this.element.append(this.header,this.body)}var d=a.$,e=a.builder,f=e.core,g=e.desktop,h=a.utils,i=a.model,j=h.makeXMLDoc,k=a.snippet,l=k.getSnippet,m=k.registerSnippet,n=a.events.publish,o=g.getFieldComponentLabel,p=function(a){return o(a.attr("name"),a.attr("function"),a.attr("id"))
},q=new f.Builder({id:"field",name:"Field",componentRenderer:function(a){var b=a.state.attr("id"),c=a.state.attr("name"),e=a.state.closest("model").attr("id");a.body.css("padding","0px").css("overflow","visible"),a.actionbar.addClass("nx-pagebuilder-actionbar-tag"),a.element.attr({"data-fieldId":b,"data-fieldName":c});var g=d("<div>").addClass("nx-pagebuilder-fieldtag nx-pagebuilder-field").attr("data-model",e).data("generateOptions",{fieldId:b,fieldName:c,isChildRelationship:"childRelationship"===a.state.attr("type")});g.append(d("<div>").css("float","left").addClass("sk-icon sk-bi-"+("childRelationship"===a.state.attr("type")?"childrelfield":"field")));var h=p(a.state);g.append(d("<div>").css("margin-left","24px").css("margin-top","1px").html(h.replace(".",".<wbr>"))),a.body.append(g),g.draggable({appendTo:".nx-page",helper:function(){var a=d(this).clone();return a.css({"z-index":1e3,border:"1px solid #CCC","background-color":"#EEE","padding-left":"8px"}),a},revert:"invalid"}),a.addActionItem("","sk-icon-delete",function(){var b=a.state.attr("id"),c=a.state.closest("model"),d=c.attr("id");a.remove(!1,!0),n("skuidBuilderNeedSave"),f.publishStateEvent({type:"model.field.remove",fieldId:b,modelId:d})})},propertiesRenderer:function(a,b){var c,e,i=b.state,k=i.parent().is("groupby");if("aggregate"===i.closest("model").attr("type")){var l=[];if(k){if(k){var m=f.getMetadataForField(b);if(m&&(e=m.displaytype,e&&("DATE"==e||"DATETIME"==e))){var o="DATETIME"==e,r=[];o||r.push({label:"--None--",value:"",abbrev:""}),r.push({label:"CALENDAR_MONTH",value:"CALENDAR_MONTH",abbrev:"cm"},{label:"CALENDAR_QUARTER",value:"CALENDAR_QUARTER",abbrev:"cq"},{label:"CALENDAR_YEAR",value:"CALENDAR_YEAR",abbrev:"cy"},{label:"DAY_IN_MONTH",value:"DAY_IN_MONTH",abbrev:"dm"},{label:"DAY_IN_WEEK",value:"DAY_IN_WEEK",abbrev:"dw"},{label:"DAY_IN_YEAR",value:"DAY_IN_YEAR",abbrev:"dy"}),o&&r.push({label:"DAY_ONLY",value:"DAY_ONLY",abbrev:"do"}),r.push({label:"FISCAL_MONTH",value:"FISCAL_MONTH",abbrev:"fm"},{label:"FISCAL_QUARTER",value:"FISCAL_QUARTER",abbrev:"fq"},{label:"FISCAL_YEAR",value:"FISCAL_YEAR",abbrev:"fy"},{label:"HOUR_IN_DAY",value:"HOUR_IN_DAY",abbrev:"hd"},{label:"WEEK_IN_MONTH",value:"WEEK_IN_MONTH",abbrev:"wm"},{label:"WEEK_IN_YEAR",value:"WEEK_IN_YEAR",abbrev:"wy"}),l.push({id:"function",type:"picklist",label:"Function",helptext:"The Date Function to use",defaultValue:o?"CALENDAR_YEAR":"",picklistEntries:r,onChange:function(a){var c;d.each(r,function(b,d){return d.value==a?(c=d.abbrev,!1):void 0}),null!==c&&b.state.attr("name",f.getDefaultAliasName(b.state.attr("id"),c)),b.save().refresh().rebuildProps()}})}}}else l.push({id:"function",type:"picklist",label:"Function",helptext:"The Aggregation function to use",defaultValue:"SUM",required:!0,picklistEntries:[{label:"COUNT",value:"COUNT"},{label:"COUNT DISTINCT",value:"COUNT_DISTINCT"},{label:"SUM",value:"SUM"},{label:"AVG",value:"AVG"},{label:"MAX",value:"MAX"},{label:"MIN",value:"MIN"}],onChange:function(a){a&&b.state.attr("name",f.getDefaultAliasName(b.state.attr("id"),a)),b.save().refresh().rebuildProps()}});l.push({id:"name",type:"string",label:"Alias Name",helptext:"An alias for this field to be used in Components that refer to it. Must be alphanumeric and have 3-25 characters.",onChange:function(c){c||b.state.attr("name",f.getDefaultAliasName(b.state.attr("id"),b.state.attr("function"))),b.save().refresh(),a.setHeaderText("Field: "+p(b.state))}});var s=g.buildPropsEditor(b.state,l);a.body.empty().append(s)}else if("childRelationship"===i.attr("type")){var t=d("<div>");a.header.prepend(t);var u,v=b.state.closest("model"),w=v.attr("sobject"),x=v.attr("id");d.each(f.fieldsDescribeCache[w].childRelationships,function(){return this.relationshipName===i.attr("id")?(u=this.childSObject,!1):void 0}),c=[{name:"Fields",customPropFunction:function(b,c){t.css("visibility","visible"),g.makeFieldSelector([{rel:u,ref:u,id:x}],{element:b,showDragHandles:!1,headertext:a.headertext,filterboxwrapper:t,isMultiselect:!0,isSelected:function(a){var b=c.children("fields");return b.length&&b.children('[id="'+h.escapeSelector(a)+'"]').length},onChange:function(a,b){var d=c.children("fields");d.length||(d=j("<fields/>"),c.append(d));var e=d.children('[id="'+h.escapeSelector(a)+'"]');b&&0===e.length?d.append(q.getDefaultState({id:a})):e.remove(),t.children("input").first().select(),n("skuidBuilderNeedSave"),f.publishStateEvent({type:"model.field.remove",parentChildRelationship:c.attr("id"),fieldId:a,modelId:x})}})}},{name:"Conditions",beforeChange:function(){t.css("visibility","hidden")},tree:{id:"conditions",label:"Conditions",deleteable:!1,icon:"sk-bi-conditions",isChild:!0,children:[{id:"condition",labelFunction:function(a){return f.getConditionDisplayString(a)},defaultStateFunction:function(){return j('<condition enclosevalueinquotes="true" operator="="/>')},propsFunction:function(a){a.isChildRelationshipCondition=!0;var b=[f.getConditionFieldPropObj(a,{sobject:u,handleChange:function(){a.rebuildProps()}}),f.getConditionOperatorPropObj(a,{fieldMetadata:f.getMetadataForField(a)})];return b.concat(f.getConditionValueProperties(a,{handleRefresh:function(){a.rebuildProps()},validTypes:["fieldvalue","multiple","blank","userinfo","modelmerge","param"]}))}}]}},{name:"Properties",beforeChange:function(){t.css("visibility","hidden")},props:[{id:"limit",type:"string",label:"Max # of Records (Limit)"},{id:"orderby",type:"string",label:"Fields to Order Records By"}]}],a.applyPropsWithCategories(c,b.state)}if("true"===i.attr("uionly")){var y,z={id:"id",type:"string",label:"Field Id",onChange:function(){a.setHeaderText("Field: "+p(i))}},A={id:"label",type:"template",location:"attribute",displayAs:"input",label:"Label"},B={id:"displaytype",label:"Display Type",type:"picklist",defaultValue:"TEXT",picklistEntries:[{value:"BOOLEAN",label:"Checkbox"},{value:"CURRENCY",label:"Currency"},{value:"PERCENT",label:"Percent"},{value:"PICKLIST",label:"Picklist"},{value:"MULTIPICKLIST",label:"Multi-select Picklist"},{value:"DOUBLE",label:"Number"},{value:"TEXT",label:"Text"},{value:"TEXTAREA",label:"Textarea"}],onChange:function(){b.save().rebuildProps()}};if(e=i.attr("displaytype")||"TEXT","PICKLIST"===e||"MULTIPICKLIST"===e)c=[{name:"Basic",props:[z,A,B]},{name:"Picklist Entries",tree:{id:"picklistEntries",label:"Picklist Entries",deleteable:!1,icon:"sk-bi-options",isChild:!0,children:[{id:"entry",labelFunction:function(a){return a.attr("label")||"[No Label]"},defaultStateFunction:function(){return j('<entry value="New Entry" label="New Entry"/>')},propsFunction:function(a){return[{id:"value",label:"Value",type:"string"},{id:"label",label:"Label",type:"template",displayAs:"input",location:"attribute",onChange:function(){a.save().refresh()}}]}}]}}];else if(-1!==d.inArray(e,["DOUBLE","CURRENCY","PERCENT"])){var C={id:"precision",label:"Length",type:"picklist",helptext:"Number of digits to the LEFT of the decimal point",defaultValue:"9",picklistEntries:[]},D={id:"scale",label:"Decimal Places",type:"picklist",helptext:"Number of digits to the RIGHT of the decimal point",defaultValue:"2",picklistEntries:[]};for(y=0;18>y;)C.picklistEntries.push({value:""+y,label:""+y}),10>y&&D.picklistEntries.push({value:""+y,label:""+y}),y++;c=[{name:"Basic",props:[z,A,B,C,D]}]}else if("INTEGER"===e){var E={id:"digits",label:"Length",type:"picklist",defaultValue:"9",picklistEntries:[]};for(y=0;18>y;)E.picklistEntries.push({value:""+y,label:""+y}),y++;c=[{name:"Basic",props:[z,A,B,E]}]}else if(-1!==d.inArray(e,["TEXT","TEXTAREA"])){var F={id:"length",label:"Length",type:"string",helptext:"The maximum number of characters that can be entered in this field",defaultValue:"255"};c=[{name:"Basic",props:[z,A,B,F]}]}else c=[{name:"Basic",props:[z,A,B]}];a.applyPropsWithCategories(c,i)}a.setHeaderText("Field: "+p(i))},hideWrapper:!0,defaultStateGenerator:function(a){return f.defaultStateGenerators.field(a)}});e.fieldBuilder=g.fieldbuilder=q;var r=f.getBuilder("condition"),s=new f.Builder({id:"conditions",name:"Conditions",componentRenderer:function(a){a.body.addClass("nx-pagebuilder-conditionswrapper").css("padding","0px").css("overflow","visible"),a.actionbar.addClass("nx-pagebuilder-actionbar-tag");var b=d("<div>").addClass("nx-pagebuilder-conditionstag");b.append(d("<div>").css("float","left").addClass("sk-icon sk-bi-conditions")),b.append(d("<div>").css("margin-left","24px").css("margin-top","1px").text("Conditions")),a.body.append(b);var c=d("<div>").addClass("nx-pagebuilder-conditionschildren").hide();a.state.children().each(function(){var a=f.componentFactory(d(this),r);c.append(a.element)}),a.addActionItem("","sk-icon-add",function(){var b=r.getDefaultState();a.state.append(b);var d=f.componentFactory(b,r);c.append(d.element),h.scrollTo(d.element,34),a.save(),d.select()}),a.state.attr("logic")||c.sortableComponent({axis:"y",component:a,placeholder:"sk-placeholder"}),a.body.append(c)},propertiesRenderer:function(a,b){var c=[{id:"logic",type:"string",label:"Grouping Logic",helptext:"How to group and apply these Conditions when loading the Model, e.g. ((1 AND 2) OR (3 AND 4)). By default, all Conditions are applied."}];a.setHeaderText("Conditions");var d=g.buildPropsEditor(b.state,c);a.body.empty().append(d)},onSelect:function(a){a.element.is(".nx-pagebuilder-selected")?(a.element.find(".nx-pagebuilder-conditionschildren").hide(),a.element.removeClass("nx-pagebuilder-selected"),e.pagebuilderui.cproperties.clear()):(a.element.siblings().find(".nx-pagebuilder-groupbyfieldschildren, .nx-pagebuilder-fieldschildren").hide(),h.niceExpand(a.body.children().first(),a.element.find(".nx-pagebuilder-conditionschildren").first(),34,!0))},hideWrapper:!0}),t=new f.Builder({id:"fields",name:"Fields",componentRenderer:function(a){a.body.addClass("nx-pagebuilder-fieldswrapper").css("padding","0px").css("overflow","visible");var b=a.state.closest("model"),c="aggregate"===b.attr("type"),e=d("<div>").addClass("nx-pagebuilder-fieldstag");e.append(d("<div>").css("float","left").addClass("sk-icon sk-bi-"+(c?"fields-agg":"fields"))),e.append(d("<div>").css({"margin-left":"24px","margin-top":"1px"}).text(c?"Aggregations":"Fields")),a.body.append(e);var g=d("<div>").addClass("nx-pagebuilder-fieldschildren").hide();a.state.children().each(function(){var a=f.componentFactory(d(this),q);g.append(a.element)}),a.body.append(g)},propertiesRenderer:function(a,b){var c=b.state.closest("model"),i=c.attr("sobject"),j=c.attr("id"),k="aggregate"===c.attr("type"),l=e.pagebuilderui.cproperties.clear(!0),m=d("<div>");l.header.prepend(m);var o=function(a,d,e){g.makeFieldSelector([{rel:i,ref:i,id:j}],{element:a,showDragHandles:!k,customPickerIcon:k?"sk-bi-fields-agg-add":null,headertext:l.headertext,filterboxwrapper:m,isMultiselect:!0,isSelected:function(a){return k?!1:d.children('[id="'+h.escapeSelector(a)+'"]').length},selectedOnly:"selectedonly"===e,childRelationshipsOnly:"childonly"===e,onChange:function(a,g,i){var l=d.children('[id="'+h.escapeSelector(a)+'"]'),o=b.body.find(".nx-pagebuilder-fieldschildren");if(k||g&&0===l.length)f.addFieldToModel({fieldId:a,targetObjects:i,model:c,fieldsNode:d,fieldsElement:o,fieldBuilder:q,view:e}),n("skuidBuilderSave");else{var p=o.children('[data-fieldid="'+a+'"]'),r=p.data("object");r&&r.remove(!0,!0),n("skuidBuilderNeedSave"),f.publishStateEvent({type:"model.field.remove",fieldId:a,modelId:j})}m.children("input").first().select()}})},p=[{name:"All Fields",customPropFunction:function(a,b){o(a,b)}}];k||(p.push({name:"Selected Fields",customPropFunction:function(a,b){o(a,b,"selectedonly")}}),p.push({name:"Child Relationships",customPropFunction:function(a,b){o(a,b,"childonly")}})),l.applyPropsWithCategories(p,b.state)},onSelect:function(a){a.element.is(".nx-pagebuilder-selected")?(a.element.find(".nx-pagebuilder-fieldschildren").hide(),a.element.removeClass("nx-pagebuilder-selected"),e.pagebuilderui.cproperties.clear()):(a.element.siblings().find(".nx-pagebuilder-conditionschildren, .nx-pagebuilder-groupbyfieldschildren").hide(),h.niceExpand(a.body.children().first(),a.element.find(".nx-pagebuilder-fieldschildren").first(),34,!0))},hideWrapper:!0}),u=new f.Builder({id:"groupby",name:"Groupings",componentRenderer:function(a){a.body.addClass("nx-pagebuilder-fieldswrapper").css("padding","0px").css("overflow","visible");var b=d("<div>").addClass("nx-pagebuilder-fieldstag");b.append(d("<div>").css("float","left").addClass("sk-icon sk-bi-aggmodel-grouping")),b.append(d("<div>").css({"margin-left":"24px","margin-top":"1px"}).text("Groupings")),a.body.append(b);var c=d("<div>").addClass("nx-pagebuilder-groupbyfieldschildren").hide();a.state.children().each(function(){var a=f.componentFactory(d(this),q);c.append(a.element)}),c.sortableComponent({axis:"y",component:a,placeholder:"sk-placeholder"}),a.body.append(c)},propertiesRenderer:function(a,b){var c=b.state.parent().attr("sobject"),i=b.state.parent().first().attr("id"),j=e.pagebuilderui.cproperties.clear(!0),k=d("<div>"),l=d("<div>"),m=d("<div>");j.body.append(m,l),j.header.prepend(k),g.makeFieldSelector([{rel:c,ref:c,id:i}],{element:l,showDragHandles:!1,customPickerIcon:"sk-bi-aggmodel-grouping-add",headertext:j.headertext,filterboxwrapper:k,isMultiselect:!0,isSelected:function(a){return b.state.children('[id="'+h.escapeSelector(a)+'"]').length},onChange:function(a,c,d){var e=b.state.children('[id="'+h.escapeSelector(a)+'"]'),g=b.body.find(".nx-pagebuilder-groupbyfieldschildren");if(c&&0===e.length){var j={id:a,needsAlias:!0},l=f.getFieldInfoFromCache(i,a);l&&"DATETIME"==l.displaytype&&(j.functionName="CALENDAR_YEAR",j.alias=f.getDefaultAliasName(a,"cy"));var m=q.getDefaultState(j);d&&m.attr("targetobjects",d),b.state.append(m),g.append(f.componentFactory(m,q).element)}else{var n=g.children('[data-fieldid="'+a+'"]'),o=n.data("object");o&&o.remove(!0)}b.save(),k.children("input").first().select()},filter:function(a){return a.groupable||"DATETIME"===a.displaytype}});var n=[{id:"method",type:"picklist",label:"Grouping Method",defaultValue:"simple",picklistEntries:[{value:"simple",label:"Simple"},{value:"rollup",label:"Rollup"}],onChange:function(){}}],o=g.buildPropsEditor(b.state,n);m.empty().append(o)},onSelect:function(a){a.element.is(".nx-pagebuilder-selected")?(a.element.find(".nx-pagebuilder-groupbyfieldschildren").hide(),a.element.removeClass("nx-pagebuilder-selected"),e.pagebuilderui.cproperties.clear()):(a.element.siblings().find(".nx-pagebuilder-conditionschildren, .nx-pagebuilder-fieldschildren").hide(),h.niceExpand(a.body.children().first(),a.element.find(".nx-pagebuilder-groupbyfieldschildren").first(),34,!0))},hideWrapper:!0}),v=[{label:"Model saved",value:"models.saved"},{label:"Model requeried",value:"models.loaded"},{label:"Model cancelled",value:"models.cancelled"},{label:"New row created in Model",value:"row.created"},{label:"Row in Model updated",value:"row.updated"},{label:"Row in Model marked for deletion",value:"row.deleted"},{label:"Row in Model un-marked for deletion",value:"row.undeleted"}],w={};d.each(v,function(){w[this.value]=this});var x=new f.Builder({id:"action",name:"Action",hideFromComponentsList:!0,hideWrapper:!0,defaultStateGenerator:function(){return j("<action><actions/><events/></action>")},componentRenderer:function(a){var b,c=a.body,e=a.state,f=d("<div>").addClass("nx-pagebuilder-modelactiontag"),g=e.children("events").first().children(),h=e.children("actions").first().children().length;c.css("padding","0px"),a.actionbar.css("top","1px"),f.append(d("<div>").css("float","left").addClass("sk-icon sk-bi-model-actions")),b=g.length?"When: "+d.map(g,function(a){var b=w[d(a).text()];return b?b.label:"[Unknown Event]"}).join(" or ")+", then run "+h+" actions":"(No initiating events specified)",f.append(d("<div>").addClass("nx-pagebuilder-modelactionlabel").css({"margin-left":"24px","margin-top":"1px"}).text(b)),c.append(f),a.addActionItem("","sk-bi-condition-delete",function(){var b=a.element.parent().parent().parent().data("object");a.remove(),b.refresh().select()},"Remove this Action")},propertiesRenderer:function(a,b){a.setHeaderText("Model Action Properties");var c=b.state,d={id:"events",location:"node",type:"multipicklist",storeAs:{type:"node",name:"event"},label:"Initiating Event(s)",helpText:"If these Events occur on this Model, then the action items will be run",picklistEntries:v,noneSelectedText:"Select Events...",onChange:function(){b.save().refresh(),b.rebuildProps&&b.rebuildProps()}},e=[d],g=[{name:"Intiating Events",props:e},f.getActionsCategory({useModelName:c.closest("model").attr("id"),linkedComponent:b,onActionTypeChange:function(){b.refresh()}})];a.applyPropsWithCategories(g,c)}}),y=new f.Builder({id:"actions",name:"Actions",componentRenderer:function(a){a.body.addClass("nx-pagebuilder-modelactionswrapper").css({padding:"0px",overflow:"visible"}),a.actionbar.addClass("nx-pagebuilder-actionbar-tag");var b=d("<div>").addClass("nx-pagebuilder-modelactionstag").append(d("<div>").css("float","left").addClass("sk-icon sk-bi-model-actions"),d("<div>").css({"margin-left":"24px","margin-top":"1px"}).text("Actions"));a.body.append(b);var c=d("<div>").addClass("nx-pagebuilder-modelactionschildren").hide();a.state.children().each(function(){var a=f.componentFactory(d(this),x);c.append(a.element)}),a.addActionItem("","sk-icon-add",function(){var b=x.getDefaultState();a.state.append(b);var d=f.componentFactory(b,x);c.append(d.element),h.scrollTo(d.element,34),a.save(),d.select()}),c.sortableComponent({axis:"y",component:a,placeholder:"sk-placeholder"}),a.body.append(c)},propertiesRenderer:function(a){a.setHeaderText("Model Actions"),a.body.empty().append(d("<div>").addClass("nx-pagebuilder-infotext").html('Skuid Model Actions allow you to specify actions to perform when certain events are triggered on a given model. For example, use Model Actions to query related models (i.e. an "Action") when the given model is saved (i.e. an "Initiating Event").'))},onSelect:function(a){a.element.is(".nx-pagebuilder-selected")?(a.element.find(".nx-pagebuilder-modelactionschildren").hide(),a.element.removeClass("nx-pagebuilder-selected"),e.pagebuilderui.cproperties.clear()):(a.element.siblings().find(".nx-pagebuilder-groupbyfieldschildren, .nx-pagebuilder-fieldschildren, .nx-pagebuilder-conditionschildren").hide(),h.niceExpand(a.body.children().first(),a.element.find(".nx-pagebuilder-modelactionschildren").first(),34,!0))},hideWrapper:!0}),z=new f.Builder({id:"model",name:"Models",componentRenderer:function(b){var c=b.state,e=b.state.attr("id"),g=d("<div>").addClass("nx-pagebuilder-modeltag"),h=d("<div>").addClass("nx-pagebuilder-modelchildren"),i=c.children("fields");b.element.is(".nx-pagebuilder-selected")?h.show():h.hide(),b.body.addClass("nx-pagebuilder-modelwrapper"),b.actionbar.addClass("nx-pagebuilder-actionbar-tag"),g.append(d("<div>").css("float","left").addClass("sk-icon sk-bi-model")),g.append(d("<div>").css("margin-left","24px").css("margin-top","1px").text(e)),b.body.append(g,h),i.length||(i=j("<fields/>"),c.append(i));var k=f.componentFactory(i,t);h.append(k.element);var l=c.children("conditions");l.length||(l=j("<conditions/>"),c.append(l));var m=f.componentFactory(l,s);if(h.append(m.element),"aggregate"===c.attr("type")){var n=c.children("groupby");n.length||(n=j('<groupby method="simple"/>'),c.append(n));var o=f.componentFactory(n,u);h.append(o.element)}var p=c.children("actions");p.length||(p=j("<actions/>"),c.append(p));var q=f.componentFactory(p,y);h.append(q.element),b.addActionItem("","sk-bi-model-delete",function(){var d=a.builder.pagebuilderui.pagecomponent,e=!1;if(!e){var g="Are you sure you want to remove this Model?\n\nIf you do, any Components which reference this Model will be removed, including:\n\n -Components (or sub-components) with a Model attribute set to this Model\n -Conditions / Lookup Filters of type 'Field from another Model'";e=window.confirm(g)}if(e){var h=c.attr("id");b.remove(!1),f.publishStateEvent({type:"model.remove",modelId:h}),d.refresh()}}),b.addActionItem("","sk-icon-clone",function(){var a,d=c.clone();d.attr("id",f.getUniqueModelName(d.attr("id"))),a=f.componentFactory(d,z),b.element.parent().append(a.element),c.parent().append(a.state),a.save(),a.select()})},propertiesRenderer:function(a,b){a.setHeaderText("Model - "+b.state.attr("id"));var c=f.getModelProperties(b);a.applyPropsWithCategories(c,b.state)},hideWrapper:!0,defaultStateGenerator:function(){return f.defaultStateGenerators.model()},onSelect:function(a){f.setLastSelectedModelComponent(a),a.element.is(".nx-pagebuilder-selected")?(a.element.find(".nx-pagebuilder-modelchildren").hide(),a.element.removeClass("nx-pagebuilder-selected"),a.element.parent().parent().data("object").select()):(a.element.siblings().find(".nx-pagebuilder-modelchildren").hide(),h.niceExpand(a.body.children().first(),a.element.find(".nx-pagebuilder-modelchildren").first(),34,!0))}}),A=new f.Builder({id:"models",name:"Models",componentRenderer:function(a){a.element.addClass("nx-pagebuilder-toolbarpanel-body"),a.headerWrapper.css("position","static"),a.body.css("padding","0px").css("overflow","visible"),a.addActionItem("Add Model","sk-bi-model-add",function(){var b=f.componentFactory(z.getDefaultState(),z);a.body.append(b.element),a.state.append(b.state),a.save(),b.select()}),a.state.children().each(function(){var b=f.componentFactory(d(this),z);a.body.append(b.element)}),a.element.find(".nx-pagebuilder-component-body").first().sortableComponent({axis:"y",component:a,placeholder:"sk-placeholder"})},propertiesRenderer:function(a){a.setHeaderText("Skuid Models"),a.body.empty().append(d("<div>").addClass("nx-pagebuilder-infotext").html("Skuid Models determine what data will be pulled into this page.  Each model is based on a single Salesforce object.  Once a model is added to a page, you can set which fields to pull in as well as conditions for which records to load.  Components within the page will reference models to determine the data that they will display."))},hideWrapper:!0}),B=new f.Builder({id:"label",name:"Label",componentRenderer:function(a){var b=a.state.attr("id");a.body.addClass("nx-pagebuilder-labelwrapper").css("padding","0px"),a.actionbar.addClass("nx-pagebuilder-actionbar-tag");var c=d("<div>").addClass("nx-pagebuilder-labeltag");c.append(d("<div>").css("float","left").addClass("sk-icon sk-bi-label")),c.append(d("<div>").css("margin-left","24px").css("margin-top","1px").text(b)),a.body.append(c),a.addActionItem("","sk-bi-label-delete",function(){a.remove()})},propertiesRenderer:function(a,b){var c={onChange:function(){b.refresh(),a.setHeaderText("Label - "+b.state.attr("id"))}},d=f.getLabelProperties(c);a.setHeaderText("Label - "+b.state.attr("id"));var e=g.buildPropsEditor(b.state,d);a.body.empty().append(e)},defaultStateGenerator:function(){return f.defaultStateGenerators.label("newlabel")},hideWrapper:!0}),C=new f.Builder({id:"labels",name:"Labels",componentRenderer:function(a){a.body.addClass("nx-pagebuilder-labelswrapper").css("padding","0px"),a.actionbar.addClass("nx-pagebuilder-actionbar-tag");var b=d("<div>").addClass("nx-pagebuilder-labelstag");b.append(d("<div>").css("float","left").addClass("sk-icon sk-bi-labels")),b.append(d("<div>").css({"margin-left":"24px","margin-top":"1px"}).text("Labels")),a.body.append(b);var c=d("<div>").addClass("nx-pagebuilder-labelschildren");a.body.append(c),a.state.children().each(function(){var a=f.componentFactory(d(this),B);c.append(a.element)}),a.element.find(".nx-pagebuilder-labelschildren").first().sortableComponent({axis:"y",component:a,placeholder:"sk-placeholder"}),a.addActionItem("","sk-bi-label-add",function(){var b=B.getDefaultState();a.state.append(b);var d=f.componentFactory(b,B);c.append(d.element),h.scrollTo(d.element,34),a.save(),d.select()})},propertiesRenderer:function(a){a.setHeaderText("Included Custom Labels"),a.body.empty().append(d("<div>").addClass("nx-pagebuilder-infotext").html('Skuid allows you to use Force.com Custom Labels, along with Translation Workbench, to display public-facing text in each of your users\' preferred Language. For each Custom Label you request, Skuid will see if there is a Translation corresponding to the Language of the User viewing your Skuid Page. If there is, Skuid will display this translated text to the user. It is considered best-practice to use Custom Labels wherever displaying custom text to your users.<br/><br/>To include a Custom Label in a Template, use {{$Label.&lt;LabelName&gt;}}, e.g. {{$Label.Save}}.<br/><br/>To create a new Custom Label, go to Setup &gt; Create &gt; Custom Labels.<br/><br/>More information: <a href="http://help.skuidify.com/s/tutorials/m/supercharge-your-ui/l/102513-using-custom-labels-and-translations-in-skuid" target="SkuidBuilderHelp">Using Custom Labels and Translations in Skuid</a>'))},hideWrapper:!0}),D=new f.Builder({id:"jsitem",name:"Javascript Item",componentRenderer:function(a){var b=f.getJSItemLabel(a.state);a.body.addClass("nx-pagebuilder-labelwrapper").css("padding","0px"),a.actionbar.addClass("nx-pagebuilder-actionbar-tag");var c=d("<div>").addClass("nx-pagebuilder-labeltag");c.append(d("<div>").css("float","left").addClass("sk-icon sk-bi-jsitem")),c.append(d("<div>").css({"margin-left":"24px","margin-top":"1px"}).text(b.prefix+" "+b.name)),a.body.append(c),a.addActionItem("","sk-bi-jsitem-delete",function(){a.remove()})},propertiesRenderer:function(a,b){a.setHeaderText("Javascript Item"),a.applyPropsEditor(g.buildPropsEditor(b.state,f.getJSItemProperties(b)))},defaultStateGenerator:function(){return f.defaultStateGenerators.jsitem()},hideWrapper:!0}),E=new f.Builder({id:"javascript",name:"Javascript",componentRenderer:function(a){a.body.addClass("nx-pagebuilder-labelswrapper").css("padding","0px"),a.actionbar.addClass("nx-pagebuilder-actionbar-tag");var b=d("<div>").addClass("nx-pagebuilder-labelstag");b.append(d("<div>").css("float","left").addClass("sk-icon sk-bi-jsitems")),b.append(d("<div>").css("margin-left","24px").css("margin-top","1px").text("Javascript")),a.body.append(b);var c=d("<div>").addClass("nx-pagebuilder-javascriptchildren");a.body.append(c),a.state.children().each(function(){var a=f.componentFactory(d(this),D);c.append(a.element)}),a.element.find(".nx-pagebuilder-javascriptchildren").first().sortableComponent({axis:"y",component:a,placeholder:"sk-placeholder"}),d("head").append("<style>.sk-placeholder {min-height: 34px}</style><!-- added in PageBuilderJS -->"),a.addActionItem("","sk-bi-jsitem-add",function(){var b=D.getDefaultState();a.state.append(b);var d=f.componentFactory(b,D);c.append(d.element),h.scrollTo(d.element,34),a.save(),d.select()})},propertiesRenderer:function(a){a.setHeaderText("Included Javascript"),a.body.empty().append(d("<div>").addClass("nx-pagebuilder-infotext").html('Skuid allows you to add Javascript files that will included with this page.<br/><br/>More information: <a href="http://help.skuidify.com/s/tutorials/m/supercharge-your-ui/l/102514-including-custom-javascript-in-a-skuid-page" target="SkuidBuilderHelp">Including Custom Javascript in a Skuid Page</a>'))},hideWrapper:!0}),F=new f.Builder({id:"cssitem",name:"CSS Item",componentRenderer:function(a){var b=f.getCSSItemLabel(a.state);a.body.addClass("nx-pagebuilder-labelwrapper").css("padding","0px"),a.actionbar.addClass("nx-pagebuilder-actionbar-tag");var c=d("<div>").addClass("nx-pagebuilder-labeltag");c.append(d("<div>").css("float","left").addClass("sk-icon sk-bi-cssitem")),c.append(d("<div>").css("margin-left","24px").css("margin-top","1px").text(b)),a.body.append(c),a.addActionItem("","sk-bi-cssitem-delete",function(){a.remove()})},propertiesRenderer:function(a,b){a.setHeaderText("CSS Item"),a.applyPropsEditor(g.buildPropsEditor(b.state,f.getCSSItemProperties(b)))},defaultStateGenerator:function(){return f.defaultStateGenerators.cssitem()},hideWrapper:!0}),G=new f.Builder({id:"css",name:"CSS",componentRenderer:function(a){a.body.addClass("nx-pagebuilder-labelswrapper").css("padding","0px"),a.actionbar.addClass("nx-pagebuilder-actionbar-tag");var b=d("<div>").addClass("nx-pagebuilder-labelstag");b.append(d("<div>").css("float","left").addClass("sk-icon sk-bi-cssitems")),b.append(d("<div>").css("margin-left","24px").css("margin-top","1px").text("CSS")),a.body.append(b);var c=d("<div>").addClass("nx-pagebuilder-csschildren");a.body.append(c),a.state.children().each(function(){var a=f.componentFactory(d(this),F);c.append(a.element)}),a.element.find(".nx-pagebuilder-csschildren").first().sortableComponent({axis:"y",component:a,placeholder:"sk-placeholder"}),a.addActionItem("","sk-bi-cssitem-add",function(){var b=F.getDefaultState();a.state.append(b);var d=f.componentFactory(b,F);c.append(d.element),h.scrollTo(d.element,34),a.save(),d.select()})},propertiesRenderer:function(a){a.setHeaderText("Included CSS"),a.body.empty().append(d("<div>").addClass("nx-pagebuilder-infotext").html('Skuid allows you to add CSS files that will included with this page.<br/><br/>More information: <a href="http://help.skuidify.com/s/tutorials/m/supercharge-your-ui/l/102515-including-custom-css-in-a-skuid-page" target="SkuidBuilderHelp">Including Custom CSS in a Skuid Page</a>'))},hideWrapper:!0}),H=new f.Builder({id:"resources",name:"Resources",componentRenderer:function(a){a.element.addClass("nx-pagebuilder-toolbarpanel-body"),a.headerWrapper.css("position","static"),a.body.css("padding","0px");var b=a.state.children("labels");b.length||(b=j("<labels/>"),a.state.append(b));var c=f.componentFactory(b,C);a.body.append(c.element);var d=a.state.children("javascript");d.length||(d=j("<javascript/>"),a.state.append(d));var e=f.componentFactory(d,E);a.body.append(e.element);var g=a.state.children("css");g.length||(g=j("<css/>"),a.state.append(g));var h=f.componentFactory(g,G);a.body.append(h.element)},propertiesRenderer:function(a){a.setHeaderText("Included Custom Resources"),a.body.empty().append(d("<div>").addClass("nx-pagebuilder-infotext").html("Skuid allows you to add custom resources to a page.  These can be Force.com Custom Labels, custom Javascript, or custom css."))},hideWrapper:!0}),I=new f.Builder({id:"filter",name:"Filter",hideWrapper:!0,hideFromComponentsList:!0,handleStateEvent:function(a,b,c){if("field"===a.parent().parent().prop("tagName").toLowerCase())return!1;var e="model.condition.nameChange"===b.type,f="model.remove"===b.type,g="model.idChange"===b.type,h=!1;return e?b.modelId===a.closest("[model]").attr("model")&&(a.attr("condition")===b.oldName&&(a.attr("condition",b.newName),h=!0),d.each(a.find('effect[condition="'+b.oldName+'"]'),function(){d(this).attr("condition",b.newName),h=!0})):(f||g)&&d.each(a.find('source[model="'+(g?b.oldId:b.modelId)+'"]'),function(){g?(d(this).attr("model",b.newId),h=!0):f&&(d(this).remove(),h=!0)}),h&&(n("skuidBuilderNeedSave"),c&&n("skuidBuilderComponentNeedsRefresh",[c])),!1},componentRenderer:function(a){a.body.css("padding","0px");var b=d("<div>").css("margin-top","1px").addClass("nx-conditiontoken nx-actionselect unavailable").append(d("<div>").addClass("nx-actionselect-text").text(f.getFilterItemLabel(a.state)));a.body.append(b)},propertiesRenderer:function(b,c){b.setHeaderText("Filter Properties");var d=[{name:"Filter",tree:{id:"filter",labelFunction:f.getFilterItemLabel,linkedComponent:c,refreshLinkedComponent:!0,propsFunction:function(a){return a.modelName=c.modelName,f.getFilterItemProperties(a)},childrenFunction:function(b){var c=[];return"select"===b.state.attr("type")?c.push({id:"source",labelFunction:function(a){var b="Source: ",c=a.attr("type");return"metadata"===c?b+="Picklist Options":"model"===c?b+="Rows in a Model":"manual"===c?b+="Manual":"custom"===c&&(b+="Result of Snippet"),b},invisibleParent:"sources",indent:1,icon:"sk-bi-source",addicon:"sk-bi-source-add",deleteicon:"sk-bi-source-delete",childrenFunction:function(a){var b=[],c=a.state;return"manual"===c.attr("type")?b.push({id:"option",labelFunction:function(a){return a.attr("label")},invisibleParent:"options",indent:2,icon:"sk-bi-option",addicon:"sk-bi-option-add",deleteicon:"sk-bi-option-delete",childrenFunction:function(a){var b=[];
return"complex"===a.state.attr("type")&&b.push({id:"effect",labelFunction:f.getEffectItemLabel,invisibleParent:"effects",indent:3,icon:"sk-bi-effect",addicon:"sk-bi-effect-add",deleteicon:"sk-bi-effect-delete",propsFunction:f.getEffectItemProperties,defaultStateFunction:function(){return j('<effect action="set" value=""/>')}}),b},propsFunction:function(a){var b={id:"type",type:"picklist",label:"What Condition(s) will this Option affect?",defaultValue:"simple",picklistEntries:[{label:"Affect the Default Condition",value:"simple"},{label:"Affect Other Condition(s)",value:"complex"}],onChange:function(){a.state.empty(),a.element.children(".nx-childwrapper").empty(),a.save().refresh().rebuildProps()}},c={id:"label",label:"Label",type:"string",onChange:function(){a.refresh()}},d={id:"value",label:"Value",type:"string",onChange:function(){a.refresh()}},e={simple:[b,c,d],complex:[b,c]};return e[a.state.attr("type")]},defaultStateFunction:function(){return j('<option label="New Option" type="simple"/>')}}):("justothers"===c.attr("effectsbehavior")||"defaultandothers"===c.attr("effectsbehavior"))&&b.push({id:"effect",labelFunction:f.getEffectItemLabel,invisibleParent:"effects",indent:2,icon:"sk-bi-effect",addicon:"sk-bi-effect-add",deleteicon:"sk-bi-effect-delete",propsFunction:f.getEffectItemProperties,defaultStateFunction:function(){return j('<effect action="set" value=""/>')}}),b},propsFunction:function(b){var c,d=b.state,e={id:"type",type:"picklist",label:"Source Type",defaultValue:"manual",picklistEntries:[{label:"Manual",value:"manual"},{label:"Rows in a Model",value:"model"},{label:"Picklist Options for Condition's Field",value:"metadata"},{label:"Custom Source (Snippet)",value:"custom"}],onChange:function(){b.state.empty(),b.element.children(".nx-childwrapper").empty(),b.save().refresh().rebuildProps()}},g={id:"effectsbehavior",type:"picklist",label:"Which Conditions will this Source's Options affect?",defaultValue:"justdefault",picklistEntries:[{label:"Just the Default Condition",value:"justdefault"},{label:"Default Condition and others",value:"defaultandothers"}],onChange:function(a){"justdefault"===a&&(d.remove("effects"),b.element.children(".nx-childwrapper").empty()),b.save().refresh().rebuildProps()}},h=d.attr("model"),i=h&&f.getModelFromModelName(h);i&&(c=a.utils.getNameField(i.attr("sobject"))),c||(c="Name");var j={id:"labeltemplate",type:"template",displayAs:"input",defaultValue:"{{{"+c+"}}}",label:"Option Label Template",helptext:'Defines the visible label for each auto-created Filter Option. Example: "Account: {{Name}}". Defaults to {{{Name}}}.'},k={id:"valuetemplate",type:"template",displayAs:"input",defaultValue:"{{Id}}",label:"Value to inject into Default Condition",helptext:'Defines the value for each auto-created Filter Option, which will be injected into the Default Condition when the Option is chosen. Defaults to "{{Id}}", but can be any field included in the Model.'},l={id:"prefix",type:"string",label:"Label Prefix (optional)",helptext:'Text to insert BEFORE each auto-generated Filter Option\'s label. For example, if your Filter is on a Status field with options like "New", "Closed", you might want Label Prefix to be "New: ", so that your Option Labels will look like "Status: New", "Status: Closed", etc.'},m={id:"suffix",type:"string",label:"Label Suffix (optional)",helptext:"Text to be added after each auto-generated Filter Option's label."},n={id:"snippet",type:"string",label:"Snippet Name",helptext:"The name of a Snippet which will dynamically return a list of Options to use to build this Filter."},o={id:"model",type:"model",label:"Merge Source",helptext:"The Model whose first row's specified Merge Field's value will be used as the merge value for this Condition.",onChange:function(a,c,e){d.children("labeltemplate, valuetemplate").empty(),d.children("effects").children("effect[value]").attr("value","{{Id}}"),e&&a&&b.refresh().rebuildProps()}},p={manual:[e],model:[e,o,j,g],metadata:[e,l,m,g],custom:[e,n,g]},q=d.attr("type"),r=d.attr("effectsbehavior"),s=p[q];return"model"===q&&"justothers"!==r&&s.push(k),s},defaultStateFunction:function(){return j('<source type="manual" effectsbehavior="justdefault"/>')}}):"toggle"===b.state.attr("type")&&c.push({id:"effect",labelFunction:f.getEffectItemLabel,invisibleParent:"effects",indent:1,icon:"sk-bi-effect",addicon:"sk-bi-effect-add",deleteicon:"sk-bi-effect-delete",propsFunction:f.getEffectItemProperties,defaultStateFunction:function(){return j('<effect action="set" value=""/>')}}),c}}}];b.applyPropsWithCategories(d,c.state)},defaultStateGenerator:function(){return j('<filter type="select" filteroffoptionlabel="New Filter" createfilteroffoption="true" affectcookies="true" autocompthreshold="25" />')}});f.registerBuilder(I);var J=new f.Builder({id:"skuidpage",name:"Skuid Page",componentRenderer:function(a){var b=e.pagebuilderui;a.element.css("margin","0px"),a.header.append(d(b.model.mergeRow(b.row,a.builder.name+" - {{Name}}")));var c=a.state.children("models");c.length||(c=j("<models/>"),a.state.append(c));var f=a.state.children("resources");f.length||(f=j("<resources/>"),a.state.append(f));var h=a.state.children("components");h.length||(h=j("<components/>"),a.state.append(h));var i=new g.ComponentAcceptor(h);a.body.append(i.element)},propertiesRenderer:function(b,c){b.setHeaderText("Edit Page Properties");var g=e.pagebuilderui,h=g.model,i=g.row,j=d.map(f.availableThemes,function(a){return{label:a.Name,value:a.Name}});j.unshift({label:"Default",value:""});var k=[{id:"showheader",type:"boolean",label:"Show Header",defaultValue:!0,helptext:"Show the standard Salesforce page header."},{id:"showsidebar",type:"boolean",label:"Show Sidebar",defaultValue:!0,helptext:"Show the standard Salesforce sidebar."},{id:"tabtooverride",type:"string",label:"Tab to Override",helptext:"Either the SObject Name (e.g. 'Account', 'skuid__Page__c') of the custom object tab, or the label (e.g. 'Schools' or 'My Timesheets') of the Web/Visualforce tab, that you will be using this page as an override for."},{id:"theme",type:"picklist",label:"Theme",picklistEntries:j,helptext:"The name of the theme to use."},{id:"unsavedchangeswarning",type:"picklist",label:"Warn users if page has unsaved changes",picklistEntries:[{label:"No",value:""},{label:"Yes",value:"yes"}],defaultValue:"",helptext:"If a user tries to leave or close this page, and one or more of its Models has unsaved changes, a warning message will be shown before they can leave."}],l=[{name:"Basic",props:k}];b.applyPropsWithCategories(l,c.state,{columnCount:1});var m=b.body.children().first();m.find(".nx-pagebuilder-propcolumn").first().css("width","50%");var n=d("<div>").addClass("nx-pagebuilder-propcolumn").css("width","50%");m.prepend(n);var o=d("<div>").addClass("nx-basicfieldeditor-item nx-pagebuilder-property-item");n.append(o);var p=d("<div>").addClass("nx-basicfieldeditor-item-label").text("Page Name");o.append(p);var q=d("<div>").addClass("nx-field");o.append(q);var r=new a.ui.Field(i,h,null,{fieldId:"Name",mode:"edit"});r.render(),q.append(r.element);var s=d("<div>").addClass("nx-basicfieldeditor-item nx-pagebuilder-property-item");n.append(s);var t=d("<div>").addClass("nx-basicfieldeditor-item-label").text("Module");s.append(t);var u=d("<div>").addClass("nx-field");s.append(u);var v=h.getFieldValue(i,"skuid__Module__c")||"",w=new a.ui.Field(i,h,null,{fieldId:"skuid__Module__c",mode:"edit"});if(""!==v){var x=h.getField("skuid__Module__c").picklistEntries,y=!1;d.each(x,function(){return this.value===v?(y=!0,!1):void 0}),y||x.push({value:v,label:v,active:!0,defaultValue:!1})}w.render(),(-1!==d.inArray(v,e.protectedModules)||-1!==d.inArray(v.toLowerCase(),e.protectedModules))&&w.element.find("select").first().prop("disabled",!0),w.element.find("option").each(function(){var a=d(this),b=a.val();(-1!==d.inArray(b,e.protectedModules)||-1!==d.inArray(b.toLowerCase(),e.protectedModules))&&a.prop("disabled",!0)}),u.append(w.element);var z=d("<div>").addClass("nx-basicfieldeditor-item nx-pagebuilder-property-item");n.append(z);var A=d("<div>").addClass("nx-basicfieldeditor-item-label").text("Owner");z.append(A);var B=d("<div>").addClass("nx-field");z.append(B);var C=new a.ui.Field(i,h,null,{fieldId:"OwnerId",mode:"edit"});C.render(),B.append(C.element);var D=h.getField("skuid__Max_Auto_Saves__c"),E=d("<div>").addClass("nx-basicfieldeditor-item nx-pagebuilder-property-item");n.append(E);var F=d("<div>").addClass("nx-basicfieldeditor-item-label").text(D.label);if(D.inlineHelpText){var G=d("<div>").addClass("sk-icon sk-icon-help inline").css({"vertical-align":"top","margin-left":"4px"});G.skootip(D.inlineHelpText),F.append(G)}E.append(F);var H=d("<div>").addClass("nx-field");E.append(H);var I=new a.ui.Field(i,h,null,{fieldId:D.id,mode:"edit"});I.render(),H.append(I.element),h.getFieldValue(i,D.id)||I.element.find("input").val("25")},defaultStateGenerator:function(){return j('<skuidpage showsidebar="true" showheader="true" unsavedchangeswarning="yes"/>').append(j("<resources><labels/><javascript/><css/></resources>"),j("<models/>"),j("<components/>"))}});c.prototype.clear=function(a){return this.setHeaderText(a?"":"Nothing Selected"),this.headertext.detach(),this.propGroups.empty().detach(),this.header.empty(),this.header.append(this.propGroups),this.header.append(this.headertext),this.body.empty(),this},c.prototype.setHeaderText=function(a){return this.headertext.empty(),a&&this.headertext.text(a),this},c.prototype.applyPropTree=function(a,b){var c=function(a,b,e){var h=b.linkedComponent,i=new f.Builder({id:b.id,name:b.id,componentRenderer:function(g,i){i=i||{};var l=b.labelFunction&&b.labelFunction(g.state)||b.label;h&&b.refreshLinkedComponent&&i.isRefresh&&h.refresh(),g.body.addClass("nx-pagebuilder-labelwrapper").css("padding","0px"),g.actionbar.addClass("nx-pagebuilder-actionbar-tag");var m=d("<div>").addClass("nx-pagebuilder-labelstag"),n=d("<div>").css("margin-left","24px").text(l);m.append(d("<div>").css("float","left").addClass("sk-icon "+(b.icon||"sk-bi-propertyitem"))),m.append(n),(b.isUpdated||b.isNew)&&n.append(d("<div>").css({position:"static",display:"inline-block","vertical-align":"top","margin-left":"5px","margin-top":"1px"}).addClass("nx-pagebuilder-"+(b.isUpdated?"new":"updated")+"prop").text(b.isUpdated?"Updated":"New")),b.indent&&m.css("padding-left",24*parseInt(b.indent,10)+"px"),g.body.append(m),b.deleteable!==!1?g.addActionItem("",b.deleteicon||"sk-bi-propertyitem-delete",function(){b.linkedComponent&&(b.linkedComponent===f.getComponentFromState(g.state)?b.linkedComponent.remove(!0):b.refreshLinkedComponent&&b.linkedComponent.refresh()),g.remove(!0);var c=a.closest(".nx-childwrapper").siblings(".nx-noitemwrapper");c.length&&!a.children().length&&c.show(),k.empty()},b.deletetooltip):m.css("border-bottom","4px solid #ddd"),g.element.children(".nx-childwrapper").remove();var o,p=d('<div class="nx-childwrapper">'),q=!1,r=b.childrenFunction&&b.childrenFunction(g)||b.children;r&&d.each(r,function(){var a=this;a.invisibleParent?e.children(a.invisibleParent).each(function(){d(this).children(a.id).each(function(){c(p,a,d(this)),q=!0})}):e.children(a.id).each(function(){c(p,a,d(this)),q=!0}),p.sortableComponent({axis:"y",component:g,parentStateSelector:a.invisibleParent,placeholder:"sk-placeholder"}),g.addActionItem("",a.addicon||"sk-bi-propertyitem-add",function(){var d;if(a.invisibleParent){var f=e.children(a.invisibleParent);f.length||(f=j("<"+a.invisibleParent+"/>"),e.append(f)),d=f}else d=g.state;var h=a.defaultStateFunction&&a.defaultStateFunction()||j("<"+a.id+"/>");d.append(h),g.save(),c(p,a,h),a.refreshLinkedComponent&&a.linkedComponent.refresh(),b.noItemsFunction&&o&&o.hide()},b.addtooltip)}),b.noItemsFunction&&(o=d("<div>").addClass("nx-noitemwrapper"),o.css("padding-left",(parseInt(b.indent,10)||0)+32+"px"),o.append(b.noItemsFunction),g.element.append(o),q?o.hide():o.show()),g.element.append(p)},propertiesRenderer:function(a,c){g.buildPropsEditor(c.state,b.propsFunction&&b.propsFunction(c)||b.props||[],{columnCount:1}).css({padding:"4px",margin:"0px",clear:"none"}).appendTo(a)},hideWrapper:!0,customPropObj:k,defaultStateGenerator:function(){return b.defaultStateFunction&&b.defaultStateFunction()||j("<"+b.id+"/>")},onSelect:function(){h&&h.element.addClass("nx-pagebuilder-selected")},resetPropCategory:!1}),l=f.componentFactory(e,i);return a.append(l.element),l},e=function(a,d){var e;if(a.isChild){var f=b.children(a.id);f.length||(f=a.defaultStateFunction&&a.defaultStateFunction()||j("<"+a.id+"/>"),b.append(f)),e=c(i,a,f)}else e=c(i,a,b);d&&e.select({resetPropCategory:!1})},h=d("<div>").css("height","100%"),i=d("<div>").addClass("nx-pagebuilder-propsidebar"),k=d("<div>").addClass("nx-pagebuilder-propmainbar");a instanceof Array?d.each(a,function(a){e(this,0===a)}):e(a,!0),h.append(i,k),this.body.append(h)},c.prototype.applyPropsWithCategories=function(a,b,c){var e=this;e.body.empty(),e.propGroups.empty(),e.catObj=a,d.each(a,function(){var a,f=this;(f.props&&f.props.length>0||f.customPropFunction||f.tree)&&(a=d("<div>").addClass("nx-pagebuilder-toolbarpanel-propgroup"),e.propGroups.append(a.attr("data-name",f.name).text(f.name).click(function(){f.beforeChange&&f.beforeChange(),e.propGroups.children().removeClass("on"),d(this).addClass("on"),e.category=f.name,e.body.empty();var a;f.customPropFunction?(a=d("<div>"),f.customPropFunction(a,b)):f.tree?e.applyPropTree(f.tree,b):(a=g.buildPropsEditor(b,f.props,c),e.body.empty()),e.body.append(a)})),(f.isUpdated||f.isNew)&&(a.css("position","relative").css("padding-left",(f.isUpdated?54:37)+"px"),a.append(d("<div>").css({top:"3px",left:"6px"}).addClass("nx-pagebuilder-"+(f.isUpdated?"new":"updated")+"prop").text(f.isUpdated?"Updated":"New"))))});var f=this.propGroups.children(),h=f.filter('[data-name="'+this.category+'"]').first();return this.category&&f.length>1&&h.length>0?(this.propGroups.show(),h.click()):f.length>1?(this.propGroups.show(),f.first().click()):(this.propGroups.hide(),f.first().click()),this},c.prototype.applyProps=function(a,b){return this.body.empty(),this.propGroups.empty(),this.body.append(g.buildPropsEditor(b,a)),this},c.prototype.applyPropsEditor=function(a){return this.body.empty(),this.propGroups.empty(),this.body.append(a),this};var K={init:function(g,k){var n,o=this;e.pagebuilderui=this,d.each(f.availableThemes,function(){var b="/resource/"+(this.skuid__Resource_Namespace__c?this.skuid__Resource_Namespace__c+"__":"")+this.skuid__Resource_Name__c+"/skuidicons.css";a.utils.loadCSS(b,{prepend:!0})}),m("pagepreview",function(){l("skuid.builder.page.preview")({xml:o.pageXML,row:o.row,editor:o.editor,model:o.model})}),m("restoreFromSavedVersion",function(b){var c=b.item.row,e=a.model.getModel("pageBuilder_SelectedVersion");d.blockUI({message:"Restoring saved Page Version..."}),e.setCondition(e.getConditionByName("selectedversionid"),c.Id,!1),e.updateData(function(){try{var a=e.getFieldValues(e.getFirstRow(),f.layoutFields,!0).join("");n(a),o.save(),setTimeout(function(){d.blockUI({message:"Restore complete!",timeout:500})},200)}catch(b){d.blockUI({message:"There was an error while trying to restore the selected Page Version:\n\n"+b,timeout:4e3})}})}),m("addSavedPageVersion",function(a){var b,c,e=a.model,g=a.list;d.each(f.layoutFields,function(a,b){if(!e.getField(b)){var c=d.extend({},o.model.getField(b));e.fields.push(c),e.fieldsMap[b]=c}}),b=e.createRow({initiatorId:g._GUID}),f.save(o.pageXML[0],e,b),c=g.newItem(b,{editModeForNewItems:!0}),g.render({resetPagination:!0,refreshFields:!1})}),a.$(function(){o.addClass("nx-editor ui-widget"),o.toolbar=d("<div>").addClass("nx-pagebuilder-toolbar");var l;l=d(window),h.delayEventCallback({eventType:"scroll",context:l,delay:25,callback:function(){var a=l.scrollTop(),b=o.offset().top,c=a-b,e={position:"relative"};a>b?d.extend(e,{width:"100%",top:c+"px","box-shadow":"3px 3px 5px 6px #ccc","padding-top":"5px"}):d.extend(e,{top:"0px",padding:"4px 0px","box-shadow":"none","border-bottom":"0px solid white"}),o.toolbar.stop().animate(e,"fast")}}),o.model=i.getModel("page"),o.row=o.model.getFirstRow(),o.editor=new a.ui.Editor(o,{showHeader:"false"!==g.attr("showheader")}),o.model&&o.editor.registerModel(o.model),o.cselector=new b,o.cproperties=new c;var m=d('<div id="toolbarWrapper">'),p=d('<ul id="toolbarTabNav">').appendTo(m);p.append(d("<li>").append(d("<a>").attr("href","#components").text("Components"))),p.append(d("<li>").append(d("<a>").attr("href","#models").text("Models"))),p.append(d("<li>").append(d("<a>").attr("href","#resources").text("Resources")));var q=d("<div>").prop("id","components").append(o.cselector.element),r=d("<div>").prop("id","models"),s=d("<div>").prop("id","resources");m.append(q,r,s),m.tabs({beforeActivate:function(a,b){var c;-1===b.newTab.index()?(c=b.oldPanel,a.preventDefault()):c=b.newPanel;var f=c.children(".nx-pagebuilder-component").data("object");if(f)f.select();else{var g=e.pagebuilderui.cproperties;g.clear(),g.setHeaderText("Skuid Components");var h=d("<div>").addClass("nx-pagebuilder-infotext").text("Skuid Components are the building blocks of Skuid. They are what define a page's functionality. They also introduce many capabilities above and beyond standard their VisualForce counterparts. Some components can contain other components (ie, Panel Set, Tab Set). Others allow for customization using Mustache templates.");g.body.append(h)}},collapsible:!0}),p.removeClass("ui-corner-all"),o.toolbar.append(m,o.cproperties.element),o.layoutcontainer=d("<div>").addClass("nx-pagebuilder-workspace"),o.save=function(){f.save(o.pageXML[0],o.model,o.row)},a.events.subscribe("skuidBuilderSave",function(){o.save()}),n=function(a){a||(a=o.model.getFieldValues(o.row,f.layoutFields,!0).join(""));var b=!1;return a.length?o.pageXML=j(a):o.model&&o.model.data[0]&&(b=!0,o.pageXML=J.getDefaultState()),f.pageXML=o.pageXML,o.pagecomponent=f.componentFactory(o.pageXML,J),o.layoutcontainer.empty().append(o.pagecomponent.element),r.empty().append(f.componentFactory(o.pageXML.children("models"),A).element),s.empty().append(f.componentFactory(o.pageXML.children("resources"),H).element),b};var t=n();o.pagecomponent.select(),o.on("click",".nx-pagebuilder-component",function(a){var b=d(this).data("object");b&&b.select(),a.stopPropagation()}),i.isNewId(o.row.Id)||(o.viewXMLLink=d("<a>").addClass("nx-pagebuilder-viewxmllink").prop("href","/apex/skuid__ui?page=PageXMLEdit&id="+o.row.Id).text("View/Edit XML")),o.editor.handleCancel=function(){a.ui.Editor.prototype.handleCancel.call(o.editor),n(),o.cproperties.clear(),o.viewXMLLink&&o.viewXMLLink.removeClass("disabled")},o.editor.handleSave=function(){a.ui.Editor.prototype.handleSave.call(o.editor),o.viewXMLLink&&o.viewXMLLink.removeClass("disabled");var b=i.getModel("versions");b.cancel(),b.updateData()},o.editor.handleChange=function(){a.ui.Editor.prototype.handleChange.call(o.editor),o.viewXMLLink&&o.viewXMLLink.addClass("disabled")},a.events.subscribe("skuidBuilderSave",function(){o.save()}),t&&o.save();var u="";d.each(f.layoutFields,function(a,b){u+="{{"+b+"}}"}),o.append(o.toolbar,o.layoutcontainer,o.viewXMLLink),k&&(k.unregister=function(){a.component.Component.prototype.unregister.call(k),o.editor&&o.editor.unregister()})})}};h.registerPlugin("pageBuilder",K),a.componentType.register("pagebuilder",function(a,b,c){a.pageBuilder(b,c)})}(skuid);